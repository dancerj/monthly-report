%     Tokyo Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2011, 2015, 2020 Nobuhiro Iwamatsu

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2020}
\newcommand{\debmtgmonth}{12}
\newcommand{\debmtgdate}{XX}
% started from zero:
% (let ((year 2020) (month 12)) (+ (* (- year 2005) 12) month -1))
\newcommand{\debmtgnumber}{191}

% Needed to import pandoc-generated LaTeX documents.
% See https://stackoverflow.com/questions/40438037/tightlist-error-using-pandoc-with-markdown
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics{image-assets/dotdeb.pdf}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
% 全角文字にしないとフォントのサイズが合わないので注意
\rotatebox{10}{\fontsize{30}{30} {\gt goを使う}}\\

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image-assets/openlogo-nd.eps}
\end{titlepage}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{最近のDebian関連のミーティング報告}{杉本　典充}

\dancersection{事前課題}{杉本　典充}

今回の事前課題は以下です。

\begin{enumerate}
 \item go 書いたことありますか、何を書きましたか
 \item go で書かれたプログラムでDebianにあったらいいなというのはなにかありますか？
\end{enumerate}

%この課題に対して提出いただいた内容は以下です。

\begin{multicols}{2}
{\small
% \input{image202008/prework.tex}
}
\end{multicols}

%\dancersection{Debian Trivia Quiz}{username}
%
%Debianの昨今の話題についてのQuizです。
%
%今回の出題範囲は\url{debian-devel-announce@lists.debian.org} や \url{debian-news@lists.debian.org}などに投稿された内容からです。
%
%\begin{multicols}{2}
%\input{image202007/quiz.tex}
%\end{multicols}


% % (query-replace-regexp "<.*?>" "")
% % (query-replace-regexp "^[    ]\+" "")

%-------------------------------------------------------------------------------
\dancersection{DebianにおけるGo}{上川純一}
%-------------------------------------------------------------------------------

Go 言語をDebianで使ってみましょう。

まず入門するにはオンラインでのチュートリアルが充実しているので最初はローカルにインストールすることすら必要ないでしょう\cite{golang:tourofgo}
\cite{golang:tourofgoja}。
しかし次第に本格的に使い始めようとすると手元にインストールしたくなるはずです。

\subsection{DebianユーザとしてGoでプログラムを書いてみる}

Go のインストール手順\cite{golangorg-install}に従って公式パッケージをダウンロードしてTarを展開すると最新のバイナリがインストールできます。しかしあとからアンインストールするときとかに面倒ですしアップデートも自動ではありません。
ここはDebianパッケージが使いたいなぁと思います。

Debianの公式パッケージはBusterでは２０２０年１０月現在1.11ですが、Buster backports にはもう少し新しい1.14があります。
まず /etc/apt/sources.list に buster-backportsを追加しましょう。

\begin{commandline}
deb https://deb.debian.org/debian buster-backports main
\end{commandline}

そしておもむろにインストール

\begin{commandline}
$ sudo apt update
$ sudo apt install -t buster-backports golang \
  golang-mode
\end{commandline}

Goの追加のパッケージはDebianパッケージではなくGoの仕組みでインストールし
ましょう。Debianパッケージはビルド時の依存関係を満たすためだけにパッケー
ジされているようで、デフォルトのGOPATHに入っていません。

たとえばsqliteを利用したいなと思ったら \verb!~/go! 以下にインストールし
ます。

\begin{commandline}
$ go get github.com/mattn/go-sqlite3
\end{commandline}

すると以下のようなプログラム(db.go)がコンパイルできるようになります。

\begin{commandline}
import (
	"database/sql"
	_ "github.com/mattn/go-sqlite3"
	"log"
)

func main() {
	db, err := sql.Open("sqlite3", "./ac.db")
	if err != nil {
		log.Fatal(err)
	}
	defer db.Close()
}

\end{commandline}

コンパイルはgo build, ただビルドだけじゃなくて実行までしたければgo runで直接実行までできます。

\begin{commandline}
$ go build db.go
$ go run db.go
\end{commandline}

\subsection{Debian開発者としてのGoパッケージ}


DebianにGoでできたソフトウェアをパッケージとしていれたいときにの作業とし
て、一ユーザとして利用していたのと変わるのはポリシー準拠のためにDebianで
ビルドできるようにする必要があるということです。つまり依存関係にあったも
のをgo getでダウンロードしてくるのではなくDebianパッケージとして提供する
必要があるということです。

Debian にあるGoパッケージはpkg-goチームが中心となって行っています
\cite{debian-go-packaging}、全てではないですが大半のパッケージはこのチー
ムがやっているようです。

dh-golangを使ってDebianパッケージのビルドは行うようです。dh-make-golang
コマンドを使うとDebianパッケージの雛形を作成してくれるようです。

\begin{thebibliography}{1}
 \bibitem{golangorg} ``The Go Programming Language'' \url{https://golang.org/}
 \bibitem{golangorg-doc} ``Documentation -- The Go Programming Language'', \url{https://golang.org/doc}
 \bibitem{golangorg-install} \url{https://golang.org/doc/install}
 \bibitem{golang:tourofgo} ``A Tour of Go'' \url{https://tour.golang.org/welcome/1}
 \bibitem{golang:tourofgoja} \url{https://go-tour-jp.appspot.com/welcome/1}
 \bibitem{debian-go-packaging} ``Debian Go Packaging'' \url{https://go-team.pages.debian.net/packaging.html}
\end{thebibliography}

%\dancersection{title}{username}


% 冊子にするために、4の倍数にする必要がある。
% そのための調整
\dancersection{メモ}{}
\mbox{}\newpage
\mbox{}\newpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image-assets/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule
\end{document}
