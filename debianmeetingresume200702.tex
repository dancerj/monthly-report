%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2007 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200701; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}
\usepackage{nextpage}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2007}
\newcommand{\debmtgdate}{17}
\newcommand{\debmtgmonth}{2}
\newcommand{\debmtgnumber}{25}



%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}


%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\gt\fontsize{32}{32}\headfont\raggedright}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
第\debmtgnumber{}回 東京エリアDebian勉強会 \debmtgyear{}年\debmtgmonth{}月
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{4cm}
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{-7cm}
\begin{minipage}[b]{0.7\hsize}
\section{#1}
\hfill{}#2\\
\vspace{2cm}
\end{minipage}
\begin{minipage}[b]{0.3\hsize}
\hfill{}\includegraphics[height=8cm]{image200502/openlogo-nd.eps}\\
\end{minipage}
%
%\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{Bug\##1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}




\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに


 第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\vspace{2cm}

\begin{minipage}[t]{0.6\hsize}
\vspace{-2cm}
{\fontsize{60}{60}
{\gt
東京エリア \\
デビアン \\
勉強会
}}
\end{minipage}
\begin{minipage}[b]{0.4\hsize}
\hspace{-1cm}\includegraphics[width=9cm]{image200502/openlogo-nd.eps}
\end{minipage}

\vspace{3cm}
\hfill{}Debian勉強会幹事 コバヤシ ノリタダ\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{上川純一}
 
 今月のDebian勉強会へようこそ。
 これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
 るという方も、月に一回Debianについて語りませんか？

 目的として次の二つを考えています。

 \begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報につ
       いて情報共有する場をつくる
 \item Debianを利用する際の情報をまとめて、ある程度の塊として整理するた
       めの場をつくる
 \end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。

 Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
 情報の共有をしたい、というのが目的です。


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川純一}

今回の事前課題は
「XXXX」
というタイトルで200-800文字程度の文章を書いてください。というものでした。
その課題に対して下記の内容を提出いただきました。

\subsection{}

\subsection{上川}

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2007年XX号}
\url{http://www.debian.org/News/weekly/2007/XX/}
にあるX月X日版です。

\santaku
{}
{}
{}
{}
{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会23回目報告}
% (query-replace-regexp "<.*>" "")

\dancersection{Debian勉強会 2007年度計画検討結果}{上川純一}
\label{sec:debmtg2007plandone}

\dancersection{dpatch updates 2007}{上川純一}
\label{sec:dpatch2007}

\subsection{インストールのしかた}

\begin{commandline}
 apt-get install dpatch
\end{commandline}

\subsection{作業のしかた}

debian/rules を適切に変更。

dpatch-edit-patch で編集。

\subsection{svn-buildpackage などとの連携方法}

svn-buildpackage などとの連携もこうやったらできます。

\subsection{各種ツールを分析してみる}

こんなツールがあります。

\begin{description}
 \item[dpatch] メインのツール
 \item[dpatch-edit-patch] 編集のツール
 \item[dpatch-convert-diffgz] .diff.gz から生成する
 \item[dpatch-get-origtargz] dpatch-edit-patch が内部的に利用するツール
\end{description}

\subsection{今後の開発指針}


\subsection{参考文献}

\begin{itemize}
 \item 2005年7月 Debian勉強会資料
\end{itemize}



\dancersection{dbs}{岩松}
\label{sec:dbs}

\subsection{dbs とはなにか}

%今年の正月にmake-kpkg をいじっていたのですが、いじっているときに kernel-package パッケージはパッチを管理するツールとして
%dbs\footnote{http://packages.debian.org/ubstable/devel/dbs}を使っていることに気がつきました。今回はこのdbsについて調べた
%ことをまとめてみました。

 
dbs は Debian Build System の略です。dpatch や quilt はパッチを管理する方法に重点を置いているのですが、
dbs は名前のとおり、ビルドまでの面倒を見るためのツールです。
使いかたとしては、dbs も dpatch もあまり変わりません。debian/rules で専用のライブラリをincludeして使うだけです。
ただ、作法がありところどころ違うところもあります。今回はdpatch と比べてどこが違うのかを比べてみようと思います。

\subsection{インストールのしかた}

\begin{commandline}
# apt-get install dbs
\end{commandline}

\subsection{使いかた}

dbs の使うためののサンプルとして hello-dbs\footnote{http://packages.debian.org/unstable/devel/hello-dbs} というパッケージが存在します。
これを使ってどのように dbs を使うのか見ていこうと思います。


\subsubsection{hello-dbs を取得}
hello-dbs のソースパッケージを取得します。

\begin{commandline}
# apt-get source hello-dbs
\end{commandline}

\subsubsection{展開されたソースパッケージ}
展開されたソースパッケージ内をみると、以下のような構成になっています。

\begin{commandline}
iwamatsu@chimagu:~/dev/debian/dbs/hello-dbs-1.3$ ls
debian  hello-1.3.tar.gz
\end{commandline}

ここでわかる dbs を使ったパッケージの特徴として、ソースパッケージは tar.gz 形式で提供されている点です。
dh\_make を使って生成されたパッケージではこのような構成にはなっていません。
upstream のソースパッケージは Debain標準の形ではないということです。

しかし、debian ディレクトリは、他のパッケージの構成とあまり変わりません。

\begin{commandline}
iwamatsu@chimagu:~/dev/debian/dbs/hello-dbs-1.3$ ls debian/
README.Debian  README.build  changelog  compat  control  copyright  dirs  hello.1  patches  rules
\end{commandline}

\subsubsection{debian/rules ファイル}
dbs では debian/rules に設定項目を書くことによって、細かい設定を行うことができます。
hello-dbs では以下の設定を行っています。

\begin{commandline}
# DBS options

package         := hello-dbs
PWD             := $(shell pwd)
CFLAGS          := -O2 -Wall
INSTALL = install
INSTALL_DATA    := $(INSTALL) -m644
INSTALL_DIR     := $(INSTALL) -p -d -o root -g root  -m  755
INSTALL_FILE    := $(INSTALL) -p    -o root -g root  -m  644
INSTALL_PROGRAM := $(INSTALL) -m755
INSTALL_SCRIPT  := $(INSTALL) -p    -o root -g root  -m  755
SCRIPT_DIR     = /usr/share/dbs

# the dbs rules
TAR_DIR := hello-1.3.orig
include $(SCRIPT_DIR)/dbs-build.mk

\end{commandline}

以下に各設定項目の内容を示します。

\begin{itemize}
\item package\\
	パッケージ名

\item PWD \\
	パッケージカレントディレクトリ

\item CFLAGS\\
	C コンパイラに設定するオプション

\item INSTALL\_DATA\\
	インストールするデータのパーミッション

\item INSTALL\_DIR\\
	インストール先ディレクトリのパーミッション 

\item INSTALL\_FILE\\
	インストールするファイルのパーミッション

\item INSTALL\_PROGRAM\\ 
	インストールするプログラムのパーミッション

\item INSTALL\_SCRIPT\\
	インストールするスクリプトのパーミッション

\item SCRIPT\_DIR\\
	dbs スクリプトディレクトリパス

\item TAR\_DIR\\
	tar 解凍後ディレクトリ名
\end{itemize}

これら以外に

{\bf include \$(SCRIPT\_DIR)/dbs-build.mk }でinclude することにより、dbs を使うことができるようになります。

\subsubsection{パッチ}
dbs では dpatch と同様、{\bf debian/patches} ディレクトリにパッチを格納する必要があります。
パッチはユニファイド diff 形式 で書かれている必要があり、ファイル名の先頭には数字を付けます。
数字とファイル名の間はアンダースコアで区切ります。特に拡張子等は必要ありません。
dbs はこの数字が割り当てられている順にパッチをソースコードに適用していきます。

dpatch では 00list というファイルにパッチ名を書き、書かれた順にパッチを適用していきます。
パッチの順番が変わったときは、00list ファイルを修正すればいいだけですが、dbs の場合は
パッチの順が変わったときはファイル名を変更しないといけません。

また、hello-dbs パッケージでは {\bf 00\_maillocation} パッチがあります。

\begin{commandline}
% ls -l debian/patches
00_maillocation
\end{commandline}

\subsubsection{パッケージのビルド}

パッケージのビルドが行われるとき、以下の図の順でターゲットが呼ばれます。

\includegraphics{image200702/dbs00.png}

\begin{enumerate}
\item create build-tree ディレクトリ \\
	\$BUILD\_TREE で指定されたディレクトリを作成します。
	デフォルトでは {\bf build-tree} になっています。

\item decompression tar.gz \\
	ソースコードが圧縮されている tar.gz を build-tree ディレクトリに解凍します。

\item \$(patched) target  \\
	debian/patches ディレクトリにあるパッチを適用します。

\item \$(STAMP\_DIR)\/stamp-configure target \\
	stamp-configure ターゲットを実行します。
	hello-dbs では \$BUILD\_TREE ディレクトリに移動し、configure を実行します。

\item \$(STAMP\_DIR)/stamp-build target \\
	stamp-build ターゲットを実行します。
	hello-dbs では \$BUILD\_TREE ディレクトリに移動し、make を実行します。 
\end{enumerate}

build 時の dpatch との違いは、

\begin{itemize}
\item パッチを当てるためのターゲット名が異なる
	dbs は \$(patched)、dpatch は patch-stamp。

\item マーク用のファイル名が異なる
	stamp-configure や stamp-build というマーク用のファイル名が逆だったりします。
	( 通常は configure-stamp / build-stamp )
\end{itemize}

\subsubsection{パッケージのclean}
dbs の ソースのcleanターゲットはいたってシンプルです。
dpatch は 既に展開されているソースにパッチを適用するため、cleanターゲット時には適用されたパッチを外す処理が必
要になりますが、dbs では、build 時に生成されたマークファイル用ディレクトリやソース格納先ディレクトリ
(\$BUILD\_TREE)をばっさり削除します。これには、適用されたパッチの管理等を行わずに済むというメリットがあります。

しかし、dbs は パッケージビルド毎に 
\begin{enumerate}
	\item ディレクトリを削除
	\item tar.gz を解凍
	\item パッチ適用
\end{enumerate}
とするので、サイズの大きい tar.gz をパッケージ化するときは時間がかかるというでデメリットもあります。

\subsection{まとめ}
今回、dbs を触ってみたのですが、
\begin{itemize}
	\item ソース見えない
		ソースがtar で固まっているため、見ることができない。
		見るには コマンドを使って解凍する必要がある。

	\item 





\end{itemize}

\dancersection{次回}{}

未定です。
内容は本日決定予定です。

参加者募集はまた後程。

\cleartoevenpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule
\end{minipage}

\end{document}
