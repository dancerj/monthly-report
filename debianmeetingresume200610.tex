%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2006 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%   Pdf作成手順
% dvipdfmx debianmeetingresume200610.dvi
%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200610; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}

%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}


%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\Huge\headfont\raggedright\centering}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
東京エリアDebian勉強会 2006
\hrule
\vspace{0.5mm}
\hrule
%\hfill{}\includegraphics[width=3cm]{image200502/openlogo-nd.eps}\\
\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-5cm}
\begin{center}
\section{#1}
\end{center}
\hfill{}\colorbox{white}{#2}\hspace{3cm}\space\\
\vspace{1cm}
\hrule
\vspace{0.5mm}
\hrule
\vspace{1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{#1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}


\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに
\title{\includegraphics[width=7cm]{image200502/openlogo-nd.eps}\\
 第21回 東京エリア Debian 勉強会\\事前資料}
\date{2006年10月21日}
\author{Debian勉強会会場係 上川純一\thanks{Debian Project Official Developer}} 
\maketitle
\thispagestyle{empty}
\end{titlepage}

\newpage
\tableofcontents

\dancersection{Introduction To Debian 勉強会}{上川純一}

今月のDebian勉強会へようこそ。
これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
るという方も、月に一回Debianについて語りませんか？

目的として下記の二つを考えています。

\begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報を情
       報共有する場をつくる
 \item まとまっていないDebianを利用する際の情報をまとめて、ある程度の塊と
       して出してみる
\end{itemize}

また、東京にはLinuxの勉強会はたくさんありますので、Debianに限定した勉強
会にします。Linuxの基本的な利用方法などが知りたい方は、他でがんばってくださ
い。
Debianの勉強会ということで究極的には参加者全員がDebian Packageを
がりがりと作りながらスーパーハッカーになれるような姿を妄想しています。

Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
情報の共有をしたい、というのが目的です。
次回は違うこと言ってるかもしれませんが、御容赦を。

\subsection{講師紹介}

\begin{itemize}
 \item{上川純一} 宴会の幹事です。
\end{itemize}

\subsection{事前課題紹介}

今回の事前課題は
「XXX」
というタイトルで200-800文字程度の文章を書いてください。
というものでした。
その課題に対して下記の内容を提出いただきました。

\subsubsection{}

\subsubsection{上川}


%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2006年XX号}
\url{http://www.debian.org/News/weekly/2006/XX/}
にある5月XX日版です。

\santaku
{}
{}
{}
{}
{}


\santaku
{}
{}
{}
{}
{}

\santaku
{}
{}
{}
{}
{}

\santaku
{}
{}
{}
{}
{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会20回目報告}
% (query-replace-regexp "<.*>" "")


\dancersection{rpmstrapを活用する}{岩松}
\label{sec:iwamatsurpmstrap}
\subsection{始めに}
みなさん、rpmstrap を御存じでしょうか。「これは Debian 勉強会なんじゃないの？RPM の話なんて
関係ねーじゃねーか！」と思った人もおられると思いますが、今回は無視してrpmstrapについてお話したいと
思います。

\subsection{rpmstrap とは？}
Debian ではchroot環境等を構築するツールとして、debootstrap\footnote{http://packages.debian.org/unstable/admin/debootstrap}
がありますが、rpmstrapは名前の通り、RPMパッケージで chroot 環境等を構築するツールです。
debootstrap と同様、wget\footnote{http://packages.debian.org/unstable/web/wget}をつかって、
http/ftp 経由でパッケージを取得します。
なので、インターネットにつながった環境が必要になります。

Debian では testing と sid にあり、sarge にはありません。時期リリースの Etch には収録される予定です。

\subsection{インストール}

\begin{commandline}
# apt-get install rpmstrap
\end{commandline}

でインストールできます。
\subsection{使い方}

rpmstrap は root 権限が必要です。root権限を持ったユーザー等で実行する必要があります。

\subsubsection{とりあえず、chroot環境を構築してみる}

rpomstrap を使って、CentOS 4.0 の環境を構築してみます。
chroot を構築するには以下のコマンドで行います。


\begin{commandline}
# rpmstrap centos4 install_path
\end{commandline}


第1引数に対象ディストリビューション、第2引数にはインストール先を指定します。

実行すると、ネットワーク経由で RPM パッケージをダウンロードしてきます。

\begin{commandline}
iwamatsu@rahute:~/rpm # rpmstrap --verbose centos4 ./centos/
rpmstrap: debug: Preparing variables
rpmstrap: debug: Loading /usr/lib/rpmstrap/scripts/centos4 suite
rpmstrap: debug: Working out mirror
rpmstrap: debug: Work out RPMS
rpmstrap: debug: setup_env()
rpmstrap: debug: Install RPMS
rpmstrap: debug: setup_env()
rpmstrap: debug: get_rpms(): Getting RPM from http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/
rpmstrap: debug: wget  http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/setup-2.5.37-1.3.noarch.rpm
--21:56:09--  http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/setup-2.5.37-1.3.noarch.rpm
           => `setup-2.5.37-1.3.noarch.rpm'
mirror.centos.org をDNSに問いあわせています... 72.21.40.10
mirror.centos.org|72.21.40.10|:80 に接続しています... 接続しました。
HTTP による接続要求を送信しました、応答を待っています... 200 OK
長さ: 31,051 (30K) [application/x-rpm]

100%[===================================================================>] 31,051        64.83K/s

21:56:10 (64.69 KB/s) - `setup-2.5.37-1.3.noarch.rpm' を保存しました [31051/31051]

rpmstrap: debug: get_rpms(): Getting RPM from http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/
rpmstrap: debug: wget  http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/filesystem-2.3.0-1.i386.rpm
--21:56:10--  http://mirror.centos.org/centos/4/os/i386/CentOS/RPMS/filesystem-2.3.0-1.i386.rpm
           => `filesystem-2.3.0-1.i386.rpm'
mirror.centos.org をDNSに問いあわせています... 72.21.40.10
mirror.centos.org|72.21.40.10|:80 に接続しています... 接続しました。
HTTP による接続要求を送信しました、応答を待っています... 200 OK
長さ: 15,608 (15K) [application/x-rpm]

100%[===================================================================>] 15,608        48.90K/s

21:56:11 (48.77 KB/s) - `filesystem-2.3.0-1.i386.rpm' を保存しました [15608/15608]

.............（中略）

rpmstrap: debug: Installing pass number 53...
rpmstrap: debug: Installing nano-1.2.4-1.i386.rpm to /home/iwamatsu/rpm/./centos...
警告: nano-1.2.4-1.i386.rpm: Header V3 DSA signature: NOKEY, key ID 443e1821
rpmstrap: debug: Installing pass number 54...
rpmstrap: debug: Installing openldap-2.2.13-4.i386.rpm cyrus-sasl-2.1.19-5.EL4.i386.rpm 
 cyrus-sasl-md5-2.1.19-5.EL4.i386.rpm to /home/iwamatsu/rpm/./centos...
警告: openldap-2.2.13-4.i386.rpm: Header V3 DSA signature: NOKEY, key ID 443e1821
rpmstrap: debug: Installing pass number 55...
rpmstrap: debug: Installing libuser-0.52.5-1.el4.1.i386.rpm to /home/iwamatsu/rpm/./centos...
警告: libuser-0.52.5-1.el4.1.i386.rpm: Header V3 DSA signature: NOKEY, key ID 443e1821
rpmstrap: debug: Installing pass number 56...
rpmstrap: debug: Installing passwd-0.68-10.1.i386.rpm to /home/iwamatsu/rpm/./centos...
警告: passwd-0.68-10.1.i386.rpm: Header V3 DSA signature: NOKEY, key ID 443e1821
rpmstrap: debug: Installing pass number 57...
rpmstrap: debug: ...nothing left to do.
rpmstrap: debug: Done

\end{commandline}

これで構築の完了です。

\subsection{chroot 環境にログインする}
chroot 環境にログインするためには root 権限で chrootを実行します。

\begin{commandline}
# chroot ./centos
\end{commandline}

\subsubsection{RPM データベースを作成}

chroot 後に最初しないといけなことです。
/var/lib/rpm に RPM のデータベースが構築されていないので、構築する必要があります。

\begin{commandline}
# rpm --rebuilddb
\end{commandline}

\subsection{細かい設定}

\subsection{設定ファイル}
RPM を取得するパッケージのレポジトリ等の設定を行っているファイルが

\begin{commandline}
/usr/lib/rpmstrap/scripts/
\end{commandline}

にあります。
rpmstrapで取得可能なレポジトリはこのディレクトリ下のファイルのみになります。
新しいディストリビューションを追加する場合は設定ファイルを追加する必要があります。
現在は

\begin{itemize}
\item centos3 ( Cent OS 3 )
\item heidelberg( Fedora Core 3 )  
\item sl402 ( Scientfic Linux 4.02 )       
\item suse10.0  ( Suse 10.0 )
\item tettnang ( Fedora Core 2 )
\item centos4  (Cent OS 4 )   
\item mandriva10 ( Mandriva 10 )
\item sl304  ( Scientfic Linux 3.04 )    
\item stentz ( Fedora Core 4 )  
\item suse9.3  ( Suze 9.3 )   
\item yellowdog4 ( YelloDog Linux 4.0)
\end{itemize}

をサポートしています。
pdk というファイルで設定ファイルの雛型があるので、それを見て設定ファイルを作成するとよいでしょう。
今回はVineLinuxがサポートされていないようなので、追加してパッチを送りました。
\subsection{rpmstrap のだめなところ}

rpmstrap を使ってみて、だめなところがたくさんありました。
\begin{itemize}
\item 構築までに時間がかかる。

	無駄なファイルが多く、構築までに30分ほど時間がかかります。
	設定ファイルに記述する RPM を吟味するといいかもしれません。

\item 設定ファイルの実装がダサい。

	RPM を使ったディストリビューションは多いのですが、相互でバージョンが一致していなく、設定ファイルにバージョン
	も記述しないといけません。よって、RPM がひとつでもアップデートされると書き直す必要があります。
	Debian ですとファイル名だけなのでこのような問題は発生しません。
	また、ディストリビューションが増える毎に設定ファイルが増えていくという問題もあります。


\end{itemize}

\subsection{使いどころ}

rpmstrap の使いどころを妄想してみました。
\begin{itemize}
\item Debian が動作しているマシンで RPM のパッケージを
コンパイルする。
\item RPM を使っている ディストリビューション上で別のディストリビューションを
構築する。

\end{itemize}


\dancersection{gentoo を chroot にインストールしてみる}{上川}
\label{sec:gentoo-chroot}

Debian 上で、 gentoo を chroot にインストールする方法について説明します。
変態度合が伝われば幸いです。
この手順、つくってから気づきましたが、実はあまり Debian 関係ないです。


\subsection{gentoo の最低限のインストール}

まず、gentoo の stage1 の tarball を取得してきます。適当なミラーにおいて
あります。ここでは
\url{http://mirror.datapipe.net/gentoo/releases/amd64/2006.0/stages/}か
ら取得してきました。
適当な場所にインストール先のディレクトリを作成し、そこで stage1 の
tarball を展開します。
アプリケーションの動作に最低限必要な proc ファイルシステムをマウントし、
 resolv.conf を chroot 内部にコピーし、chroot します。
これで emerge ができる状況になったので、 emerge しまくるようです。

\begin{commandline}
Debian$ sudo tar xfjp stage1-amd64-2006.0.tar.bz2 
Debian$ sudo mount -t proc proc/ proc/
Debian$ sudo cp /etc/resolv.conf etc/resolv.conf
Debian$ sudo chroot . 
Gentoo# env-update 
>>> Regenerating /etc/ld.so.cache...
Gentoo# source /etc/profile
Gentoo# emerge --sync 

ここで大量の出力

Gentoo# emerge portage
\end{commandline}

\subsection{gentoo 自身のブートストラップ}

wikiの手順では下記のようにすると順番にブートストラップしてくれるようです。
あらゆるプログラムをコンパイルしてインストールするので時間が非常にかかり
ます。個人的にはすでに飽きてしまったのでもう検証していません、続きはまた
誰かが後でやってくれることを期待しつつ。

\begin{commandline}
Gentoo# env-update && source /etc/profile && emerge --oneshot --nodeps gcc-config && USE="-* build bootstrap" emerge linux-headers && \
/usr/portage/scripts/bootstrap.sh && emerge -O libperl && emerge -O python && emerge --deep system && \
emerge syslog-ng xinetd grub hotplug coldplug vixie-cron reiserfsprogs reiser4progs sysfsutils udev dhcpcd && \
emerge --nodeps acpid ntp && rc-update add syslog-ng default && rc-update add net.eth0 default && rc-update add vixie-cron default && \
rc-update add xinetd default && rc-update add sshd default && rc-update add hotplug default && rc-update add coldplug default && \
rc-update add acpid default
\end{commandline}

\subsection{参考文献}

\begin{itemize}
 \item Gentoo wiki \url{http://gentoo-wiki.com/HOWTO_Install_Gentoo_-_The_Gentoo_Developers_Method_with_NPTL_and_2.6_from_Stage1}
\end{itemize}

\dancersection{グループワーク}{全員}
\label{sec:groupwork}

\dancersection{次回}{}

未定です。
内容は本日決定予定です。

参加者募集はまた後程。

\newpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont 2006年10月21日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
