%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定．

% This document is distributed under the terms of GPL version 2 or
%later.
% Copyright 2005 Junichi Uekawa and others.

%   Pdf作成手順
% dvipdfmx debianmeetingresume200510.dvi

%%ここからヘッダ開始．

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要

%% spacing の設定をする．外枠を減らす．
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義．画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}

% 三択問題用
\newcounter{santakucounter}
\newcommand{\santaku}[4]{%
\addtocounter{santakucounter}{1}

\nopagebreak 問題\arabic{santakucounter}. 
#1\\
\nopagebreak□ A #2\\
\nopagebreak□ B #3\\
\nopagebreak□ C #4
\pagebreak[1]
\hspace{1cm}
\\

}

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}



\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\Large\headfont\raggedright\centering}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
東京エリアDebian勉強会 2005
\hrule
\vspace{0.5mm}
\hrule
\hfill{}\includegraphics[width=3cm]{image200502/openlogo-nd.eps}\\
\vspace{-4cm}
\begin{center}
  \section{#1}
\end{center}
\hfill{}#2\hspace{3cm}\space\\
\hrule
\hrule
\vspace{1cm}
}

%%

\begin{document}

\begin{titlepage}

% 毎月変更する部分
\title{\includegraphics[width=7cm]{image200502/openlogo-nd.eps}\\
 第9回 東京エリア Debian 勉強会\\事前資料}
\date{2005年10月15日}
\author{Debian勉強会会場係 上川純一\thanks{Debian Project Official Developer}} 
\maketitle
\thispagestyle{empty}

\end{titlepage}

\newpage
\tableofcontents

\dancersection{Introduction To Debian 勉強会}{上川純一}

今月のDebian勉強会へようこそ．
これからDebianのあやしい世界に入るという方も，すでにどっぷりとつかってい
るという方も，月に一回Debianについて語りませんか？

目的として下記の二つを考えています．

\begin{itemize}
 \item メールではよみとれない，もしくはよみとってられないような情報を情
       報共有する場をつくる
 \item まとまっていないDebianを利用する際の情報をまとめて，ある程度の塊と
       して出してみる
\end{itemize}

また，東京にはLinuxの勉強会はたくさんありますので，Debianに限定した勉強
会にします．Linuxの基本的な利用方法などが知りたい方は，他でがんばってくださ
い．
Debianの勉強会ということで究極的には参加者全員がDebian Packageを
がりがりと作りながらスーパーハッカーになれるような姿を妄想しています．

Debianをこれからどうするという能動的な展開への土台としての空間を提供し，
情報の共有をしたい，というのが目的です．
次回は違うこと言ってるかもしれませんが，御容赦を．

\subsection{講師紹介}

\begin{itemize}
 \item{謎の講師} apt-listbugsを開発した人です．
 \item{上川純一} 宴会の幹事です．
\end{itemize}

\subsection{事前課題紹介}

今回の事前課題は
「Debianのバグシステムに物申す」
というタイトルで200-800文字程度の文章を書いてください．
というものでした．
その課題に対して下記の内容を提出いただきました．

\subsubsection{}

\subsubsection{上川}

あとで埋める予定．

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで，Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが，一人で読んでいても，解説が少
ないので，
意味がわからないところもあるかも知れません．みんなでDWNを読んでみましょう．

漫然と読むだけではおもしろくないので，DWNの記事から出題した以下の質問にこたえてみてください．
後で内容は解説します．

\subsection{2005年37号}
2005年9月13日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}

\subsection{2005年38号}
2005年9月13日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
\subsection{2005年39号}
2005年9月20日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}

\subsection{2005年40号}
2005年9月27日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}

\subsection{2005年41号}
2005年10月4日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}

\subsection{2005年42号}
2005年10月11日?です．
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}
 \santaku{}{}{}{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}


\subsection{東京エリアDebian勉強会8回目報告}


前回開催した第8回目の勉強会の報告をします．


\dancersection{apt-listbugs}{たるさん?}
\label{sec:taruishi}
%% taruishiさんの記事はここから 
%% end

\dancersection{debbugsの内部構造}{上川}
\label{sec:uekawa}

%% 上川の記事はここから 
\subsection{はじめに}

この文書は Anthony Towns が フィンランドの debconf 5 で発表した内容を
日本にて展開するための資料です．
Anthony Townsの作成した英語の資料を省略して抜粋しています．
また，それ以降に変更した事項について追記しています．


Debian Bug Tracking System (BTS)は，ほぼDebianに特化したバグ報告の管理
のためのシステムです．
他のプロジェクトでも利用されていることもありますが，Debianでバグがパッケージベー
スで厳格に分類できることなどの特性が反映されているため，Debianプロジェク
トでいちばんつかいやすいように作られています．

Debian のインフラと統合されており，changelogにバグ番号を記述してパッケー
ジをアップロードしたらバグが修正されたと認識されるようになっていたりします．

規模としては，55000以上の現在アクティブなバグ報告，
231000アーカイブされたバグ報告を現在保持していて，
毎週1000以上の新規のバグ報告が追加されています．
ウェブインタフェースはすぐに追加された報告を反映しており，
過去，ダウンタイムもほとんど発生していません．

Anthony Townsによると下記が要件です．

\begin{itemize}
 \item インタフェース： 開発者がメールで操作できるようになっており，誰で
       もウェブで閲覧できるようになっている．
 \item パッケージベース： バグ報告をパッケージ別に高速に管理する必要があ
       る
 \item スケーラビリティー: 大量のバグ報告に対応できる必要がある
 \item 即時性： 現在のバグの状態をすぐに報告してくれる必要があり，バグの
       状態が変更されたらすぐに反映される必要がある
 \item 安定性： 継続して動作する必要がある．新規の機能がどんどん追加さ
       れたとしても．
 \item 公開： 議論の内容にDebianコミュニティー全体として参加できるように，
       永続的な公開記録として保存される必要がある．
\end{itemize}

\subsection{データ形式}

バグデータベースのスプールの形式は下記です．
リレーショナルデータベースなどは利用していません，
スプールディレクトリ以下にほとんどのデータが格納されています．

各バグについて，ファイルはそれぞれ
４個あります．
サマリーファイルはメタデータを保存します．
ログファイルは，そのバグに対して流れたメールを全て保存します．

statusファイルは互換性のためだけに存在しています．
reportファイルは，最初のバグ報告のメールで，バグが close されるときに送
信されるものです．

\begin{itemize}
 \item /org/bugs.debian.org/spool
       \begin{itemize}
	\item incoming/
	      \begin{itemize}
	       \item T.*
	       \item S[BMQFDU RC] *.*
	       \item R[BMQFDU RC] *.*
	       \item I[BMQFDU RC] *.*
	       \item G[BMQFDU RC] *.*
	       \item P[BMQFDU RC] *.*
	      \end{itemize}
	\item db-h/
	      \begin{itemize}
	       \item 00/
		     \begin{itemize}
		      \item ..
		      \item 314200.log
		      \item 314200.report
		      \item 314200.status
		      \item 314200.summary
		     \end{itemize}
	       \item ..
	       \item 99/
	      \end{itemize}
	\item archive/
	      \begin{itemize}
	       \item 00/
	       \item ..
	       \item 99/
	      \end{itemize}
	\item index.db -- index.db.realtime
	\item index.archive -- index.archive.realtime
	\item nextnumber
       \end{itemize}
\end{itemize}

\subsubsection{incoming}

incomingに来たメールは処理中，名前を変えます．

\begin{itemize}
 \item T receiveによってうけとられた
 \item S SPAM確認待ち
 \item R SPAM確認中
 \item I SPAMチェック通った
 \item G service か process スクリプトを通った
 \item P process中
\end{itemize}

また，ファイル名の二つ目の文字はどこのメールアドレスにメールが送信されて
きたものなのかということを示します．
ファイル名ののこりは，バグ番号と，一意なIDです．
一意なIDを決定するのに現在は時間とプロセス番号を利用しています．

\begin{itemize}
 \item B: 通常のバグ報告．submit@ 1234@
 \item M: -maintonly メーリングリストに投げない
 \item Q: BTSに登録しない．-quiet
 \item F: アップストリームにフォーワード -forwarded
 \item D: バグ終了 -done
 \item U: サブミッターにメール -submitter
 \item R: ユーザのリクエスト用インタフェース request@
 \item C: デベロッパーの制御用インタフェース control@
\end{itemize}

\subsubsection{StatusとSummary}

statusファイルの中身は行ベースです．
無い行については空行とみなします．
このファイルは今後なくしていこうとしています．

\begin{itemize}
 \item バグ報告者のメールアドレス
 \item 時間(秒)
 \item サブジェクト
 \item 元のメールのメッセージID
 \item バグがアサインされているパッケージ
 \item タグ
 \item closeした人のメールアドレス
 \item 上流のメールアドレスかURL(forwardされたばあい)
 \item マージされているバグ番号
 \item severity
\end{itemize}

summary ファイルはRFC822形式で，拡張可能になっています．
現在Format-Version: 2 と 3 の二つの形式があります．
3は，ヘッダについてはRFC1522(MIME)のデコードされた形式になっています．

\begin{itemize}
 \item Format-Version: このファイル形式のバージョン
 \item Submitter: バグ報告者のメールアドレス
 \item Date: 時間(秒)
 \item Subject: サブジェクト
 \item Message-ID: 元のメールのメッセージID
 \item Package: バグがアサインされているパッケージ
 \item Tags: タグ
 \item Done: closeした人のメールアドレス
 \item Forwarded-To: 上流のメールアドレスかURL(forwardされたばあい)
 \item Merged-With: マージされているバグ番号
 \item Severity: severity
 \item Owner: バグの所有者
\end{itemize}

\subsubsection{logファイル}

あらゆるメールがlogファイルには追記されていきます．
また，メタデータも追記されていきます．
残念ながら，メタデータは生のHTMLで書かれており，
またバージョンによって記述の仕方が変わっており，
さらに悪いことに，古いバグの中にあるテキストは更新されていないため，
機械的に処理することは難しくなっています．

また，コントロール情報は，行頭のエスケープコードにより切り替わります．
メールの中にエスケープコードのような文字列が出て来たら，それは
030を追加してエスケープします．

詳細はDebbugs::Logを見てください．

\begin{itemize}
 \item kill-init: まだ一行も処理していません
 \item incoming-recv: 07: あとにgoがくる，Received:行
 \item autocheck: 01: X-Debian-Bugs-..: までの無視されている行，
       autowaitが次に来る
 \item html: 06: 生で表示すべきHTML
 \item recips: 02: メールの受取人，04で分割されている
 \item go: 05: メールの文書
 \item go-nox: X: メールの文書，Xではじまる行
 \item kill-end: 03: メッセージの終り．
 \item autowait: go-noxがあとにくる，空行まで無視されるその他の情報．
\end{itemize}

\subsubsection{Indexファイル}

indexファイルは，pkgreport.cgiがどのパッケージにどのバグがわりあてられて
いるかを確認するための情報です．

以前は，by-package.idxとby-severity.idxというのがあり，高速化に貢献する
はずだった．
一年以上長い間生成されていなかった．，誰も気づかなかったので必要ないんじゃ
ないだろう．

データ形式としては下記のようになります．
パッケージ，バグ番号，時間，ステータス，メールアドレス，severityの順に書
いた行が全てのバグに対して作成されています．

\begin{commandline}
 
 pbuilder 317998 1121196782 open [Junichi Uekawa <dancer@netfort.gr.jp>] normal
\end{commandline}

\subsection{コード形式}

debbugsは特に設計もされずに長い間パッチを累積してきました．
ただ，明確にわかれている部分はあって，メールを処理するコアのインタフェー
スのスクリプトと，
ウェブを表示するためのCGI部分とで分離できます．

設定ファイルは全て/etc/debbugs にあります．

\subsubsection{コアのスクリプト}

メールを処理する部分があります．

\begin{itemize}
 \item errorlib: ライブラリ
 \item receive: MTAからメールを受信する
 \item spamscan: 受信メールをSPAMチェックする
 \item processall: process と service にメールを分配する
 \item process: バグメールを処理する
 \item service: control@ と report@ メールを処理
 \item expire: closeされてから28日過ぎたバグをエキスパイア処理する
 \item rebuild: indexファイルをリビルド
\end{itemize}

receive と rebuild 以外は cronから起動しています．
１５分に一回しか動作しません．


\subsubsection{CGIスクリプト}

CGI関連は，
errorlib関数を活用している部分もありますが，ほぼ独立しています．

\begin{itemize}
 \item bugreport.cgi: バグレポートを一つ表示
 \item pkgreport.cgi: パッケージやサブミッタなどでサマリを作成する
 \item pkgindex.cgi: パッケージやseverityに対して数を表示
 \item common.pl: ライブラリとして利用
\end{itemize}

pkgreport.cgiは特に速度が重要視される部分なので，注意．

\subsubsection{ハックするには}

debbugsのソースはCVSにあります．
また，Debian Developerであれば，
ミラーが merkel.debian.orgの/org/bugs.debian.org以下にあります．



\subsection{そして何がおきたか}

Googleがmaster.debian.orgにとってDoSになるような検索の仕方をしていたので，
現在BTSはgoogleの検索対象にははいっていないので検索サービスが必要だろう．

バージョントラッキングは重要な機能だろう．


%% ここまで

\newpage 

\dancersection{次回}{}

関西出張会議を10月29日に実施する予定です．

また，東京での次回は11月12日土曜日の夜を予定しています．
内容は本日決定予定です．

参加者募集はまた後程．

\end{document}
