%; whizzy paragraph
%; whizzy-paragraph "^\\\\dancersection"
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Kansai Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2012 Nobuhiro Iwamatsu
%     Copyright (C) 2012 Koichi Akabe

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image2012-natsu; ebb *.png")

% progress memo:
% 2018/12-2019/05東京がマージ対象
% 2019/07リリースパーティネタも可能なら収録
% イベント等でない場合は理由を書くこと。
% 必要な変更点は FIXME で記録しています。

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
\usepackage{supertabular}
\usepackage{subfigure}
\renewcommand*\thesubfigure{}

\usepackage{comment}

% section の代わりの環境 -- 改訂する。
\renewcommand{\dancersection}[2]{%
\newpage
あんどきゅめんてっど でびあん 2019年夏号
%
% top line
\vspace{0.1mm}\\
{\color{dancerdarkblue}\rule{\hsize}{2mm}}

%
% middle text
%
\begin{minipage}[t]{0.6\hsize}
\color{dancerdarkblue}
\vspace{1cm}
\section{#1}
\hfill{}#2\\
\end{minipage}
\begin{minipage}[t]{0.4\hsize}
\vspace{-2cm}
\hfill{}\includegraphics[height=8cm]{image200502/openlogo-nd.eps}\\
\vspace{-5cm}
\end{minipage}
%
% bottom line
{\color{dancerlightblue}\rule{0.66\hsize}{2mm}}
%
\vspace{2cm}
}
% end of dancersection.

\begin{document}

\begin{titlepage}
\thispagestyle{empty}

\hspace*{-2.5cm}
\includegraphics{image2012-natsu/gudeb.eps}\\
\vspace*{0.1cm}

\vspace*{2cm}
\rotatebox{10}{\fontsize{32}{32} {\gt 東京エリア/関西Ｄｅｂｉａｎ勉強会}}

\vspace*{-1.5cm}
\hspace*{11cm}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}\\
\vspace*{0.1cm}
\hfill あんどきゅめんてっど でびあん 2019年夏号 2019年8月12日 初版発行
\end{titlepage}

\newpage
\thispagestyle{empty}\mbox{}
\newpage

\setcounter{page}{1}
\begin{minipage}[]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{dancerlightblue}{\rotatebox{90}{\fontsize{80}{80}
{\gt \color{dancerdarkblue}デビアン勉強会} }}
\end{minipage}
\begin{minipage}[]{0.8\hsize}
\hrule
\vspace{1mm}
\hrule
\setcounter{tocdepth}{1}
{\small
\begin{multicols}{2}
  \tableofcontents
\end{multicols}
} %FIXME: does not fit in one column! しかし二段にするとあまり美しくない？ 真ん中のあたりで章番号とページ数の番号が近くにあるのがバランス良くない気がする
\vspace{1mm}
\hrule
\vspace{3cm}

\end{minipage}

% FIXME: 本文を追加すること。
%-------------------------------------------------------------------------------
\dancersection{Introduction}{ }
%-------------------------------------------------------------------------------

\subsection{東京エリアDebian勉強会}

 Debian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

\begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
\end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\subsection{関西 Debian 勉強会}

 関西 Debian 勉強会はDebian GNU/Linux のさまざ
 まなトピック(新しいパッケージ、Debian 特有の機能の仕組、Debian 界隈で起
 こった出来事、などなど）について話し合う会です。

 目的として次の三つを考えています。
 \begin{itemize}
  \item メーリングリストや掲示板ではなく、直接顔を合わせる事での情報交換の促進
  \item 定期的に集まれる場所
  \item 資料の作成
 \end{itemize}

 それでは、楽しい一時をお楽しみ下さい。

%201903 tokyo
%-------------------------------------------------------------------------------
\dancersection{systemdとsysvinitのデーモンで動作するDebianパッケージの作り方を調べてみる}{杉本　典充}
%-------------------------------------------------------------------------------

\subsection{はじめに}

デーモンプログラムをdebianパッケージ化するにはどのようにパッケージを作成すればよいのか理解していないため、調べてみました。


\subsection{Debianにおけるinitの仕組み}

一般的にUNIX/Linux系のOSにおいてカーネルが最初に呼び出す「init」というユーザランドプログラム\footnote{一般的にプロセス番号 「1」の場合が多いです。}があり、このinitが常駐プログラム（＝デーモン）の起動や停止を管理します。


Debianにおけるinitシステムの解説は、Debian リファレンスの「第3章 システムの初期化」に記述があります\footnote{\url{https://www.debian.org/doc/manuals/debian-reference/ch03.ja.html}}。

Debianで採用しているinitシステムは、昔から存在する「sysvinit」、新世代の「systemd」があり\footnote{他にもOpenRCというinitもあります。}、Debian 8からはsystemdを標準のinitシステムとして採用しています\footnote{systemdが標準なのはDebian GNU/Linuxの場合です。systemdはlinuxカーネル専用のプログラムのため、kFreeBSDやHurdでは動きません。}。


Debianではsystemdとsysvinitを切り替えることができます\footnote{\url{https://wiki.debian.org/Init}}。そのためデーモンプログラムのdebianパッケージを作るときは、systemdとsysvinitのどちらの環境でもデーモンを起動できるようパッケージを作る必要があります。


\subsection{Debianにおけるinitが呼び出す起動・停止の設定ファイル}

\subsubsection{systemd: /lib/systemd/system/[package].service}

Debianのsystemdが管理するデーモンの起動・終了は、"systemctl" コマンドで行います。


systemctlコマンドで管理するデーモンの設定ファイルは、"/lib/systemd/system/[package].service" に置いています。この "[package].service" ファイルにプログラムのファイルパスや環境設定ファイル、実行するコマンドを記述します\footnote{serviceファイルの記述方法は、\url{https://www.freedesktop.org/software/systemd/man/systemd.service.html} を参照。}。


例として、nginx-fullパッケージを見てみましょう。


nginxを起動する場合は以下のコマンドを実行します。

\begin{commandline}
# systemctl start nginx
\end{commandline}

nginxを停止する場合は以下のコマンドを実行します。

\begin{commandline}
# systemctl stop nginx
\end{commandline}


上記のsystemctlコマンドを実行したとき、以下の"nginx.service"に従ってnginxの起動・終了をsystemdが行っています。


\begin{commandline}
$ cat /lib/systemd/system/nginx.service | grep -v "\#"

[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network.target nss-lookup.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'
ExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload
ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid
TimeoutStopSec=5
KillMode=mixed

[Install]
WantedBy=multi-user.target  
\end{commandline}


\subsubsection{sysvinit: /etc/init.d/[package]}

Debianのsysvinitが管理するデーモンの起動・終了は、"service"コマンドで行います\footnote{Debian GNU/Linux 8 以降ではsystemdがデフォルトのため \url{https://wiki.debian.org/Init} の手順を行うとsysvinitに変更できます。}。


serviceコマンドで管理するデーモンの設定ファイルは、"/etc/init.d/[package]"に置いています。この"[package]"ファイルはシェルスクリプトであり、プログラムのファイルパスや環境設定ファイル、実行するコマンドを記述します。


serviceコマンドから呼び出すスクリプトを作成するにあたり、以下のヘルパースクリプトがあります。

\begin{itemize}
  \item /lib/init/vars.sh
  \item /lib/lsb/init-functions
  \item /sbin/start-stop-daemon
\end{itemize}


例として、nginx-fullパッケージを見てみましょう。


nginxを起動する場合は以下のコマンドを実行します（systemctlの場合とコマンドの順番が違います）。

\begin{commandline}
# service nginx start
\end{commandline}

nginxを停止する場合は以下のコマンドを実行します。

\begin{commandline}
# service nginx stop
\end{commandline}


上記のserviceコマンドを実行したとき、nginxの起動・終了を "/etc/init.d/nginx" が行っています。

※長いため一部省略しています。

\begin{commandline}
$ cat /etc/init.d/nginx

#!/bin/sh

### BEGIN INIT INFO
# Provides:       nginx
# Required-Start:    $local_fs $remote_fs $network $syslog $named
# Required-Stop:     $local_fs $remote_fs $network $syslog $named
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: starts the nginx web server
# Description:       starts nginx using start-stop-daemon
### END INIT INFO

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=/usr/sbin/nginx
NAME=nginx
DESC=nginx

# Include nginx defaults if available
if [ -r /etc/default/nginx ]; then
        . /etc/default/nginx
fi

STOP_SCHEDULE=''${STOP_SCHEDULE:-QUIT/5/TERM/5/KILL/5}''

test -x $DAEMON || exit 0

. /lib/init/vars.sh
. /lib/lsb/init-functions

# Try to extract nginx pidfile
PID=$(cat /etc/nginx/nginx.conf | grep -Ev '^\s*#' | awk 'BEGIN { RS=''[;{}]'' } { if ($1 == ``pid'') print $2 }' | head -n1)
if [ -z ``$PID'' ]; then
    PID=/run/nginx.pid
fi

if [ -n ``$ULIMIT'' ]; then
    # Set ulimit if it is set in /etc/default/nginx
    ulimit $ULIMIT
fi

start_nginx() {
    # Start the daemon/service
    #
    # Returns:
    #   0 if daemon has been started
    #   1 if daemon was already running
    #   2 if daemon could not be started
    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON --test > /dev/null \
        || return 1
    start-stop-daemon --start --quiet --pidfile $PID --exec $DAEMON -- \
        $DAEMON_OPTS 2>/dev/null \
        || return 2
}

  (snip)

stop_nginx() {
    # Stops the daemon/service
    #
    # Return
    #   0 if daemon has been stopped
    #   1 if daemon was already stopped
    #   2 if daemon could not be stopped
    #   other if a failure occurred
    start-stop-daemon --stop --quiet --retry=$STOP_SCHEDULE --pidfile $PID --name $NAME
    RETVAL=''$?''
    sleep 1
    return ``$RETVAL''
}

(snip)

case ``$1'' in
    start)
        log_daemon_msg ``Starting $DESC'' ``$NAME''
        start_nginx
        case ``$?'' in
            0|1) log_end_msg 0 ;;
            2)   log_end_msg 1 ;;
        esac
        ;;
    stop)
        log_daemon_msg ``Stopping $DESC'' ``$NAME''
        stop_nginx
        case ``$?'' in
            0|1) log_end_msg 0 ;;
            2)   log_end_msg 1 ;;
        esac
        ;;

(snip)

    *)
        echo ``Usage: $NAME {start|stop|restart|reload|force-reload|status|configtest|rotate|upgrade}'' >&2
        exit 3
        ;;
esac
\end{commandline}


\subsection{init設定を行うdebianパッケージ作成方法}

\subsubsection{前提}

Debian GNU/Linux 9 (stretch) の環境を前提とします。


debianパッケージを作成するツールは、ほとんどのパッケージでdebhelperが使われています\footnote{\url{https://www.debian.org/doc/manuals/packaging-tutorial/packaging-tutorial.ja.pdf} の2019年3月4日の資料において　debhelperの採用率は98\%との数字があります。} 。今回は、debhelperを使ってパッケージ作成を行うことを前提として説明します。


debianパッケージを作成するにあたり、基本的な事項を知るドキュメントは以下になりますので読んでみてください。

\begin{itemize}
\item \url{https://wiki.debian.org/ja/Packaging}
\item packaging-tutorialパッケージのPDFファイル \\/usr/share/doc/packaging-tutorial/packaging-tutorial.ja.pdf\footnote{web版はこちら。 \url{https://www.debian.org/doc/manuals/packaging-tutorial/packaging-tutorial.ja.pdf}}
\item Debian 新メンテナーガイド \\\url{https://www.debian.org/doc/manuals/maint-guide/index.ja.html}
\item Debian Policy Manual \\\url{https://www.debian.org/doc/debian-policy/}
\end{itemize}  


debhelperでdebianパッケージの作成を行う場合は以下のパッケージをインストールしておくとよいでしょう\footnote{昔はsystemdに対応する場合にはdh-systemdパッケージが必要でしたが、stretchではdebhelperに統合されているためインストール不要です。}。


\begin{commandline}
# apt-get update
# apt-get install build-essential dpkg-dev devscripts debhelper dh-make quilt
\end{commandline}


\subsubsection{systemdに対応する設定}

以下のwebページに解説ドキュメントがありますので、これを解説していきます。

\begin{itemize}
\item \url{https://wiki.debian.org/Teams/pkg-systemd/Packaging}
\end{itemize}


systemdの設定を行うには通常のパッケージ作成作業のほか、以下を追加で作業する必要があります。

\begin{itemize}
\item debian/rulesの修正
\item debian/controlの修正
\item \bf{"debian/package.service"} の作成
\end{itemize}


\subsubsubsection{debian/rulesの修正}

debian/rulesファイルは、dh\_makeコマンドを実行したときにひな形ファイルが作成されます。


systemdで管理するデーモンの場合は、以下のように "--with systemd" の定義を追加します。この "--with" オプションは debhelper の addon の処理を実行するように指定するものです\footnote{man dh(1) を参照。}。

\begin{commandline}
%:
    dh $@ --with systemd
\end{commandline}


この "--with systemd" の addon 指定がある場合は debian パッケージのビルド処理で "dh\_systemd\_enable"、 "dh\_systemd\_start" を実行するようになります。


"dh\_systemd\_enable" は、"\# systemctl \{enable/disable\} package" を実行するよう指定するもので、次回のOS起動時に自動で package のデーモンを起動するか指定できます。


"dh\_systemd\_start" は、"\# systemctl \{start/stop/restart\} package" を実行するよう指定するコマンドで、パッケージのインストール処理でデーモンを起動するか、再起動するかなどを指定できます。


\subsubsubsection{debian/controlの修正}

"debian/control"ファイルは、dh\_makeコマンドを実行したときにひな形ファイルが作成されます。


"debian/control" ファイルを書く上で、debhelperの互換性レベルを記述する"debian/compat" ファイルがあります。この"debian/compat"ファイルの中身が"10"以上であれば "debian/control" ファイルを次のように書きます。

\begin{commandline}
Build-Depends: debhelper (>= 9.20160709)
\end{commandline}

もし、"debian/compat" の中身が "10" 未満であれば systemd 向けの処理は別途 dh-systemd パッケージが必要なため\footnote{Debian 8 jessie 向けのパッケージを作成する場合が該当します。}、次のように書きます。

\begin{commandline}
Build-Depends: debhelper (>= 9.20150101), dh-systemd (>= 1.5)
\end{commandline}


\subsubsubsection{debian/package.service の作成}


"package.service" ファイルは、dh\_makeコマンドを実行したときにひな形ファイルが作成されません。

そのため、他のパッケージの "package.service" ファイルを参考にしつつ、serviceファイルのマニュアルをみて作成してください\footnote{\url{https://www.freedesktop.org/software/systemd/man/systemd.service.html}}

"package.service" ファイルを作成しておくと、debian パッケージのビルド処理中の "dh\_installinit" の処理で "package.service" ファイルを "/lib/systemd/system" 配下へインストールするよう処理します。


\subsubsection{sysvinitに対応する設定}


sysvinitの設定を行うには、通常のパッケージ作成作業のほか、以下を追加で作業する必要があります。

\begin{itemize}
\item \bf{"debian/package.init"} の作成
\end{itemize}


\subsubsubsection{debian/package.init の作成}


"packages.init" ファイルは、dh\_makeコマンドを実行したときにひな形ファイルが作成されません\footnote{過去にはdh\_makeコマンドで"debian/init.d.ex" というひな形ファイルが作成されたのですが、Debian 8におけるsystemdへの移行の過程で作成されなくなりました。}。


他のパッケージのinitファイルを参考にするか、古いバージョンのdebhelperに含まれる"init.d.ex" ファイルを取得して作成してください\footnote{\url{https://sources.debian.org/data/main/d/dh-make/1.20140617/lib/debian/init.d.ex}}。


"package.init" ファイルを作成しておくと、debianパッケージのビルド処理中の "dh\_installinit"の処理で "package.init" ファイルを "/etc/init.d" 配下へインストールするよう処理します。


\subsection{まとめ}

Debianにおけるinitの説明とデーモンの起動・終了を行うdebianパッケージをdebhelperでどう作るか説明しました。debian/[package].service ファイル、debian/[package].init ファイルの存在を覚えておくとよいと思います。


debhelperを使ったdebianパッケージのビルドでは  dh\_installinit の処理で systemd/sysvinit の設定ファイルをパッケージに配置しています。


また、１つのソースパッケージから複数のバイナリパッケージを作る場合にファイル名の命名規則が異なるなど違いも出てきます。それらについては他のパッケージを参考にして覚えていくとよいと思います。


\subsection{参考文献}

\begin{itemize}
\item 「Teams pkg-systemd Packaging」 \url{https://wiki.debian.org/Teams/pkg-systemd/Packaging}
\item mkouhei (2014) 「How to create a Debian package of support to sysvinit, upstart, systemd」 \url{https://d.palmtb.net/2014/01/30/how_to_create_a_debian_package_of_support_to_sysvinit__upstart__systemd.html}
\item @henrich (2016) 「dh-systemdはdebhelper 9.20160709で統合された」 \url{https://qiita.com/henrich/items/e1651e3284c6b3d0d39e}
\end{itemize}

%201904 debianmeetingresume201904-knok.tex
\dancersection{debootstrapを用いたUSB起動メモリの作成}{野首 貴嗣}

%201905 
%-------------------------------------------------------------------------------
\dancersection{/usr Mergeについて}{yy\_y\_ja\_jp}
%-------------------------------------------------------------------------------

Debian では Buster から ``/usr Merge'' がデフォルトになりそうです。概要と状況を整理します。

\subsection{概要}

``/usr Merge'' とは、\verb|/bin/|, \verb|/sbin/|, \verb|/lib/| などの中にあるもの（バイナリ等）を \verb|/usr/| 内に移す、つまり \verb|/usr/| 内にバイナリ等をすべて統合することです。
例えば \verb|/bin/ls| を \verb|/usr/bin/ls| に移します。また、今まで通り \verb|/bin/ls| でも使えるように互換性のため \verb|/bin| は \verb|/usr/bin| へのシンボリックリンクにします。\verb|/sbin| なども同様です。

なお、このような構成にしたい理由はsystemdのwiki\footnote{\url{https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/}}などにまとめられているようです
\footnote{Debian wiki \url{https://wiki.debian.org/UsrMerge}}。

Debianを新規インストールするときには、Debianインストーラが内部で実行するdebootstrapがこの構成を行います。既存のDebian環境にはusrmergeパッケージをインストールすればこの構成にしてくれます\footnote{Busterの次のバージョンBullseyeではインストール推奨となるかもしれません。\url{https://bugs.debian.org/841666}}。なお、以前の構成へ元に戻すことは困難です。

Stretch インストーラで作った Debian 環境の \verb|/| 直下は次のようなディレクトリ構成でした。
\begin{commandline}
$ ls -l /
合計 76
drwxr-xr-x  2 root root  4096  5月 14 00:42 bin
drwxr-xr-x  3 root root  4096  5月 14 00:43 boot
drwxr-xr-x 17 root root  2980  5月 14 00:56 dev
drwxr-xr-x 76 root root  4096  5月 14 00:56 etc
drwxr-xr-x  3 root root  4096  5月 14 00:43 home
lrwxrwxrwx  1 root root    29  5月 14 00:38 initrd.img -> boot/initrd.img-4.9.0-9-amd64
lrwxrwxrwx  1 root root    29  5月 14 00:38 initrd.img.old -> boot/initrd.img-4.9.0-9-amd64
drwxr-xr-x 15 root root  4096  5月 14 00:42 lib
drwxr-xr-x  2 root root  4096  5月 14 00:36 lib64
drwx------  2 root root 16384  5月 14 00:35 lost+found
drwxr-xr-x  3 root root  4096  5月 14 00:35 media
drwxr-xr-x  2 root root  4096  5月 14 00:35 mnt
drwxr-xr-x  2 root root  4096  5月 14 00:35 opt
dr-xr-xr-x 80 root root     0  5月 14  2019 proc
drwx------  2 root root  4096  5月 14 00:35 root
drwxr-xr-x 14 root root   460  5月 14 00:57 run
drwxr-xr-x  2 root root  4096  5月 14 00:56 sbin
drwxr-xr-x  2 root root  4096  5月 14 00:35 srv
dr-xr-xr-x 13 root root     0  5月 14 00:57 sys
drwxrwxrwt  8 root root  4096  5月 14 00:56 tmp
drwxr-xr-x 10 root root  4096  5月 14 00:35 usr
drwxr-xr-x 11 root root  4096  5月 14 00:35 var
lrwxrwxrwx  1 root root    26  5月 14 00:38 vmlinuz -> boot/vmlinuz-4.9.0-9-amd64
lrwxrwxrwx  1 root root    26  5月 14 00:38 vmlinuz.old -> boot/vmlinuz-4.9.0-9-amd64
$ 
\end{commandline}

一方、Buster インストーラで作った Debian 環境では次のようになります。なお、現時点ではインストーラに ``/usr Merge'' しないようにする設定はなさそうです\footnote{\url{https://bugs.debian.org/923091}}。
\begin{commandline}
$ ls -l /
合計 60
lrwxrwxrwx  1 root root     7  5月 14 00:36 bin -> usr/bin
drwxr-xr-x  3 root root  4096  5月 14 00:43 boot
drwxr-xr-x 17 root root  3160  5月 14 00:56 dev
drwxr-xr-x 67 root root  4096  5月 14 00:56 etc
drwxr-xr-x  3 root root  4096  5月 14 00:43 home
lrwxrwxrwx  1 root root    30  5月 14 00:38 initrd.img -> boot/initrd.img-4.19.0-4-amd64
lrwxrwxrwx  1 root root    30  5月 14 00:38 initrd.img.old -> boot/initrd.img-4.19.0-4-amd64
lrwxrwxrwx  1 root root     7  5月 14 00:36 lib -> usr/lib
lrwxrwxrwx  1 root root     9  5月 14 00:36 lib32 -> usr/lib32
lrwxrwxrwx  1 root root     9  5月 14 00:36 lib64 -> usr/lib64
lrwxrwxrwx  1 root root    10  5月 14 00:36 libx32 -> usr/libx32
drwx------  2 root root 16384  5月 14 00:36 lost+found
drwxr-xr-x  3 root root  4096  5月 14 00:36 media
drwxr-xr-x  2 root root  4096  5月 14 00:36 mnt
drwxr-xr-x  2 root root  4096  5月 14 00:36 opt
dr-xr-xr-x 79 root root     0  5月 14  2019 proc
drwx------  2 root root  4096  5月 14 00:36 root
drwxr-xr-x 15 root root   460  5月 14 00:58 run
lrwxrwxrwx  1 root root     8  5月 14 00:36 sbin -> usr/sbin
drwxr-xr-x  2 root root  4096  5月 14 00:36 srv
dr-xr-xr-x 13 root root     0  5月 14 00:56 sys
drwxrwxrwt  8 root root  4096  5月 14 00:56 tmp
drwxr-xr-x 13 root root  4096  5月 14 00:36 usr
drwxr-xr-x 11 root root  4096  5月 14 00:36 var
lrwxrwxrwx  1 root root    27  5月 14 00:38 vmlinuz -> boot/vmlinuz-4.19.0-4-amd64
lrwxrwxrwx  1 root root    27  5月 14 00:38 vmlinuz.old -> boot/vmlinuz-4.19.0-4-amd64
$ 
\end{commandline}

\subsection{経緯}

``/usr Merge'' は以前Fedoraで特に行われていたようです\footnote{\url{https://fedoraproject.org/wiki/Features/UsrMove}}。なおFedoraは必須化したようです。

Debianでは当初Stretchでデフォルトにする予定でしたが、問題の解決が間に合いそうになく延期されました\footnote{\url{https://lists.debian.org/debian-devel-announce/2017/01/msg00004.html}}。

その後Busterに向けてdebootstrap 1.0.102で再度デフォルトにすることにしました\footnote{\url{https://bugs.debian.org/839046}}が、問題があるためデフォルトでなくすべきではという議論があり、Debian技術委員会(tech-ctte)にも持ち込まれました\footnote{\url{https://bugs.debian.org/914897}}。

%
Debian技術委員会は、debootstrapのメンテナーが決めたことは覆さない、
%つまり強権発動はしない
と決定しました\footnote{\url{https://lists.debian.org/debian-devel-announce/2019/03/msg00001.html}}。
同時に、Debianにおける``/usr Merge''の現状と今後の望ましい姿を示しました。

\subsection{現状}
Debian技術委員会の決定により、debootstrapメンテナー次第で``/usr Merge''がデフォルトになるかどうかは決まります。現時点で testing (Buster) 以降のバージョン向けにdebootstrapを実行すると次のようになっており、メンテナーが変更しなければこのままBusterリリースとなります。

\begin{itemize}
 \item 通常の環境では``/usr Merge''がデフォルト有効（無効にするには \verb|--no-merged-usr|オプションを付ける）
 \item パッケージビルド用の環境（\verb|--variant=buildd| オプション）ではデフォルト無効
\end{itemize}

なお、現状では``/usr Merge''された環境でビルドされたバイナリパッケージを``/usr Merge''されていない環境に持っていくと動作しないものがあり、それらのパッケージに随時バグ報告してくれている方がいるようです\footnote{\url{https://bugs.debian.org/cgi-bin/pkgreport.cgi?tag=usrmerge;users=md@linux.it}}
。よくある理由としては、ビルド中にバイナリの場所を \verb|/bin/| の中よりも先に \verb|/usr/bin/| を探しに行き、``/usr Merge''された環境では \verb|/usr/bin/| のパスをコンパイル結果に埋め込むからです。
例えば quilt パッケージの少し古い修正\footnote{\url{https://bugs.debian.org/913226}}以前のバージョン 0.65-2 を``/usr Merge''された環境でビルドしてみます。\verb|dh_auto_configure| 経由で実行された \verb|./configure| が \verb|/bin/bash| ではなく \verb|/usr/bin/bash|、\verb|/bin/cp| ではなく \verb|/usr/bin/cp|、などを検出してビルドしています。
この場合はビルドされたパッケージ内のシェルスクリプトの先頭が \verb|#! /usr/bin/bash| となったため lintian がたまたま別件のポリシー違反として検出してくれています。
\begin{commandline}
$ dget http://snapshot.debian.org/archive/debian/20180809T030926Z/pool/main/q/quilt/quilt_0.65-2.dsc
dget: retrieving http://snapshot.debian.org/archive/debian/20180809T030926Z/pool/main/q/quilt/quilt_0.65-2.dsc
(snip)
quilt_0.65-2.dsc:
      Good signature found
   validating quilt_0.65.orig.tar.gz
   validating quilt_0.65-2.debian.tar.xz
All files validated successfully.
dpkg-source: info: extracting quilt in quilt-0.65
(snip)
dpkg-source: info: applying fix-mail-threading
$ cd quilt-0.65/
$ debuild -us -uc
 dpkg-buildpackage -us -uc -ui
dpkg-buildpackage: info: source package quilt
dpkg-buildpackage: info: source version 0.65-2
(snip)
dh_auto_configure -- --with-docdir=/usr/share/doc/quilt --with-sendmail=/usr/sbin/sendmail --with-awk=/usr/bin/awk
	./configure --build=x86_64-linux-gnu --prefix=/usr --includedir=\${prefix}/include --mandir=\${prefix}/share/man --infodir=\${prefix}/share/info --sysconfdir=/etc --localstatedir=/var --disable-silent-rules --libdir=\${prefix}/lib/x86_64-linux-gnu --libexecdir=\${prefix}/lib/x86_64-linux-gnu --runstatedir=/run --disable-maintainer-mode --disable-dependency-tracking --with-docdir=/usr/share/doc/quilt --with-sendmail=/usr/sbin/sendmail --with-awk=/usr/bin/awk
configure: WARNING: unrecognized options: --disable-silent-rules, --disable-maintainer-mode, --disable-dependency-tracking, --with-docdir
checking for a BSD-compatible install... /usr/bin/install -c
checking whether #! works in shell scripts... yes
checking for bash... /usr/bin/bash
checking whether /usr/bin/bash quoting works... yes
checking for gcp... no
checking for cp... /usr/bin/cp
checking for gdate... no
checking for date... /usr/bin/date
(snip)
dpkg-deb: building package 'quilt' in '../quilt_0.65-2_all.deb'.
dpkg-deb: building package 'quilt-el' in '../quilt-el_0.65-2_all.deb'.
 dpkg-genbuildinfo
 dpkg-genchanges  >../quilt_0.65-2_amd64.changes
dpkg-genchanges: info: not including original source code in upload
 dpkg-source --after-build .
dpkg-source: warning: Testsuite field contains value autopkgtest, but no tests control file debian/tests/control
dpkg-buildpackage: info: binary and diff upload (original source NOT included)
Now running lintian quilt_0.65-2_amd64.changes ...
W: quilt source: orig-tarball-missing-upstream-signature quilt_0.65.orig.tar.gz
E: quilt: missing-depends-on-sensible-utils usr/share/quilt/edit
E: quilt: missing-depends-on-sensible-utils usr/share/quilt/header
E: quilt: missing-depends-on-sensible-utils usr/share/quilt/mail
E: quilt: wrong-path-for-interpreter usr/bin/quilt (#!/usr/bin/bash != /bin/bash)
E: quilt: wrong-path-for-interpreter usr/share/quilt/add (#!/usr/bin/bash != /bin/bash)
(snip)
Finished running lintian.
$ 
\end{commandline}

問題を回避するため、少なくともDebian公式のパッケージビルドには当面``/usr Merge''されていない環境を使うこととなりました。また、Debian公式レポジトリにアップロードされたパッケージは、``/usr Merge''されていない環境でビルドした結果と``/usr Merge''された環境でビルドした結果を比較してこのような差分が発生していないかReproducible BuildsプロジェクトのCI\footnote{Continuous Integration、継続的インテグレーション}環境で検証も行われており\footnote{\url{https://tests.reproducible-builds.org/debian/issues/unstable/paths_vary_due_to_usrmerge_issue.html}}、これも元にバグ報告・修正が行われています。

手元で動くpbuilder, cowbuilderやsbuildなどクリーンルームでのパッケージビルドツールも同様に``/usr Merge''されていない環境が作られてその中でビルドしてくれます。新たにcowbuilderでビルド環境を作ると次のように構成されます。

\begin{commandline}
# cowbuilder --create
I: Invoking pbuilder
I: forking: pbuilder create --buildplace /var/cache/pbuilder/base.cow --mirror http://ftp.jp.debian.org/debian --distribution sid --no-targz --extrapackages cowdancer
W: /root/.pbuilderrc does not exist
I: Running in no-targz mode
（略）
Processing triggers for libc-bin (2.28-10) ...
I: Copying back the cached apt archive contents
I: unmounting dev/ptmx filesystem
I: unmounting dev/pts filesystem
I: unmounting dev/shm filesystem
I: unmounting proc filesystem
I: unmounting sys filesystem
# 
\end{commandline}
\begin{commandline}
# ls -l /var/cache/pbuilder/base.cow/
合計 80
drwxr-xr-x  2 root root 4096  5月 14 23:50 bin
drwxr-xr-x  2 root root 4096  5月 14 05:25 boot
drwxr-xr-x  2 root root 4096  5月 14 23:50 build
drwxr-xr-x  4 root root 4096  5月 14 23:50 dev
drwxr-xr-x 30 root root 4096  5月 14 23:50 etc
drwxr-xr-x  2 root root 4096  5月 14 05:25 home
drwxr-xr-x  7 root root 4096  5月 14 23:50 lib
drwxr-xr-x  2 root root 4096  5月 14 23:50 lib64
drwxr-xr-x  2 root root 4096  5月 14 23:50 media
drwxr-xr-x  2 root root 4096  5月 14 23:50 mnt
drwxr-xr-x  2 root root 4096  5月 14 23:50 opt
drwxr-xr-x  2 root root 4096  5月 14 05:25 proc
drwx------  2 root root 4096  5月 14 23:50 root
drwxr-xr-x  4 root root 4096  5月 14 23:50 run
drwxr-xr-x  2 root root 4096  5月 14 23:50 sbin
drwxr-xr-x  2 root root 4096  5月 14 23:50 srv
drwxr-xr-x  2 root root 4096  5月 14 05:25 sys
drwxrwxrwt  2 root root 4096  5月 14 23:50 tmp
drwxr-xr-x 10 root root 4096  5月 14 23:50 usr
drwxr-xr-x 11 root root 4096  5月 14 23:50 var
#
\end{commandline}
パッケージを作るときは安全のためこれらのツールでビルドするようにしましょう。

なお、多くの場合 \verb|PATH| 環境変数に従ってバイナリの場所を探しているので \verb|/bin/| よりも \verb|/usr/bin/| が優先されています。なのでもともと``/usr Merge''されていない環境であってもクリーンルームでビルドしていないと次のようなことも起こります。\verb|/usr/local/bin/bash| が存在する環境で \verb|dpkg-buildpackage| コマンドを実行すると、\verb|PATH| 環境変数では \verb|/bin|（や \verb|/usr/bin|）よりも \verb|/usr/local/bin| が優先されるので \verb|/bin/bash| ではなく \verb|/usr/local/bin/bash| が使われてしまいます。なおこのように \verb|/usr/local/bin/| の中のものを使うのは明らかにポリシー違反なので一部ツールでは対策されており、\verb|dpkg-buildpackage| コマンドの代わりにdevscriptsパッケージにある \verb|debuild| コマンドを使えば回避できます。これは \verb|PATH| 環境変数に \verb|/usr/local/bin| を除いたものを設定した上でビルドしてくれます。ですがまずは先ほどのクリーンルームなビルドツールを使うのが良いでしょう。

また、``/usr Merge''された環境（に限らないですが）の既知の注意点として、\verb|dpkg --search| (\verb|dpkg -S|) が指定したファイルのパッケージを見つけてくれないことがあります\footnote{\url{https://bugs.debian.org/858331}}。
\begin{commandline}
$ which ls
/usr/bin/ls
$ dpkg -S /usr/bin/ls
dpkg-query: パターン /usr/bin/ls に一致するパスが見つかりません
$ dpkg -S /bin/ls
coreutils: /bin/ls
$ 
\end{commandline}
なお、おそらくこの挙動が変更されることはなさそうです。debhelperをはじめ様々なツールも現在の挙動に依存しています。ディレクトリの対応付けなどを認識しながらファイルを検索するオプションは別に用意されるかもしれません。

\subsection{今後}

Debian技術委員会は今後Debianの望ましい姿として、Busterの次のバージョン(Bullseye)では``/usr Merge''されていない環境とされている環境の両方が使えるべきで、またどちらの環境でビルドされたパッケージも両方の環境で動作すべきと示しました。

先ほどの quilt は、その次のバージョン 0.65-3 で``/usr Merge''された環境でビルドされたパッケージが``/usr Merge''されていない環境に持っていっても動作するよう次のように修正されました。debian/rules ファイルの \verb|dh_auto_configure| コマンド（結果的には \verb|./configure|）呼び出しの引数最後に \verb|--with-bash=/bin/bash| を追加し、\verb|PATH| 環境変数に関係なく決め打ちで \verb|/bin/bash| を見に行くようにしました。なお \verb|./configure| は \verb|--with-bash=| を \verb|BASH=| と書くこともできます。今のところこのように差分が見つかった各パッケージを修正中のようです。新しくパッケージングしたいアプリにも少なくとも差分があればこのような対処が必要になります。

さて、現時点でこれをどうシームレスに実現するのかは不明です。少なくともDebian公式レポジトリにアップロードされた後に検出するCI環境は既にありますが、新しいアプリをパッケージングするときに事前に対応できるようにならないと真に実現したことにならないでしょう。そのためには、debhelper等のパッケージング時のビルド補助ツールが頑張り、lintian等のパッケージング後の検査ツールも強化していく感じでしょうか。\verb|PATH| 環境変数で \verb|/bin| よりも \verb|/usr/bin| を優先させることもできるかもしれませんが悪影響が読めません。現時点でこの問題の自衛方法としてはReproducible Buildsの取り組みで使われているツールを手元で動かすくらいでしょう。diffoscopeで2つのファイルをバイナリの中身まで再帰的に差分表示してくれます\footnote{x11-apps で発生している差分の表示例 \url{https://tests.reproducible-builds.org/debian/dbd/buster/amd64/x11-apps_7.7+7.diffoscope.html}。表示に使ったdiffoscopeコマンド引数はこのHTMLページのタイトル(\texttt{<title>})に書かれています。}。ただ2つの環境作って両方でビルドするのも、そしてこの``/usr Merge''で発生している差分を見極めるのも正直面倒なので\footnote{完全なReproducible Buildsは本当は実現すべきですが大変なので、今回発生する差分だけでも対処するのが現実的です。}、まずはクリーンルームでビルドして上げておいて、後でCI環境などに指摘されたら直すくらいが現実的ではないかと思います。

%201905 kansai
\dancersection{Systemdに入門してみた}{あっきー}

\clearpage
\newpage

%-------------------------------------------------------------------------------
%\dancersection{Debian Trivia Quiz}{野島 貴英}
%-------------------------------------------------------------------------------

%ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
%題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
%りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
%いところもあるかも知れません。みんなで一緒に読んでみましょう。

%今回の出題範囲は\url{debian-devel-announce@lists.debian.org} や \url{debian-devel@lists.debian.org}に投稿された
%内容とDebian Project Newsからです。

%\begin{multicols}{2}
%\end{multicols}

% 索引
%\printindex
\clearpage
\begin{center}
本資料のライセンスについて
\end{center}

本資料はフリー・ソフトウェアです。あなたは、Free Software
Foundation が公表したGNU GENERAL PUBLIC LICENSEの "バージョン２"もしくはそれ以降
が定める条項に従って本プログラムを再頒布または変更することができ
ます。

本プログラムは有用とは思いますが、頒布にあたっては、市場性及び特
定目的適合性についての暗黙の保証を含めて、いかなる保証も行ないま
せん。詳細についてはGNU GENERAL PUBLIC LICENSE をお読みください。

\begin{multicols}{2}
 \begin{fontsize}{6}{6}
 \begin{verbatim}
            GNU GENERAL PUBLIC LICENSE
               Version 2, June 1991

 Copyright (C) 1989, 1991 Free Software Foundation, Inc.
    51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

                Preamble

  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software--to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Library General Public License instead.)  You can apply it to
your programs, too.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

  The precise terms and conditions for copying, distribution and
modification follow.

            GNU GENERAL PUBLIC LICENSE
   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION

  0. This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The "Program", below,
refers to any such program or work, and a "work based on the Program"
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term "modification".)  Each licensee is addressed as "you".

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

  1. You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

  2. You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:

    a) You must cause the modified files to carry prominent notices
    stating that you changed the files and the date of any change.

    b) You must cause any work that you distribute or publish, that in
    whole or in part contains or is derived from the Program or any
    part thereof, to be licensed as a whole at no charge to all third
    parties under the terms of this License.

    c) If the modified program normally reads commands interactively
    when run, you must cause it, when started running for such
    interactive use in the most ordinary way, to print or display an
    announcement including an appropriate copyright notice and a
    notice that there is no warranty (or else, saying that you provide
    a warranty) and that users may redistribute the program under
    these conditions, and telling the user how to view a copy of this
    License.  (Exception: if the Program itself is interactive but
    does not normally print such an announcement, your work based on
    the Program is not required to print an announcement.)

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

  3. You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:

    a) Accompany it with the complete corresponding machine-readable
    source code, which must be distributed under the terms of Sections
    1 and 2 above on a medium customarily used for software interchange; or,

    b) Accompany it with a written offer, valid for at least three
    years, to give any third party, for a charge no more than your
    cost of physically performing source distribution, a complete
    machine-readable copy of the corresponding source code, to be
    distributed under the terms of Sections 1 and 2 above on a medium
    customarily used for software interchange; or,

    c) Accompany it with the information you received as to the offer
    to distribute corresponding source code.  (This alternative is
    allowed only for noncommercial distribution and only if you
    received the program in object code or executable form with such
    an offer, in accord with Subsection b above.)

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

  4. You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

  5. You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

  6. Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

  7. If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

  8. If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

  9. The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and "any
later version", you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

  10. If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.

                NO WARRANTY

  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.

             END OF TERMS AND CONDITIONS

        How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA


Also add information on how to contact you by electronic and paper mail.

If the program is interactive, make it output a short notice like this
when it starts in an interactive mode:

    Gnomovision version 69, Copyright (C) year  name of author
    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
    This is free software, and you are welcome to redistribute it
    under certain conditions; type `show c' for details.

The hypothetical commands `show w' and `show c' should show the appropriate
parts of the General Public License.  Of course, the commands you use may
be called something other than `show w' and `show c'; they could even be
mouse-clicks or menu items--whatever suits your program.

You should also get your employer (if you work as a programmer) or your
school, if any, to sign a "copyright disclaimer" for the program, if
necessary.  Here is a sample; alter the names:

  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
  `Gnomovision' (which makes passes at compilers) written by James Hacker.

  <signature of Ty Coon>, 1 April 1989
  Ty Coon, President of Vice

This General Public License does not permit incorporating your program into
proprietary programs.  If your program is a subroutine library, you may
consider it more useful to permit linking proprietary applications with the
library.  If this is what you want to do, use the GNU Library General
Public License instead of this License.
 \end{verbatim}
 \end{fontsize}
\end{multicols}

\begin{center}
ソースコードについて
\end{center}

このプログラムは tex で記述されたものです。ソースコードは
\begin{center}
  \url{git://anonscm.debian.org/tokyodebian/monthly-report.git}
\end{center}
から取得できます。

\begin{center}
Debian オープンユーズロゴ ライセンス
\end{center}

\begin{multicols}{2}
 \begin{fontsize}{6}{6}
 \begin{verbatim}

Copyright (c) 1999 Software in the Public Interest
Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge,
publish, distribute, sublicense, and/or sell copies of the Software,
and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY
KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 \end{verbatim}
 \end{fontsize}
\end{multicols}

% 問題と回答が同じみひらきにならないようにする
%\cleartoevenpage
%-------------------------------------------------------------------------------
%\dancersection{Debian Trivia Quiz 問題回答}{ }
%-------------------------------------------------------------------------------
%\\
%{\small
% Debian Trivia Quiz の問題回答です。 あなたは何問わかりましたか？ \\
 %回答はdebianmeetingresume2016-natsu.jqzというファイルに生成されるので、
 %それを手動でコピペして使う。
 % ここからコピペ
 % FIXME 問題が全部はいったらコピペすること
\pagestyle{empty}
\cleartoevenpage
　
\pagestyle{empty}
\cleartoevenpage

\newpage
{
\large
\begin{itembox}{\bf 『あんどきゅめんてっど でびあん』について}
% FIXME: 対象を修正すること。
本書は、東京および関西周辺で毎月行なわれている『東京エリア Debian 勉強会』（2018年12月-2019年5月）および
『関西 Debian 勉強会』（2018年12月-2019年5月）で使用された資料・小ネタ・必殺技などを一冊にまとめたものです。
内容は無保証、つっこみなどがあれば勉強会にて。
\end{itembox}
}

\vspace*{13cm}
{\color{dancerlightblue}\rule{\hsize}{1mm}}
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf あんどきゅめんてっど でびあん 2019年夏号\\
\noindent \normalfont 2019年8月12日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会/関西エリア Debian 勉強会 （編集・印刷・発行）\\
{\color{dancerdarkblue}\rule{\hsize}{1mm}}

\end{document}
