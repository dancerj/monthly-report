%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt

%   Pdf作成手順
% dvipdfmx debianmeetingresume200507.dvi

%この資料はA3用紙に両面印刷で印刷する予定

\documentclass[mingoth]{jsarticle}
\usepackage{graphicx}
\usepackage{fancybox}
\usepackage{longtable}

% とりあえずcommandline環境を定義．入出力についてはcommandline環境を活用
%する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{12cm}\begin{tiny} \begin{BVerbatim}}%
{\end{BVerbatim}\end{tiny}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}



% 三択問題用
\newcounter{santakucounter}
\newcommand{\santaku}[4]{%
\addtocounter{santakucounter}{1}

\nopagebreak 問題\arabic{santakucounter}. 
#1\\
\nopagebreak□ A #2\\
\nopagebreak□ B #3\\
\nopagebreak□ C #4
\pagebreak[1]
\hspace{1cm}
\\

}

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\Large\headfont\raggedright\centering}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
東京エリアDebian勉強会 2005
\hrule
\vspace{0.5mm}
\hrule
\hfill{}\includegraphics[width=3cm]{image200502/openlogo-nd.eps}\\
\vspace{-4cm}
\begin{center}
  \section{#1}
\end{center}
\hfill{}#2\hspace{3cm}\space\\
\hrule
\hrule
\vspace{1cm}
}


\begin{document}

\begin{titlepage}

% 毎月変更する部分
\title{\includegraphics[width=7cm]{image200502/openlogo-nd.eps}\\
 第6回 東京エリア Debian 勉強会\\事前資料
\footnote{機密レベル public: 一般開示可能}}
\date{2005年7月2日}
\author{Debian勉強会会場係 上川純一\thanks{Debian Project Official Developer}} 
\maketitle

\end{titlepage}

\newpage
\tableofcontents

\dancersection{Introduction To Debian 勉強会}{上川純一}

今月のDebian勉強会へようこそ．
これからDebianのあやしい世界に入るという方も，すでにどっぷりとつかってい
るという方も，月に一回Debianについて語りませんか？

目的として下記の二つを考えています．

\begin{itemize}
 \item メールではよみとれない，もしくはよみとってられないような情報を情
       報共有する場をつくる
 \item まとまっていないDebianを利用する際の情報をまとめて，ある程度の塊と
       して出してみる
\end{itemize}

また，東京にはLinuxの勉強会はたくさんありますので，Debianに限定した勉強
会にします．Linuxの基本的な利用方法などが知りたい方は，他でがんばってくださ
い．
Debianの勉強会ということで究極的には参加者全員がDebian Packageを
がりがりと作りながらスーパーハッカーになれるような姿を妄想しています．

Debianをこれからどうするという能動的な展開への土台としての空間を提供し，
情報の共有をしたい，というのが目的です．
次回は違うこと言ってるかもしれませんが，御容赦を．

\subsection{講師紹介}

\begin{itemize}
 \item{gotomさん} Debianのglibcとかをやってます．
 \item{上川純一} 宴会の幹事です．
      Debian Developerです．
      元超並列計算機やっていて，
      今は音楽関係とか，気づいたらcannaとか．
      あと，pbuilderや，libpkg-guideなどを通して，Debianの品質向上を目指してます．
\end{itemize}

\subsection{事前課題紹介}

今回の事前課題は
「いままでtoolchainをつかってみて/今後toolchainに期待すること」
というタイトルで200-800文字程度の文章を書いてください．
というものでした．
その課題に対して下記の内容を提出いただきました．

\subsubsection{makoyukiさん}

えー、すいません、当方、そもそも「toolchain」といわれて何のことかわかり
ませんでした。
大体「開発環境一式」とかかなぁ?という感じだったのですが、正確に理解して
いるかわかりません。

んで、仮にそうだとして、ある程度のコンパイルとかはしていても、当方コード
書きではまったく無い上、少なくともDebianにおいては一度も手動でソースコー
ドからコンパイルしたことがありませんし、プログラミング周りのことについて
はド素人なのでド素人なりのことを書いてみます。

開発環境であるという前提で書きますが…
正直に包み隠さず言いますと、当方は実際のところプログラミングっぽいことが
したくないからDebianを使っています。コードは書きたくないのです。
万が一それが楽しいと思うことがあれば今後絶対にやらないということはありま
せんが、少なくとも今、私がやりたいのはプログラミングではありません。
なので、「toolchainを使う」ということは、当面ないと思うのです。いままで
も。そしてこれから当分の間は。

勿論、勉強にもなりますし、理解を深める一助にもなるでしょうから、それにつ
いての勉強をしたいとは思います。その上で、限度はあるにせよ、ドキュメント
の充実、ツールやインターフェースの充実により、レベルは下げずに敷居を下げ
るものであって欲しいという浅はかな望みはありますが、それはなんとなく今回
のお題にはそぐわない気もします。

そもそもがtoolchainが何のことか理解していないかもしれませんので完全にハ
ズしているかもしれませんがご勘弁を。


\subsubsection{澤田さん}

toolchainに期待すること、ということでいろいろ妄想してみた。

まず現実的なもの。最適化は結構ブラックボックスなイメージがあるの 
で、最適化を行ったときにどの部分にどんな最適化を施したのか、逆に 
ここはなんで最適化をかけなかったのか（時間と空間のトレードオフと 
か）、最適化をかけることでどんな効果が得られるのかのログがあると 
いいなと思った。

もうひとつまあまあ現実的なもの。リンク時にどのライブラリをリンク 
しないといけないのか考えるのが面倒なので、ライブラリが 
exportしているシンボルを保存しておき、リンク時に参照する機能があ 
るといいなと思った。この場合、どのライブラリを使っているかわから 
なくなってしまうので、デフォルトオフで--library-auto- 
detectとかいうオプションがあるといいだろうか。

次に実現できるかよくわからないもの。コンパイル時にはinline 
展開なるものがあるわけだが、リンク時（共有ライブラリ使ってる場合 
はロード時）にもinline展開してくれるとうれしいことがあるか 
もしれないと思った。

最後にかなり非現実的なもの。最適化を行う際に一番問題なのはやはり 
どの最適化オプションを使えばいいのかわからないということであろ 
う。これを解決する方法として、こんなコードに対してはこんな最適化 
が有効だったというデータベースを構築し、最適化時にそれを参照、実 
行してデータベースに反映とかすると何かができるのではないかと思っ 
た。

\subsubsection{上川}

etchにむけてg++のtransitionがあるらしい．
ABIがまた変わるとのこと．
gcc 3.0になるときに「これで最後だから」といってみておきながら，また浮気
するのですか？
あぁ．．．

woodyからsargeにあがる際に，c++のABIが一旦変更になっています．
アップグレードの際にこまったりしませんでしたか？

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで，Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが，一人で読んでいても，解説が少
ないので，
意味がわからないところもあるかも知れません．みんなでDWNを読んでみましょう．

漫然と読むだけではおもしろくないので，DWNの記事から出題した以下の質問にこたえてみてください．
後で内容は解説します．

\subsection{2005年24号}
6月14日版です．

\santaku{Aliothが新しいサーバに移動するということが各ユーザ宛のダイレク
トメールで出た．Branden RobinsonがAliothのアナウンスメールについてコメントを出
した．その主旨は．
}{匿名で各ユーザにメールを出すのではなく，debian-devel-announceに出そう，
さらに誰が出したのかを明確にして出そう}{メールは信頼できないプロトコルな
のでWEBページに掲示したらよいだろう}{SMTPより，SNMP トラップのほうがみんな気づく}

\santaku{Andreas Barthはetchに向けてリリースポリシーについてどういう変更が必要だと説
明したか}{ダメな人禁止}{ダメなコード禁止}{共有ライブラリはダイナミックにリンクすべきであり，ソースコード
をコピーするのは禁止しよう．}

\santaku{etchにむけてc++のABIが変更になるため，Matthias Klose は何を宣言
したか}{C++でかいたプログラムの粛正}{とりあえず今C++のライブラリであたらしいABIバージョンのものにつ
いてはアップロードしないようにフリーズする}{javaの利用禁止}

\santaku{Debconfでの講演の予定の組み方について今回はどういうこころみ
がなされたか}{意志決定方法としてさいころを導入してみた}{
参加者の都合が悪い日をできるだけ選んだ}{参加したい講演の投票をおこない，参加者ができるだけ参加
できるようにスケジューリングをする}

\santaku{Scott James Remnant曰く，dpkg 1.13で新しく追加されたアーキテク
チャ変数名は}{DPKG\underline{ }HOST\underline{ }ARCH\underline{ }OS}{
DEBIAN-ARCHITECTURE}{uname -a }

\santaku{Roberto Sanchezの作成したFAQには何がかいてあるか}
{Debianパッケージをインストールする方法がかいてある}{
Debianパッケージをカスタマイズしてビルドする手順がかいてある}{Debianメン
テナを招集する方法がかいてある}

\santaku{selinuxの進捗についてはどうなっているか}{coreutilsなどのパッケー
ジがlibselinux1に依存するようになってきた}
{NSAの陰謀であることが判明したので排除}{もうほとんどのユーザがSELINUXを
使うようになった}


\subsection{2005年25号}
6月21日版です.

\santaku{OskuroがGNOMEについて宣言したのは何か}{今後はKDEに移行する}{Gnome 2.10がunstableに
入った}{GNOME3がもうすぐリリース}
\santaku{woodyからsargeにアップグレードするのにもっとも大きい問題は何か}
{相互に依存するような依存関係があるパッケージのアップグレード}{
woodyでは存在したけどsargeで消えたパッケージの処理}{etchに無いパッケージ}

\santaku{Aurelien JarnoがBSD移植版について報告した問題は}
{GNU Hurdについてはもうあきらめたので考えなくて良い}{
FreeBSDについてはもうあきらめた．
}{libselinux1に依存するパッケージは，selinuxがlinuxのみなので，Linux
のみでリンクするようにしてほしい}

\santaku{Bill Allombertがmenuについて報告したのは}{menuのセクション
の部分については国際化できるようになった}{menuはもう使われていないので廃
止する}{対応するWindow Managerが増えた}

\santaku{矢吹さん曰く大阪でなにかあるらしい，何？}{10月にmini Debian
Conferenceを開催する }{9月にたこやきはやぐい競争}{阪神優勝祈念会}

% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}

\subsection{2005年26号}
6月28日版です.

% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}
% \santaku{}{}{}{}

\subsection{2005年27号}
% \santaku{}{}{}{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会6回目報告}


前回開催した第6回目の勉強会の報告をします．

DWNクイズを実施しました．
	    今回は3週間分だったので，分量がすくなかったかな．

えとーさんがupdate-alternativesとdsysについて説明しました．
	    update-alternativesが 実はroot権限がなくても使えるようになっていたり，
	    新しい発見がありました．
	    dsysについては，alternativesのDescription(説明文)というものがないので
	    その情報が欲しい，さらに国際化するには何が必要だろう，という話題が出ました．

	    武藤さんがdebian-installerの構造について話をしました．
	    国際化はまだetchにむけて改善できるだろう，ということです．
	    udebをつかっていたり，annaをつかっていたり，
	    cdebconfを使っているところとか．
	    1st-stageと2nd-stage があって，全然違うとか．
	    インストーラが動いているときにはDEBCONF\underline{ }PRIORITYはHIGHなのに
	    インストール後はMEDIUMに強制変更するためいろいろとひずみがでているとか．
	    なお，自動認識されないハードウェア情報については，
	    バグレポートが重要なので，lspci, lspci -n
	    の出力とともにおくってくださいとのこと．
	    lspci -nの出力はしらなかったけど便利．

	    GPGKeysigning partyをしました．
	    キーサイニングに参加するのは
	    10人なので，あまり時間かからないかなぁ，と思ったら30分くらいかかってしまいました．

はなの舞で宴会，デニーズでデザート．

\dancersection{glibc and toolchains}{gotom}
\label{sec:gotom}
%% gotomさんの記事はここから
\subsection{toolchainとは}
\subsection{Debianではどうなっているか}
\subsection{今後どうするか}
%% gotomさんの記事はここまで

\dancersection{dpatchをつかってみよう}{上川純一}
\label{sec:dpatch}

\subsection{dpatchとは}

 Debianのソースパッチを管理するツールです． Debianパッケージでは，ソースパッケージは以下の構成になっています．
\begin{itemize}
    \item .orig.tar.gz: オリジナルのtarball
    \item .diff.gz: Debianで作成した差分
    \item .dsc: dpkg用制御ファイル
\end{itemize}

この中で，.diff.gzは一つの大きな差分ファイルとして管理されるため， どの部分がどういうパッチであるか，ということを管理してはくれません． その部分を実装するのがdpatchです．

通常の.diff.gzであると， {\tt debian/}ディレクトリ以下のDebianパッケージング用の情報と それ以外のソフトウェア自体への修正が混合しています． それを整理するというものです． 

\subsection{ファイル構成}
 dpatchでは，それぞれの小さな変更をそれぞれ独立したパッチとして扱います．
 それぞれのパッチを{\tt debian/patches/xx\underline{ }patchname.dpatch}とい
 う名前 で管理します．例えば，{\tt debian/patches/01\underline{ }configure.dpatch}という
 名前になります． そして，パッチの一覧を{\tt debian/patches/00list}に適
 用する順番に記述しま
 す． そこでは，{\tt 01\underline{ }configure}というような形式で記述できます．

 この形式を採用しているため，Debianにおいての変更点がdebian/ディレクトリ以下に集
まり， また変更点をdebian/patchesディレクトリで分類して管理できる，とい
う利点があります． 

\subsection{道具}

dpatchを利用するための道具を紹介します．

\subsubsection{dpatch}

dpatchコマンドは，パッチの適用とパッチをはずすという処理を実施してくれる
コマンドです．
従来は，makefileからincludeするMake スクリプトとして実装されて
いましたが，dpatch 2.0からは実体が{\tt  /usr/bin/dpatch} シェルスクリプト
になっています．

古い{\tt debian/rules}では下記の内容を記述しています．

\begin{commandline}
include /usr/share/dpatch/dpatch.make
\end{commandline}

最近のdpatchを利用するソースでは，dpatchコマンドを呼ぶように実装すればよ
いことになっています．
({\tt /usr/share/doc/dpatch/examples/rules/rules.new.dh.gz}から抜粋)

\begin{commandline}
#!/usr/bin/make -f
#
# Sample dpatch rules file. Only example. Nothing else. :)
# This one uses the new way with dpatch from dpatch 2.x

export DH_COMPAT = 4

CFLAGS = -Wall -g
ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
CFLAGS += -O0
else
CFLAGS += -O2
endif

build: build-stamp
build-stamp: patch
	@echo "--- Compiling"
	dh_testdir
# Do something to build your package here
	touch build-stamp

clean: clean1 unpatch
clean1:
	@echo "--- Cleaning"
	dh_testdir
	dh_testroot
	dh_clean -k
# Clean your build tree

install: build-stamp
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs
# Install it here

# Build architecture-independent files here.
binary-indep: build install

# Build architecture-dependent files here.
binary-arch: build install
	dh_testdir
	dh_testroot
	dh_installdocs
# And all the other dh_* stuff you need for your package.

# And now the simple things for dpatch. Here we only apply/unapply the patches.
# You can do more things with dpatch, like having patches only applied on
# a special architecture - see the non-dh version of the sample for this!
patch: patch-stamp
patch-stamp:
	dpatch apply-all
	#dpatch call-all -a=pkg-info >patch-stamp

unpatch:
	dpatch deapply-all
	rm -rf patch-stamp debian/patched

binary: binary-indep binary-arch
.PHONY: binary clean binary-indep binary-arch build install patch unpatch \
	clean1
\end{commandline}


\subsubsection{dpatch-edit-patch}

dpatchで利用するためのパッチを作成するコマンドです．

基本的な使い方はdpatch管理下にあるソースコードのディレクトリで，
\begin{commandline}
dpatch-edit-patch 03_patchname 02_patchname
\end{commandline}
のように入力すると，二つ目のオプションに指定したパッチまでのパッチを適用
した状態で，一時ディレクトリにソースを展開してくれ，シェルが起動します．

編集したのち，シェルから出ると，
一つ目のオプションに指定した名前のパッチを作成してくれます．

00listファイルは編集してくれるわけではないので，
自分で編集する事になります．


\subsubsection{dpatch.el}

emacs上でdpatchを使うために必要な，00listファイルや，.dpatchファイルの
編集用のモードです．

まだまだ未完成です．

目標はdpatch-edit-patchの実装ですが，コアのdpatchの部分の
変更をしているだけで現在は時間が過ぎていってます．

\subsection{作業フロー}

\subsubsection{あたらしいupstreamが出た時}
\begin{itemize}
     \item  前のバージョンからdebian/ディレクトリをコピーしてくる
    \item {\tt debian/patches/xx\underline{ }patchname.dpatch}をそれぞれ{\tt  patch --dry-run -p1 }で適用できるかどうか確認する
    \item {\tt debian/patches/00list}を編集
    \item {\tt  debian/rules patch}
    \item {\tt 適用できないパッチの再作成}

\end{itemize}

\subsubsection{あたらしくpackageをつくる時}
\begin{itemize}
     \item  {\tt debian/rules}を変更し，{\tt
	    /usr/share/dpatch/dpatch.make} をincludeし， cleanと
	    configureのルールでpatchとunpatchルールが呼ばれるようにする
	    (patch-stamp等を利用)
    \item {\tt debian/patches/00list}を作成する
    \item {\tt dpatch-convert-diffgz}を実行，とりあえずdpatchファイルに変換する
    \item dpatchファイルを適当に編集して複数ファイルに分割

    \item {\tt  debian/rules patch}と{\tt debian/rules unpatch}が成功する
    \item {\tt dpkg-buildpackage}で生成されるdiff.gzのdiffstatをとり，
	    debian以下以外の場所がdiffに含まれていないことを確認
\end{itemize}

\subsubsection{あたらしくpatchを作成}

\begin{itemize}
 
 \item dpatch-edit-patch パッチ番号\underline{ }パッチ名とする． \\
       例：
       { \tt dpatch-edit-patch 03\underline{ }automake }  \\もし他のパッチに依存
 する変更をするなら，そのパッチ名を入力します． \\ 例 {\tt dpatch-edit-patch
 03\underline{ }automake 02\underline{ }autoconf}．\\
       これを実施すると，{\tt /tmp}以下に適当なディレクトリでソースが編集できるようにシェルが起動します．
 \item  ソースを適当に編集します．
 \item  exitすると，パッチファイルが{\tt debian/patches}ディレクトリ以下に生成されます．
 \item  生成されたパッチファイルに適当なコメントを書いておきます
 \item  {\tt debian/patches/00list }を適当に修正します
 \item  {\tt debian/rules unpatchdebian/rules patchdebian/rules unpatch }として 一応パッチが動作することを確認します
\end{itemize}


\subsubsection{すでにあるパッチを編集}

\begin{itemize}
     \item  dpatch-edit-patch パッチ番号\underline{ }パッチ名とする．例：
{\tt  dpatch-edit-patch 03\underline{ }automake}
    \item 編集する
    \item exit
\end{itemize}

\subsection{今後の開発}

がんばれ．
といいたいところですが，とりあえず現状の仕様をあらいだして，テストを作成
して，全部の機能が動作することを確認するところからやろうと考えています．
今は謎の機能が多すぎておいそれと触れません．

\newpage
%\vfill{}
%\hfill{}
%\includegraphics[width=7cm]{image200502/openlogo-nd.eps}
%\hfill{}
%\vfill{}
%\newpage

\dancersection{個人提案課題}{}
\hfill{}{\large 名前} \underline{\hspace{6cm}}

下記の空欄を埋めてください:

{\LARGE 
Debian glibc の (\hspace{5cm})\\
に注目し，今後のDebianのtoolchainは(\hspace{6cm})\\
します．
}
\\\\
企画案の図：

\newpage

%\vfill{}
%\hfill{}
%\includegraphics[width=7cm]{image200502/openlogo-nd.eps}
%\hfill{}
%\vfill{}
%\newpage

\dancersection{Keysigning Party}{上川純一}


事前に必要なもの
\begin{itemize}
 \item 自分の鍵のfingerprintを書いた紙({\tt gpg --fingerprint XXXX}の出力．)
 \item 写真つきの公的機関の発行する身分証明書，fingerprintに書いてある名前が自分の
ものであると証明するもの
\end{itemize}

キーサインで確認する内容
\begin{itemize}
 \item 相手が主張している名前の人物であることを信頼できる身分証明書で証明し
       ているか\footnote{いままで見た事の無い種類の身分証明書を見せられ
       てもその身分証明書の妥当性は判断しにくいため，学生証明書やなんと
       か技術者の証明書の利用範囲は制限される．
       運転免許証明書やパスポートが妥当と上川は判断している}．
 \item 相手がfingerprintを自分のものだと主張しているか
 \item 相手のfingerprintに書いてあるメールアドレスにメールをおくって，
       その暗号鍵にて復号化することができるか
\end{itemize}

手順としては
\begin{itemize}
 \item 相手の証明書を見て，相手だと確認
 \item fingerprintの書いてある紙をうけとり，これが自分のfingerprintだと
       いうことを説明してもらう
 \item (後日) gpg署名をしたあと，鍵のメールアドレスに対して暗号化して送付，相手
       が復号化してキーサーバにアップロードする
       ({\tt gpg --sign-key XXXXX, gpg --export --armor XXXX })
\end{itemize}


\dancersection{次回}{}

次回は8月6日土曜日の夜を予定しています．
内容は本日決定予定です．

参加者募集はまた後程．

\end{document}
