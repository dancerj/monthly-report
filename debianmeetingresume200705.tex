%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2007 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200701; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}
\usepackage{nextpage}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2007}
\newcommand{\debmtgdate}{19}
\newcommand{\debmtgmonth}{5}
\newcommand{\debmtgnumber}{28}

%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\begin{itembox}[c]{出力}{\TheSbox}\end{itembox}}

%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\gt\fontsize{32}{32}\headfont\raggedright}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
第\debmtgnumber{}回 東京エリアDebian勉強会 \debmtgyear{}年\debmtgmonth{}月
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{4cm}
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{-7cm}
\begin{minipage}[b]{0.7\hsize}
\section{#1}
\hfill{}#2\\
\vspace{2cm}
\end{minipage}
\begin{minipage}[b]{0.3\hsize}
\hfill{}\includegraphics[height=8cm]{image200502/openlogo-nd.eps}\\
\end{minipage}
%
%\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{Bug\##1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}




\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに


 第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\vspace{2cm}

\begin{minipage}[t]{0.6\hsize}
\vspace{-2cm}
{\fontsize{60}{60}
{\gt
東京エリア \\
デビアン \\
勉強会
}}
\end{minipage}
\begin{minipage}[b]{0.4\hsize}
\hspace{-1cm}\includegraphics[width=9cm]{image200502/openlogo-nd.eps}
\end{minipage}

\vspace{3cm}
\hfill{}Debian勉強会幹事 上川純一\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{上川純一}
 
 今月のDebian勉強会へようこそ。
 これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
 るという方も、月に一回Debianについて語りませんか？

 目的として次の二つを考えています。

 \begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報につ
       いて情報共有する場をつくる
 \item Debianを利用する際の情報をまとめて、ある程度の塊として整理するた
       めの場をつくる
 \end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。

 Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
 情報の共有をしたい、というのが目的です。


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川純一}

今回の事前課題は
「XXXX」
というタイトルで200-800文字程度の文章を書いてください。というものでした。
その課題に対して下記の内容を提出いただきました。

\subsection{}

\subsection{上川}

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2007年XX号}
\url{http://www.debian.org/News/weekly/2007/XX/}
にあるX月X日版です。

\santaku
{}
{}
{}
{}
{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会27回目報告}
% (query-replace-regexp "<.*>" "")

\dancersection{Debian etch へのアップグレード検証会議}{上川純一}
\label{sec:upgradeetch}

みなさんはもう、アップグレードはお済みですか?いろいろと活用していると気
になるアップグレード状況。
みんなのアップグレード結果を聞いてみましょう。


\dancersection{もう、エッチになってる?}{小室あや}
\label{sec:etch2}

\subsection{はじめに}
\subsection{exim}
\subsection{mysql}
\subsection{php}
\subsection{その他の情報源}


\dancersection{Debconf7 発表計画}{岩松さん+上川}



\dancersection{What's up with pbuilder?}{上川}


この文書は pbuilder とは何か、そして、最近は何がおきたのか、そしてこれか
ら近い将来になにがおきることが予測されるのかということを紹介する記事です。

Debconf7で紹介する予定の内容です。

\subsection{pbuilder の利用コンセプト}

pbuilder はchroot のイメージを管理し、ビルドのたびに新しいイメージを展開
することを通し、試験用にクリーンルーム環境を利用する行為を簡便にします。

操作のために利用する単純なコマンドがいくつかあります。\texttt{pbuilder
create}、 \texttt{pbuilder update}、 \texttt{pbuilder
build}\footnote{pdebuild命令のほうが便利な場合があります}命令がよく利用
される例です。詳細な情報が必要であれば、 pbuilder のマニュアルを参照して
ください。\url{/usr/share/doc/pbuilder/pbuilder-doc.html}にあります。

設定が適切に行われ初期化が終了していれば、
\texttt{pbuilder build} コマンドは
\texttt{.dsc} ファイル(Debianのソースパッケージ)をあたえられると chroot
内部でパッケージをビルドします。

\begin{tabular}{|l|l|l|}
\hline
操作 & 操作頻度 & 意味 \\
\hline
create & base.tgz を作成するのに一度 & ベースファイルシステムの作成 \\
update & 一日一回 (unstable のアップデートに伴う) & ベースファイルシステ
 ムの更新 \\
build & パッケージビルドのたび & Debianパッケージを chroot 内部でビルド
 する \\
\hline
\end{tabular}

Debian Developer の通常の一日に発生するイベントを検討してみましょう。

%\begin{wrapfigure}{rt}{0.4\hsize}\includegraphics[width=1\hsize]{image200705/develcycle.eps}\end{wrapfigure}

\begin{center}
 \includegraphics[width=0.6\hsize]{image200705/develcycle.eps}
\end{center}

pbuilder は確認するためにパッケージのビルドのプロセスに組み込まれていま
す。
\footnote{これはひとつの例です。例えば、一部の開発者はローカルでビルドするという
ことをせず、chroot 内部で全部の作業を完結しているようです。}  これは、
Build-Dependsを正しく設定できているのか試験するのに便利です。
また簡単な再帰テストのフレームワークとして活用できます。

\subsection{pbuilder 自身の開発の仕組み}

pbuilder 自身がどう開発されているのか解説します。
現在、 alioth で提供されているリソースを活用して co-maintain(共同メンテ
ナンス) されていま
す。最近の主要な開発メンバーは Lo\"ic Minier と上川です。

プロジェクトページは
\url{http://alioth.debian.org/projects/pbuilder}にあり、
ホームページは
\url{http://pbuilder.alioth.debian.org/}
にあります。ホームページはpbuilderマニュアルになっています。


ソースコードの管理にはgitを利用しています。
レポジトリは下記のコマンドのいずれかを利用してチェックアウトできます。
\footnote{sshアクセスには alioth のアカウントが必要です}

\begin{verbatim}
git-clone git://git.debian.org/git/pbuilder/pbuilder.git
git-clone http://git.debian.org/git/pbuilder/pbuilder.git
git-clone ssh://git.debian.org/git/pbuilder/pbuilder.git
\end{verbatim}

\subsection{派生物とその状況}

pbuilder にはいくつかの派生物があり、異なるバックエンドをサポートしてい
ます。
それらは別の方法をクリーンルーム試験環境を提供するのに利用しています。
それらを簡単に紹介します。

\subsubsection{LVM スナップショット版}

だれかがLVMスナップショットをbase.tgz の管理用に利用する仕組みを提案しま
した。
どっかにメールで投稿されています。ただ、誰も採用して開発を継続しようとは
していないようです。
環境の分離方法は chroot を利用しています。
LVMスナップショットの利点としては、 tar アーカイブの展開より格段に高速だ
という点があげられます。

\subsubsection{user-mode-linux 版}

pbuilder-uml が存在します。どうやらほとんどの人が利用できているようです。
Mattia Dongili たちがこの移植版の開発に携わっています。

base.tgz の展開のかわりに UML cow デバイスでクリーンルーム環境の維持が実
現されています。また、 chroot のかわりに user-mode-linux を活用しており、
結果として各種システムコールが遅くなり全体としては実行オーバヘッドがあります。

\subsubsection{cowdancer 版}

上川は　cowdancer 版の作業を 2005 年くらいから行っています。
安定しているようです。
 base.tgz の展開が
\texttt{cp -la } におきかわっており、高速です。

ただし、 cowdancer  が libc のコールをフックして実現しているため、
一部のパッケージのビルドに影響が出る可能性があります。\footnote{Etchのリ
リースの際には、残念ながら Bug 413912 のような問題が発生しました。}

\subsubsection{qemu 版}

上川は  qemu/kqemu/kvm 版の開発を2007年初頭から始めました。
 QEMUの COW ブロックデバイス機能を活用しているため、base.tgzの展開が不要にな
 ります。

qemu版は別アーキテクチャ向けのビルド(クロスビルド)機能を提供するという特
徴があります。
たとえば i386 マシン上でARM用のパッケージをビルドすることだってできるは
ずです。

\subsection{さらなる開発のアイデア}

\subsubsection{インストールテスト}

There are other projects such as piuparts which can be leveraged by
pbuilder.  

pbuilder does provide example script for testing installation:
\url{/usr/share/doc/pbuilder/examples/execute_installtest.sh}.

\begin{verbatim}
pbuilder execute \
  /usr/share/doc/pbuilder/examples/execute_installtest.sh \
  pbuilder
\end{verbatim}

This command will try to install the package using apt-get into the
chroot.

\subsubsection{Package testing}

Package testing is a feature that is usually useful, especially since
developer time is limited, and repeated manual testing is no fun.
pbuilder includes an example hook script
\url{/usr/share/doc/pbuilder/examples/B92test-pkg} which will test
package after a successful build.

The test files are shell scripts placed in
\verb!debian/pbuilder-test/NN_name! (where NN is number) following
run-parts standard for file names \footnote{no '.' in file names!}.

\subsubsection{aptitude}

pbuilder exclusively depends on apt-get.  It might be time to look at
what is missing to get aptitude working.

\subsubsection{apt-key support}

pbuilder currently lacks apt-key support.  Since apt-key support is
definitely available in the current stable releases, it is about time to
start considering supporting apt-key.

\subsubsection{build-dependency parser}

Build-dependency parser has been somewhat old and suboptimal.  Lo\"ic
Minier has been working on refreshing it.

\subsubsection{buildd.net-like support}

pbuilder creates a bunch of useful build logs, but it lacks the notion
of history. It does not have an infrastructure to aggregate and put them
to use.  \footnote{Some projects to create \texttt{pbuildd} did exist,
but I am not sure if it still exists today.  } Collecting past build
logs even locally and comparing them between builds may alert problems,
used in conjunction with tools like debdiff.

\subsection{References}

\begin{itemize}
 \item \url{http://pbuilder.alioth.debian.org/} or
 \url{/usr/share/doc/pbuilder/pbuilder-doc.html}: pbuilder manual
 \item cowdancer package
 \item piuparts package
 \item autodebtest: Ubuntu automatic testing system
 \item schroot / dchroot 
 \item buildd
\end{itemize}


\dancersection{次回}{}

未定です。
内容は本日決定予定です。

参加者募集はまた後程。

\cleartooddpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule
\end{minipage}

\end{document}
