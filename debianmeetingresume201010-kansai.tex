%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Kansai Debian Meeting resources
%     Copyright (C) 2007 Takaya Yamashita
%     Thank you for Tokyo Debian Meeting resources

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200708; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{kansaimonthlyreport}
\usepackage[dvips]{xy}
\usepackage{ascmac}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2010}
\newcommand{\debmtgdate}{24}
\newcommand{\debmtgmonth}{10}
\newcommand{\debmtgnumber}{40}

\begin{document}

\begin{titlepage}

% 毎月変更する部分、本文の末尾も修正することをわすれずに

 第\debmtgnumber{}回 関西 Debian 勉強会資料

\vspace{2cm}

\begin{center}
\includegraphics{image200802/kansaidebianlogo.png}
\end{center}

\begin{flushright}
\hfill{}関西 Debian 勉強会担当者 佐々木・倉敷・のがた \\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日
\end{flushright}

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{Debian JP}

\subsection*{}%ロゴ用のスペース稼ぎ
 
関西 Debian 勉強会はDebian GNU/Linux のさまざまなトピック(新しいパッケー
ジ、Debian 特有の機能の仕組、Debian 界隈で起こった出来事、などなど）に
ついて話し合う会です。

目的として次の三つを考えています。
\begin{itemize}
      \item MLや掲示板ではなく、直接顔を合わせる事での情報交換の促進
      \item 定期的に集まれる場所
      \item 資料の作成
\end{itemize}

それでは、楽しい一時をお楽しみ下さい。

\clearpage

\begin{minipage}[b]{0.2\hsize}
 {\rotatebox{90}{\fontsize{80}{80}
{\gt 関西 Debian 勉強会}}}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\setcounter{tocdepth}{1}
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{最近のDebian関係のイベント報告}{Debian JP}

\subsection{第 39 回関西 Debian 勉強会}

前回の関西 Debian 勉強会は、9 月 26 日に
(財)京都高度技術研究所(ASTEM)\footnote{\url{http://www.astem.or.jp/}}様のご協力のもと
「タイル型ウィンドウマネージャ対決」という内容で行なわれました。
%
山田洋平さんによるタイル型ウィンドウマネージャの入門と dwm の解説、
倉敷悟さんによる xmonad の解説、
山下尊也さん(久々参加!!)による awesome の解説が非常に濃ゆく行なわれました
のがたさんによる
「この濃さなら、
資料書いてもらうべきだっだんじゃね?(by nogajun)」という呟きもありましたが
%
参加者も見做さん楽しんで頂けたのではないでしょうか?

勉強会後は同じ会場でビアバッシュ、ということで、ピザとビールで歓談しました。
ちなみにその場で KOF のタイトルが決まったりしました。
以前やまねさんに言われました通り、
関西は毎度毎度飲み会で物事が決まるみたいです(笑)。

\subsection{2010 年度日本 OSS 貢献者賞・日本 OSS 奨励賞}

IPA より 2010 年度日本 OSS 貢献者賞・日本 OSS 奨励賞受賞者の発表がありました%
\footnote{\url{http://www.ipa.go.jp/about/press/20101015_2.html}}。
今年度は Debian JP Project より、
武藤 健志さんが OSS 貢献者賞、岩松 信洋さんが OSS 奨励賞を受賞しました。
素晴しいですね。

\subsection{第 69 回東京エリア Debian 勉強会}

10 月 16 日に東京エリアDebian勉強会が開かれました。 
特集として「俺の Debian な一日」という事前課題が報告されています。 
非常に興味深いので、一度ご覧下さい%
\footnote{%
\url{http://tokyodebian.alioth.debian.org/pdf/debianmeetingresume201010.pdf}}
\footnote{個人的には、小室文さんの生活がうらやましすぎる...}.
セッションは OSC 北海道の報告、
Debconf10 の報告、上川さんによる「俺の Debian な一日」でした。

また Debian Miniconf in Japan に関するブレストが行なわれています。

日本で Debconf を開催する/日本に誘致するために、
先ずは Miniconf の開催から始めよう、という計画です。
興味のある方は、勉強会資料をご覧下さい。 
また、ご意見ある方は隔週木曜に開催されている 
IRC ミーティングへ参加してみては如何でしょうか?
\footnote{%
IRC サーバ: {\tt{irc.debian.or.jp:6667}}、
チャンネルは {\tt{\#debianjp}}、文字コード: UTF-8 です。}

\dancersection{事前課題}{Debian JP}

今回は以下の課題を設定しました。
%
\begin{quote}
    \begin{screen}
        　レスキュー用途とインストール用途を除く、
        ライブシステムを使用する状況や用途を教えて(または考えて)ください。
    \end{screen}
\end{quote}
%
参加者の皆さんによる回答は以下の通りです。

\begin{prework}{ Ipv6waterstar }

現在, インストールしている Debian システムの環境を変えずに別のシステム環境を試したい時など.

\end{prework}



\begin{prework}{ dictoss (杉本  典充) }

    \begin{itemize}
          \item 公共スペースに設置するパソコンのブートディスクとして使用する.
        　\\
        そうすると OS やアプリの設定を勝手に変えられても再起動すれば直るため, OS の修復の手間が省ける. 
        (ネットワークブートという手もあるが, ライブシステムはスタンドアロンで起動可能な分, 敷居が低い)
\end{itemize}

\end{prework}



\begin{prework}{ 山田 洋平 }

昔 1FD Linux で HDD の載ってない古い PC を動かして, 起動後はディスクレスだから静穏とか言ってました. ルータとかに使ってました. そういうのとか. 
あるいはいろんな環境をとっかえひっかえ試すとか. ソフトのテスト環境としてとか. (仮想化でもいいのだけど)

\end{prework}



\begin{prework}{ かわだてつたろう }

    \begin{itemize}
          \item 借り物の PC や不特定の人が使う PC で自分好みの環境を使うため
          \item 複数の人に同じ環境, アプリケーションを使ってもらいたい場合. 
        「第 37 回関西 Debian 勉強会@OSC2010 Kyoto 」とか OSM で JOSM の使い方講習をするといったような用途      
    \end{itemize}
  

\end{prework}



\begin{prework}{ 八津尾  雄介 }
    \begin{enumerate}
          \item パーティションが一杯になって拡張が必要なとき. 
        (これもレスキューですか?)
          \item 自分の環境を持ち歩きたいとき. 
    \end{enumerate}

\end{prework}



\begin{prework}{@tetsu\_koba }

例えば, 同僚が「今日は一日外出するのでデスクトップ PC は使わない」とする. 
その PC をライブ CD で起動して distcc のサーバを動かす. 
ビルドする時にその PC の CPU パワーを借りて分散コンパイルする. 

これがお手軽にできるセットがあったら使ってみたい. 

\end{prework}



\begin{prework}{ 山下康成 }

藤丸君のように, USB メモリでいつでも自分のハッキング環境が持ち歩けるのではないでしょうか

\end{prework}



\begin{prework}{ 佐藤誠 }

    \begin{itemize}
          \item データ削除　\\
        wipe-out のように, それに特化したライブシステムもあります.         
          \item アドホックなシステム構築　\\
常時接続の切れたとき, 即席のルータを構築して凌いだことがあります. 
このような時は, ユーザデータや余計な設定のないライブシステムが便利だと思います. 
Knoppix Hacks には, MySQL データベースの即席構築例が載っていました
(まあ, このあたりもレスキュー用途に入りそうですが)
    \end{itemize}

\end{prework}



\begin{prework}{ 西山和広 }

    uuuu という勉強会\footnote{\url{http://www.cuzic.com/undefineduniversityuponustream}} 
    で YouTube の講義ビデオを再生するのに, ノート PC の内蔵 HDD が不調のため, netboot のライブ環境を使っています. 
    プログラムのテスト環境にも使いたいのですが, データベースを使うものの場合, メモリ不足で厳しいようです.

\end{prework}



\begin{prework}{ "まさ"こと"甲斐正三"です }

以下の用途は実施したことはありませんが, 実施可能性ありと
思われる場面を想定したものです. 
\begin{itemize}
      \item 教育用途 (案)　\\
    セミナーのハンズオンを行うとき, 受講者全員に共通な環境を提供する. 
      \item 新規システム等の評価検討用 (案)　\\
    新規システムや新規ソフトウエアを事前評価, 
    検討する際に使用する. 
    例として, 
    \begin{itemize}
          \item ある PC に Debian をインストールできそうかどうかをその PC 自体を使って Live CD で起動してみる. 
    \end{itemize}
\end{itemize}

\end{prework}



\begin{prework}{ takuya.1st }

シンクライアントとか?

みんなが帰ったとの PC にライブシステム突っ込んで分散処理を作るとか?

もちろん, ソフトウェアのデモ用にも使えますよね. 
KOF のような展示会用に PC を毎回作らなくても CD 用意して持って行けば OK とか


\end{prework}



\begin{prework}{ lurdan }

最近は起動も速いみたいだし, なんらかのクラウドストレージを HOME として組み込んだら, シンプルなクライアントとしては充分だったりするんじゃないかと妄想. 

\end{prework}



\begin{prework}{ 佐々木洋平 }

以前, ハンズオン形式の実習/ 教育機関での計算機演習などで, 受講者の環境を揃えるために使用しました (その時には, CentOS と Debian の dual boot な環境が必要で, DebianLive のエキスパートであるのがたさんに助けて頂きました).

\end{prework}



\begin{prework}{ のがたじゅん }

古くなった PC にライブシステムを組み込みメンテナンスフリーなシステムを作りました. ほかにはネットワークからブートするライブシステムで面白いことできないかなーと思案中.

\end{prework}




\dancersection{initramfs について}{西山　和広}
\subsection{initrd/initramfs とは?}

\begin{itemize}
\item Linux の起動途中に使われる root ファイルシステム
\item この中で本当の root ファイルシステム (real root) をマウント
\item 実体は gzip された cpio アーカイブ

\begin{itemize}
\item 昔は ext2 のディスクイメージファイル
\item gzip の代わりに lzma のこともある (casper/initrd.lz など)
\end{itemize}

\end{itemize}
\subsection{いろいろなところからの Linux の起動}

\subsubsection{USB/HDD から起動}

\begin{itemize}
\item BIOS (起動順位で USB/HDD が上)
\item MBR (grub などのブートローダー)
\item vmlinuz (カーネル) + initrd (の中の /init)
\item real root (/dev/sda1 とか) の /sbin/init
    (MD, LVM2, LUKS などでも OK)
\item /etc/inittab の処理とか
\end{itemize}
\subsubsection{光学ドライブから起動}

\begin{itemize}
\item BIOS (起動順位で光学ドライブが上)
\item El Torito (isolinux などのブートローダー)
\item vmlinuz (カーネル) + initrd (の中の /init)
\item real root (filesystem.squashfs + aufs とか) の /sbin/init
\item /etc/inittab の処理とか
\end{itemize}
\subsubsection{ネットワークから起動}

\begin{itemize}
\item BIOS (起動順位で NIC が上)
\item PXE boot (pxelinux などのブートローダー)
\item vmlinuz (カーネル) + initrd (の中の /init)
\item real root (NFS とか) の /sbin/init
\item /etc/inittab の処理とか
\end{itemize}
\subsubsection{real root の場所}

  カーネルに root=UUID=xxx などで指定
\begin{itemize}
\item ローカルディスク (root=/dev/sda1 など)
\item 光学ドライブ (root=/dev/hdc など)
\item NFS (nfsroot=192.168.0.1:/path/to/nfsroot など)
\end{itemize}
  など

\subsubsection{/proc/cmdline}

\begin{itemize}
\item カーネルのコマンドライン引数
\item カーネルパラメーター
\item 起動後に /proc/cmdline で見えるもの
\item grub などで vmlinuz の後ろに書いているもの
\item initramfs の処理で使うものが多い
\item カーネル自体が処理するものもある
\item real root で起動するプログラムが参照する目的で使っても良いが、カーネルや initramfs が使うものと衝突しないように注意
\end{itemize}
\subsubsection{/proc/cmdline で良く使われるものの例}

\begin{description}
\item [quiet] 起動中のコンソールへの出力を減らす
\item [ro / rw] initramfs の中で real root を readonly mount するかどうか
\item [\texttt{init=/path/to/real\_init}] /sbin/init の代わりに実行するプログラムを指定
\item [acpi=off apm=off など] カーネルが処理
\item [text] /etc/init.d/gdm3 が「grep -wqs text /proc/cmdline」でチェックしている
\item [root=/path/to/blockdevice] ルートファイルシステムとしてマウントするデバイスを指定
\item [boot=local / boot=nfs / boot=casper / boot=live] real root を mount するのに使うスクリプトを指定
\end{description}
\subsection{initramfs について}

\subsubsection{update-initramfs}

\begin{itemize}
\item initramfs はパッケージの中身ではない
\item update-initramfs コマンドで生成や更新
    (カーネルのパッケージのインストール時などは dpkg-trigger で遅延実行)
\item \texttt{/usr/share/initramfs-tools/} や \texttt{/etc/initramfs-tools/} を元に生成
\item 「sudo update-initramfs -u -k all」などで更新
\end{itemize}
\subsubsection{initramfs の調べ方}

\begin{verbatim}
 mkdir -p /tmp/initrd && (cd /tmp/initrd && { zcat /boot/initrd.img-* | cpio -idm; })
\end{verbatim}


\begin{verbatim}
 # initramfs-tools(8)
 mkdir tmp/initramfs
 cd tmp/initramfs
 gunzip -c /boot/initrd.img-2.6.18-1-686 | \
 cpio -i -d -H newc --no-absolute-filenames
\end{verbatim}


\begin{verbatim}
 # linux-2.6/Documentation/initrd.txt
 mkdir /tmp/imagefile
 cd /tmp/imagefile
 gzip -cd /boot/imagefile.img | cpio -imd --quiet
\end{verbatim}


などのように展開
(カレントディレクトリにばらまかれるので展開場所には注意)

\subsubsection{initramfs の中身}

\begin{description}
\item [./init] カーネルが実行するプログラム

\begin{itemize}
\item Debian 系の場合は /bin/sh のシェルスクリプト
\item Redhat 系の場合は以前確認したときは nash だった
\end{itemize}

\item [./scripts] ./init から読み込まれたり実行されたりするプログラム
\item [./bin や ./sbin] busybox など
\item [./conf や ./etc] 設定ファイル
\item [./lib や ./usr] ライブラリやカーネルモジュールなど
\end{description}
\subsection{initramfs のカスタマイズ}

\begin{itemize}
\item \texttt{/etc/initramfs-tools/} 以下のファイルを編集したり、ファイルを追加したり。
\item Debian Live のようにパッケージなら \texttt{/usr/share/initramfs-tools/} 以下にファイルを追加する。
\end{itemize}
\subsubsection{/etc/initramfs-tools}

\begin{description}
\item [initramfs.conf, update-initramfs.conf] update-initramfs や mkinitramfs の設定ファイル
\item [modules ] initramfs の中でロードするモジュール (後でロードすればいいものは \texttt{/etc/modules} を使う)
\item [conf.d/] initramfs の \texttt{conf/conf.d/} に入る。
\item [hooks/] \texttt{/usr/share/initramfs-tools/hooks/} と同様に initramfs 作成時に実行される。
\item [scripts/] \texttt{/usr/share/initramfs-tools/scripts/} と一緒に initramfs の scripts/ に入る。
\end{description}
\subsubsection{hooks/}

/usr/share/initramfs-tools/hook-functions の関数で initramfs の中身を生成
\begin{itemize}
\item \texttt{copy\_exec} で追加しておきたいバイナリをコピー
    (ldd でわかる範囲内で使っているライブラリを含めてコピーされる)
\item \texttt{manual\_add\_modules} でモジュールをコピー
\item その他のファイルを追加や削除など
\end{itemize}
\subsection{scripts/}

\begin{itemize}
\item カスタマイズする処理本体
\item live 関係なら以下のようなものが入る。
  (BOOT=live のときに使われる)

\begin{itemize}
\item live
\item live-bottom/
\item live-functions
\item live-helpers
\item live-premount/
\end{itemize}

\end{itemize}
\subsection{./init の処理内容}

\begin{itemize}
\item ``Loading, please wait\ldots{}'' のメッセージが出たところからが initramfs の中の処理
\item initramfs 内の ディレクトリの準備
\item initramfs 内の /dev や udev の準備
\item 後で起動するシェルスクリプトなどのために、いくつかのシェル変数を環境変数に
\item conf ファイルの読み込み

\begin{itemize}
\item ./conf/initramfs.conf
\item ./conf/conf.d/
\end{itemize}

\item カーネルのコマンドライン引数 (/proc/cmdline) の解析
\item noresume と netconsole を処理
\item \texttt{maybe\_break top}
\item (scripts/functions の中で \texttt{maybe\_break} や \texttt{panic} や \texttt{run\_scripts} がある)
\item \texttt{run\_scripts /scripts/init-top}
\item ./conf/modules に書いてあるモジュールをロード
\item 「. /scripts/\$\{BOOT\}」で定義される mountroot を実行して real root をマウント (普通の起動時は \texttt{./script/local} )
\item 最初の方でマウントした sysfs と proc を本当の root ファイルシステム (real root) に移動
\item プロセス ID 1 の init になるプログラムの存在やパーミッションをチェック
\item init に不要な環境変数を unsetenv
\item real root に移行
\end{itemize}


\dancersection{最近の Debian Live の動向}{のがたじゅん}
%
% add article here
%


\dancersection{今後の予定}{Debian JP}

\subsection{次回の関西Debian勉強会}
次回の関西 Debian 勉強会は
関西オープンソース 2010 $+$ 関西コミュニティ大決戦で行ないます。
演目は
\begin{description}
      \item[でびあん らんだむとぴっくす 〜 Squeezeマダァー?（・∀・ ）っ/凵⌒☆チンチン]　\\
    時間: 13:00〜 (50 min) [ 会場 : 9F セミナールーム2 ]
      \item[GPGキーサインパーティ]　\\
    時間: 11/6 17:00〜 (50 min) [ 会場 : 9F セミナールーム3 ]
\end{description}
となっています%
\footnote{ホントにこのタイトルで喋るのかぁ...Orz}。

GPG キーサインパーティに参加する場合には事前登録が必要です。
事前登録サイト%
\footnote{{\tt{http://www.math.kyoto-u.ac.jp/~uwabami/ksp-kof2010/}}} 
にアクセスし、公開鍵を登録して下さい。 よろしくお願いします。


% 冊子にするために、4の倍数にする必要がある。
% そのための調整

\printindex
 \cleartooddpage

 \begin{minipage}[b]{0.2\hsize}
  \rotatebox{90}{\fontsize{80}{80} {\gt 関西 Debian 勉強会} }
 \end{minipage}
 \begin{minipage}[b]{0.8\hsize}

 \vspace*{15cm}
 \rule{\hsize}{1mm}
 \vspace{2mm}
 \includegraphics[width=2cm]{image200502/openlogo-nd.eps}
 \noindent \Large \bf Debian 勉強会資料\\ \\
 \noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
 \noindent \normalfont 関西 Debian 勉強会 （編集・印刷・発行）\\
 \rule{\hsize}{1mm}
 \end{minipage}

\end{document}
