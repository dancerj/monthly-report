%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2010 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201002; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
\usepackage{wrapfig}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2010}
\newcommand{\debmtgmonth}{3}
\newcommand{\debmtgdate}{20}
\newcommand{\debmtgnumber}{62}

\begin{document}
\begin{titlepage}
\thispagestyle{empty}

% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics[width=210mm]{image201003/debsen.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日\\
%\vspace*{-2.4cm}

\rotatebox{10}{\fontsize{32}{32} {\gt 特集1: ニューラルネットワーク特集}}

\rotatebox{10}{\fontsize{32}{32} {\gt 特集2: man-dbにはまってみた} }

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

\dancersection{Introduction}{上川 純一}

\begin{multicols}{2}
 
 
 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:

\begin{enumerate}
 \item 好きな日本語Manページ
 \item ニューラルネットワークで解決できる問題
\end{enumerate}

この課題に対して提出いただいた内容は以下です。

\input{image201003/prework.tex}

\dancersection{最近のDebian関連のミーティング報告}{前田耕平}
\subsection{東京エリアDebian勉強会61回目報告}
% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

今月のDebian勉強会は木更津高専の教室とその近所の公民館をお借りして1泊2日
で開催しました。木更津側で会場の準備、参加者の募集をしてくださった坂口さ
ん、大枝先生、宿泊手続きを中心に幹事サポートをしてくださったやまねさん、
プレゼンターの皆さん(やまねさん、日比野さん、坂口さん、上川さん)、そして
参加していただいた皆さんのおかげで、無事成功裏に終えることができたと思い
ます。皆様ありがとうございました。 

セッションの時間配分や宿と会場との移動が忙しなくなってしまった点など、タ
イムスケジュールに問題があったのは私の至らぬ点が原因ですので、反省点とし
て次回以降に活かしたいと思います。 

勉強会で行った内容については、事前配布資料や発表資料、参加者のブログにも
掲載されると思いますのでここでは特に触れませんが、今回の勉強会の表向きの
テーマは「関数型言語」「温泉」でしたが、開催してみて気づいた真のテーマは
「縁」でした。やまねさんが事前課題回答、セッションでDebianを使う理由に
「縁」を挙げていましたが、まさに「縁」がきっかけで開催でき、今回の勉強会
をきっかけに新たな「縁」が出来たなと思います。Debian勉強会を通じた縁以外
に、関数型言語やニューラルネットワークといった興味のある話題を通じた縁、
debian-usersのMLを通じた縁、DebianとUbuntuというディストリビューションを
通じた縁、一昨年のDebian温泉を通じた縁、などなど色々ありますが、特に昨年
秋のOSCで「東京都心だけでなく木更津などの郊外でも開催してほしい」と坂口
さんが要望を出し、現地の幹事として実際に動いてくださった、というのが一番
大きな縁じゃないかと思います。 

今週末にはOSC 2010 Tokyo/Springがあり、そこで東京エリアDebian勉強会もブー
スとセッションを出すので、今回参加された皆さんはもちろん、参加出来なかっ
た方も、参加したことが無かったけど興味が出てきた方も、ぜひ足を運んでいた
だければと思います。「縁」を深め、また新たな「縁」ができるとよいですね。


%-------------------------------------------------------------------------------
\dancersection{ニューラルネットワークで画像認識してみた}{本庄弘典}
%-------------------------------------------------------------------------------
\index{neural network}
\index{back propagation}
\index{がぞうにんしき@画像認識}

\subsection{はじめに}

ドキュメントスキャナで本をスキャンした際、画像のサイズが大きすぎ
るため保存に適しません。この画像を２値画像とグレースケール、カラー
画像それぞれの処理を加えることでファイルサイズを縮小し、ニューラ
ルネットを用いることによりある程度自動化できないかと考えました。
今回はニューラルネットとして一般的な三層パーセプトロンを用いた画
像判別の一例を解説します。

\subsection{三層パーセプトロンとバックプロパゲーション}

\subsubsection{三層パーセプトロン}

三層パーセプトロンは入力層、中間層、出力層と別れた三層の各ニュー
ロンが重みと呼ばれる係数で結ばれたモデルとなります。

\begin{figure}[H]
\begin{center}
\caption{三層パーセプトロン}
\includegraphics[width=0.45\hsize]{image201003/neuralnet01.png}
\end{center}
\end{figure}

それぞれの重みは実数で表され、パーセプトロンが機能するためにはこ
の重みが適切に設定されている必要があります。ある入力が与えられた
際、入力値に重みを掛け合わせ、それぞれの合計に次のようなシグモイ
ド関数を適用した数値を中間層の持つ値とします。

\begin{multicols}{2}

\begin{figure}[H]
\begin{center}
\caption{シグモイド関数の式}
\includegraphics[width=0.5\hsize]{image201003/neuralnet02.png}
\end{center}
\end{figure}

\begin{figure}[H]
\begin{center}
\caption{シグモイド関数のグラフ}
\includegraphics[width=1.0\hsize]{image201003/neuralnet03.png}
\end{center}
\end{figure}

\end{multicols}

各出力層も同様の計算がなされ、パーセプトロンの出力が行われます。

\subsubsection{バックプロパゲーション}

多層パーセプトロンで適切な出力を行うための学習方法として一般的な
ものにバックプロパゲーションがあります。バックプロパゲーションで
はまず入力に対する正しい出力(教師信号)を多数用意し、各重みをラン
ダムに設定します。用意された入力に対してランダムな重みからパーセ
プトロンの出力はでたらめな値となりますが、この出力と教師信号との
比較から出力層と中間層の間の重みを修正し、次いで中間層と入力層の
重みを修正することで適切な重みを探し出します。

\subsection{足し算と引き算を学習してみる}

作成したパーセプトロンとバックプロパゲーションが正常に動作するか
を確かめます。次のような入力を用意しました。

\begin{commandline}
# 学習用教師信号ペア
0.40,0.20	0.60,0.20
0.30,0.20	0.50,0.10
0.80,0.10	0.90,0.70
0.20,0.10	0.30,0.10
0.50,0.50	1.00,0.00
0.60,0.20	0.80,0.40
# 評価用入力値
*0.50,0.10
*0.50,0.40
*0.10,0.40
\end{commandline}

入力値と教師信号のペアはタブ区切りの左が入力、
右が入力に対する教師信号です。
ここでは足し算と引き算の教師信号を与えました。

\newpage

実行します。

\begin{commandline}
$ ./backprop.exe sample.txt 10000
       0 0.87640153
     100 0.26410368
     200 0.10289131
     300 0.03820243
     400 0.02475167

...(中略)...

    9600 0.00077714
    9700 0.00077174
    9800 0.00076646
    9900 0.00076128
0.4000, 0.2000  0.60, 0.18      0.60, 0.20
0.3000, 0.2000  0.50, 0.11      0.50, 0.10
0.8000, 0.1000  0.90, 0.70      0.90, 0.70
0.2000, 0.1000  0.30, 0.11      0.30, 0.10
0.5000, 0.5000  0.98, 0.02      1.00, 0.00
0.6000, 0.2000  0.80, 0.41      0.80, 0.40
0.5000, 0.1000  0.63, 0.35
0.5000, 0.4000  0.93, 0.06
0.1000, 0.4000  0.87, 0.00
Ratio=0.00075626
Count=10000
Sample=6
Input=2
Middle=4
Output=2
InputHidden0=-2.57936471,-2.20525001,-1.50656422,4.05055823,-0.66468037
InputHidden1=-1.29032439,8.71632107,-1.24344376,-0.85214732,-0.66468037
InputHidden2=2.04901840,-2.94096519,1.04866634,-1.98825291,0.29698485
HiddenOutput0=-2.91458436,-1.16992032
HiddenOutput1=5.84673832,-6.31188860
HiddenOutput2=-1.80018561,-0.42470539
HiddenOutput3=3.60356071,3.84028669
HiddenOutput4=1.40998866,-1.22885398
\end{commandline}

頼りないながらもそれなりの演算結果が出力されています。評価として
最後の数値は減算結果が負になるはずなのですが、シグモイド関数を通
すことで出力が0.0〜1.0となるため正常な結果が得られません。

\subsection{画像を分類するための入力値を考える}

画像判別の入力値として次の値を使用しました。

\begin{itemize}
\item 補正した画像のRGBの差
\item 微分した画像のRGBの差
\item 画像の複雑さ。
\item 使われている色の数
\item 平均彩度
\item FFT処理した画像の明るいピクセルを利用する
\item HSVに変換し、色素の平均を利用する
\item 色素の分散を利用する
\end{itemize}

この中から文章と絵の判別として画像のFFTを、カラー画像の判別とし
てHSVへの変換を解説します。

\newpage

\subsubsection{モノクロ画像の処理・文字と絵を分類してみる}

縦書きの文章は横方向に一定の周波数を持っていると見なすことが出来
ます。これにより、文章の画像を微分しFFT処理を行った結果から振幅
を描画するとで、明るく光る点が現れることがわかりました。

\begin{figure}[H]
\begin{center}
\caption{イラストと文章を微分した画像のFFT結果}
\includegraphics[width=0.9\hsize]{image201003/neuralnet04.png}
\end{center}
\end{figure}

この点の明るさを入力値とすることで、文章とイラストの判別が行える
と期待できます。

\subsubsection{カラー画像とそうでない画像を分類してみる}

カラー画像とモノクロ画像は画像のRGBをHSVに変換し、色相から判別を
行っています。

RGBのうちから最大のものをMAX、最小のものをMINとすると色相は次の
式となります。

\begin{figure}[H]
\begin{center}
\caption{色相の計算式}
\includegraphics[width=0.5\hsize]{image201003/neuralnet05.png}
\end{center}
\end{figure}

モノクロ画像は色相を持たないため、RGBのうち青の成分を減らすこと
で黄色いフィルタをかけました。こうすることでモノクロ画像の色相の
平均は黄色となり、カラーとモノクロを判別するための入力値として期
待できます。

%-------------------------------------------------------------------------------
\dancersection{wekaを使ってみる}{前田耕平}
%-------------------------------------------------------------------------------
\index{weka}
\subsection{概要}
\subsection{インストール}

Debian ではパッケージが用意されています。

\begin{commandline}
$ sudo apt-get install weka
\end{commandline}

\subsection{wekaの使い方}

コマンドラインで \texttt{weka} コマンドを実行します。

\begin{commandline}
$ weka &
\end{commandline}

weka のウィンドウが起動します。

\begin{figure}[H]
\begin{center}
\caption{Weka 起動メニュー}
\includegraphics[width=0.5\hsize]{image201003/weka0.png}
\end{center}
\end{figure}

``Applications'' の ``Explorer''を実行します。

\begin{figure}[H]
\begin{center}
\caption{Weka Explorer}
\includegraphics[width=1.0\hsize]{image201003/weka1.png}
\end{center}
\end{figure}

Weka Explorer が起動します。

\subsubsection{ARFFファイルをロードする}

Preprocess タブ

Open File

/image200812/memberanalysis/attend.arff

\subsubsection{可視化してみる}

Visualize タブ

適当に開く。

\subsubsection{分類してみる}

Classify タブ

Choose 
Multilayer Perceptron (ニューラルネットワークで分類)

(Num)attendance を目的関数

\subsection{参考文献}
\begin{itemize}
 \item \url{www1.doshisha.ac.jp/~mjin/R/23.pdf}
 \item \url{http://web.sfc.keio.ac.jp/~soh/dm03/man_w_03.html}
\end{itemize}

%-------------------------------------------------------------------------------
\dancersection{man-db を深追いした}{日比野 啓}
%-------------------------------------------------------------------------------
\index{man-db}
\index{groff}

\subsection{日本語の man が変}

こんな感じ

\par
\includegraphics[width=100mm]{image201003/manls.eps}

\subsection{解はgroffにあり}

XXXX

深追いした結果を載せる

解決案(現時点での想像)を掲載。

サスペンスもの。

%-------------------------------------------------------------------------------
\dancersection{Debian で libfftw を使ってみる}{上川純一}
%-------------------------------------------------------------------------------
\index{fftw}
\index{fast fourier transform}

\subsection{はじめに}

DebianでFFTを取り扱うCのアプリケーションを書いてみたいと思うことはあり
ませんか?今日は音声データを分析してみましょう。

wav ファイルを入力として受け取り、FFTを実行してその結果を表示するアプリケー
ションを作成してみます。

\subsection{入力値の準備}

適当に wav ファイルを用意しましょう。

今回は手元で、aeolus を起動し、 jack で接続させ、ecasound を jack 入力に
対して待機させ、qjackctl で接続させて収録しました。

\begin{commandline}
$ qjackctl &
$ aeolus &
$ vkeybd &
$ ecasound -i jack -o test.wav
ctrl-C で中断
$ sweep test.wav # 適当に編集

$ file ra-mono.wav 
ra-mono.wav: RIFF (little-endian) data, WAVE audio, Microsoft PCM, 16 bit, mono 44100 Hz
\end{commandline}
%$

\subsection{インストール}

libfftw3 をインストールします。
あと、音声ファイルをロードするために sndfile1 を利用します。

\begin{commandline}
$ apt-get install libfftw3-dev libsndfile1-dev
\end{commandline}
%$

\subsection{sine 波を作成する}

とりあえずテスト用に 440Hz の波形を作成します。

\begin{commandline}
/*BINFMTC: -lsndfile -lm

  Create a sine wave at 44.1kHz for 1 second called sine.wav
 */
#include <stdlib.h>
#include <stdio.h>
#include <sndfile.h>
#include <math.h>

int create_sine(const char* filename, int size, double frequency)
{
  SF_INFO sfinfo = {
    .frames = size,
    .samplerate = 44100,
    .channels = 1,
    .format = SF_FORMAT_WAV | SF_FORMAT_PCM_16,
    .sections = 0,
    .seekable = 0
  };
  SNDFILE* s = sf_open(filename, SFM_WRITE, &sfinfo);
  double* data = malloc(sizeof(double) * size);
  int i;

  for (i=0; i < size; ++i)
    {
      data[i] = sin(frequency * 2.0 * M_PI * i / 44100.0);
    }

  sf_writef_double(s, data, size);
  sf_close(s);
  return 0;
}

int main()
{
  return create_sine("sine.wav", 44100, 440.0);
}
\end{commandline}
\subsection{FFTWを使って wav ファイルを処理してみる}

sndfile と fftw3 を使ってフーリエ変換して出力をダンプしてみましょう。

\begin{commandline}
/*BINFMTC: -lsndfile -lfftw3 -lm
 */

#include <stdlib.h>
#include <stdio.h>
#include <sndfile.h>
#include <math.h>
#include <complex.h>
#include <fftw3.h>

/*
  process with FFTW
 */
void study_sound(double* data, int size)
{
  fftw_complex* spectrum;
  fftw_plan p;
  int i;

  spectrum = (fftw_complex*) fftw_malloc(sizeof(fftw_complex) * (size / 2 + 1));
  p = fftw_plan_dft_r2c_1d(size, data, spectrum, FFTW_ESTIMATE);

  /* process with FFTW */
  fftw_execute(p);

  /* dump output in CSV format */
  printf("i,abs,arg\n");
  for (i=0; i<(size/2+1); ++i) {
    printf("%i,%f,%f\n", i,
	   cabs(spectrum[i]),
	   carg(spectrum[i]) / 2.0 / M_PI * 360.0);
  }
  fftw_destroy_plan(p);
  fftw_free(spectrum);
}

/*
  Process wav file.

  @return 1 on failure, 0 on success.
*/
int process_wav_file(const char* filename, int size)
{
  SF_INFO sfinfo = {0, 0, 0, 0, 0, 0};
  SNDFILE* s = sf_open(filename, SFM_READ, &sfinfo);
  double* data = malloc(sizeof(double) * size);

  if (!s || !data)
    {
      fprintf(stderr,
	      "Something went wrong opening the file or allocating memory\n");
      return 1;
    }
  if (sfinfo.channels != 1)
    {
      fprintf(stderr,
	      "Please give me monaural audio data\n");
      return 1;
    }

  /* Read wav file into an array of double */
  sf_readf_double(s, data, size / sfinfo.channels);
  study_sound(data, size / sfinfo.channels);
  sf_close(s);
  return 0;
}

int main(int argc, char** argv)
{
  process_wav_file(argv[1], atoi(argv[2]));
  return 0;
}
\end{commandline}


実行してみます。

\begin{commandline}
$ ./sndfile-fftw.c sine.wav 44100 > sine.csv
$ ./sndfile-fftw.c ra-1sec.wav 44100 > ra.csv

\end{commandline}

\subsection{出力を確認してみる}

とりあえず簡単にグラフを作成するためのツールとして R を使ってみましょう。

\begin{commandline}
$ R

R version 2.7.1 (2008-06-23)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

Rはフリーソフトウェアであり、「完全に無保証」です。 
 一定の条件に従えば、自由にこれを再配布することができます。 
配布条件の詳細に関しては、'license()'あるいは'licence()'と入力してください。 

Rは多くの貢献者による共同プロジェクトです。 
詳しくは'contributors()'と入力してください。 
また、RやRのパッケージを出版物で引用する際の形式については 
'citation()'と入力してください。 
 
'demo()'と入力すればデモをみることができます。 
'help()'とすればオンラインヘルプが出ます。 
'help.start()'でHTMLブラウザによるヘルプがみられます。 
'q()'と入力すればRを終了します。 

> sine <- read.csv("sine.csv")
> ra <- read.csv("ra.csv")
> summary(sine)
       i              abs                 arg           
 Min.   :    0   Min.   :    0.000   Min.   :-179.9674  
 1st Qu.: 5512   1st Qu.:    0.000   1st Qu.:   0.0000  
 Median :11025   Median :    0.000   Median :   0.0000  
 Mean   :11025   Mean   :    1.000   Mean   :  -0.1395  
 3rd Qu.:16538   3rd Qu.:    0.000   3rd Qu.:   0.0000  
 Max.   :22050   Max.   :22049.319   Max.   : 180.0000  
> summary(ra)
       i              abs                 arg         
 Min.   :    0   Min.   :2.066e-03   Min.   :-179.93  
 1st Qu.: 5512   1st Qu.:1.467e-02   1st Qu.: -56.88  
 Median :11025   Median :1.907e-02   Median : -37.80  
 Mean   :11025   Mean   :3.944e-01   Mean   : -38.40  
 3rd Qu.:16538   3rd Qu.:3.620e-02   3rd Qu.: -17.82  
 Max.   :22050   Max.   :4.072e+02   Max.   : 180.00  

> plot(sine$i, sine$abs, xlim=c(400,500), ylim=c(0,22000), type="l")
> plot(ra$i, ra$abs, xlim=c(0,2000), ylim=c(0,100), type="l")
\end{commandline}

%\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
