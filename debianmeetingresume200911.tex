%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2009 Junichi Uekawa
%     Copyright (C) 2009 Nobuhiro Iwamatsu
%     Copyright (C) 2009 Kohei Maeda

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200906; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
% date --date 'third saturday'
\newcommand{\debmtgyear}{2009}
\newcommand{\debmtgmonth}{11}
\newcommand{\debmtgdate}{14}
\newcommand{\debmtgnumber}{58}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}

% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\hspace*{-2.4cm}
\includegraphics[width=210mm]{image200801/2008title.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\end{titlepage}

\dancersection{Introduction}{上川 純一}

\begin{multicols}{2}
 
 
 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

 2009年の計画は仮です。

 \begin{enumerate}
  \item 新年の企画 (アンサンブル荻窪開催)
  \item OSC Tokyo
  \item VAIO P インストール記録、
	カーネル読書会　ディストリビューション大集合(小林さん)(東京大学?)
  \item Git Handson (岩松)(あんさんぶる荻窪?)
  \item 家Debianサーバ vs 職場のネットワーク(千代田区都立図書館?\footnote{\url{http://www.library.chiyoda.tokyo.jp/}})
  \item Asterisk (東京大学?)
  \item スペインにて開催
  \item Debconf報告会
  \item OSC Fall?
  \item udev + HAL(岩松さん)
  \item 3D graphics 開発（藤沢さん） 
  \item Debian サーバ+VMware + 各種OS、
	他の仮想化ツール(vserver etc.)、
	忘年会
 \end{enumerate}

 会場候補としては下記があります:

 \begin{itemize}
  \item 大学
  \item 恵比寿SGIホール
  \item Googleオフィス
  \item 公民館(あんさんぶる荻窪等)
  \item 都立会議室(無線LAN)
  \item 健保の施設
 \end{itemize}

\end{multicols}


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule

% set depth to 1 if too many text, 2 if there's less
\setcounter{tocdepth}{1}
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}


\dancersection{事前課題}{上川 純一}

事前課題は:

「あなたが普段行っている統計処理の内容とその処理で行っているハックを披露
してください。」

この課題に対して提出いただいた内容は以下です。

\begin{multicols}{2}
%\input{image200911/prework.tex}
\end{multicols}

% image200911/prework.tex 内部にテキストを追加してください。
%
%

\dancersection{最近のDebian関連のミーティング報告}{前田耕平}
\subsection{東京エリアDebian勉強会56回目報告}
% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

56回は9月16日(水)19:00からといういつもとかなり変則的な時間で、ミラクルリ
ナックスさんのセミナールームをお借りして、Key Sign Party を行いました。
最初に岩松さんによる、なぜヒトはキーサインを求めるのか？というありがたい
お言葉をいただき、キーサインはWeb of Trustと言いつつも、その実はWeb of I
know whoでの信頼レベルなので、パスポートのような強力な公的な身分証明書で
己れの存在証明をする必要があるというはなしも途中ありました。100人もキー
サインする相手がいるとgpgコマンドでちまちまとやってられんよね？という問
題を解決する便利なツールcaffの使い方を伝授してもらいました。

その後、実際に参加したメンバー全員で、立食パーティでのキーサインパーティを
行いました。

参加された方は皆、リア充できたようです。


\subsection{東京エリアDebian勉強会57回目報告}
% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

第57回は、10月30日（金）、31日（土）に日本工学院大学の蒲田キャンパス12号館でOSC
2009Tokyo/Fallでブースのみ出展しました。元々は、31日のみ出展するでしたが、
あけどさんなど有志の方により、30日 (金) もブースをやっていたとのことです。

配布物としてはフライヤー50部、9月の勉強会で使用した GPG サインの資料20部、
Live DVD 20枚あまりを用意しました。また、展示物として岩松さんが sh7724
搭載マシンを用意してくれ、またそのマシンの詳細を印刷したパンフレットも用
意してくれました。
配布物の配布結果はほぼ予想通りで、そこそこ足りていました。
Live DVD のイメージが当日早朝にできたこともあり、ブースで少し焼きました
が、全部で25枚程度でした。

Live USB イメージ (lenny で lxde) も用意しましたが、案内が直前だったこと
もあるのか、あまり知られておらず、イメージを欲しがる人はそれほどいません
でした。ただし、30日 (金) にいらした方で、あけどさんに USB メモリを渡し
たまま帰ってしまった人がいたらしく、あけどさんが ML で連絡を求めています。
\footnote{\url{http://lists.debian.or.jp/debian-users/200911/msg00001.html} \\
\url{http://lists.debian.or.jp/debian-devel/200911/msg00000.html}}

また、岩松さん提案の GPG 鍵交換ですが、なかなか好評で、ブースおよび懇親
会で行ないました。

また、学生との交流もできたので、Debconf in Japanや出張Debian勉強会・
Debian温泉の企画にも進展がありそうです。

懇親会は JR 蒲田駅東口近くの「春香園」という餃子屋さんで行ないました。
懇親会の参加者は、武藤さん、上川さん夫妻、日比野さん、本庄さん、谷口さん、
岩松さん、藤澤さん、山本さん、前田の10名でした。

%============================================================
%%% trivia quiz
\dancersection{Debian Trivia Quiz}{上川 純一}

ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
いところもあるかも知れません。みんなで一緒に読んでみましょう。

今回の出題範囲は\url{debian-devel-announce@lists.deban.org} に投稿された
内容とDebian Project Newsからです。

\begin{multicols}{2}
 \input{image200911/quiz.tex}
\end{multicols}

\clearpage

% ===============================================================
\dancersection{Debianでの数学ことはじめ。}{まえだこうへい}
\index{GNU R}
\index{Octave}
\index{Gnuplot}
% ===============================================================

\subsection{はじめに}

Debianで数値計算や統計処理、グラフ作成を行うには、様々なパッケージがあり
ます。私のように大学が理系といっても基礎生物学専攻だった人間には、コン
ピュータでの専用ツールでなくても、極端な話、基本的な統計学と関数電卓があ
れば事足りました。電卓代わりにExcel\textregistered{}やOOoのcalcのようなス
プレッドシートを使う、というやり方でやっていました。社会人になってからも
スプレッドシートで大抵は事足りる、という方が一般的には多いのではないかと
思います。

とはいえ、結構なサンプル数の計算をしたり、グラフを描写する場合、スプレッ
ドシートでは非力だということを実感しています。。プリセールスや企画で裏付
け資料を作るのにサンプルデータを統計処理して、グラフを描くと、スプレッド
シートだとマウスの操作だけで簡単にできる一方、CPUやメモリ不足でレスポン
スが遅くなったり、ソフトウェア自体が落ちたり、酷いとOS自体のレスポンスが
悪化するというのが最近の仕事上での悩みだったりします。

そんなことがきっかけで最近、Gnuplotを使い始めたわけですが、統計処理では
最近はGNU Rの書籍を書店で見かけたり、数値計算ではOctaveというのがあると
いうことをDebian勉強会のMLで知ったり\footnote{GNU RやOctaveのパッケージ
メンテナであるDirk Eddelbuettel さんが近々来日されるというのがMLで流れて
いたそもそものきっかけです。\url{http://dirk.eddelbuettel.com/}}と、自分
の中だけでなく、最近意外とまわりでもこの辺はホットな話題ではないかと思い
ます。そこで、今回はOctave, GNU Rを中心に、Gnuplotとの連携方法を交えなが
ら、Debianでの使い方、パッケージングなどについて説明しようと思います。

\subsection{インストール方法}

\subsubsection{Octaveのインストール方法}
OctaveはSqueeze/Sidでは、バージョン3.0と3.2で別のパッケージになっていま
す。今回は3.2のパッケージを導入してみます。

FIXME 3.0と3.2の違いを簡単に記載すること。

\begin{commandline}
$ sudo apt-get install octave3.2
\end{commandline}

\subsubsection{GNU Rのインストール方法}

GNU Rは、Debianパッケージでの名前は、gnurでも、rでもgnu-rでもありません。
r-baseという名前になっているので、その点注意が必要です。

\begin{commandline}
$ sudo apt-get install r-base
\end{commandline}

\subsubsection{Gnuplotのインストール}

GnuplotはOctave、GNU Rのいずれも依存関係はありませんが、インストールして
おくと便利でしょう。

\begin{commandline}
$ sudo apt-get install gnuplot
\end{commandline}

\subsection{試してみる。}

\subsubsection{Octaveの場合}

\subsubsection{GNU Rの場合}

\subsubsection{Gnuplotとの連携}


\subsection{debパッケージ化する。}

Debian ではOctaveもGNU Rも関連パッケージがかなりあります。

\begin{commandline}
$ apt-cache search "GNU R" | wc -l
213
$ apt-cache search octave | wc -l
133
\end{commandline}

それぞれ、debパッケージにする場合の方針、考慮点を見てみましょう。

\subsubsection{Octaveの場合}


\subsubsection{GNU Rの場合}

GNU Rでは

\subsection{実際に使ってみる。}

\subsubsection{データを用意する。}

\subsubsection{計算してみる。}

\subsubsection{プロットしてみる。}

\subsubsection{応用してみる。}

\subsection{まとめ。}

\clearpage


\dancersection{Debian autobuilder ネットワーク}{岩松}

Debianは現時点で11個のCPUアーキテクチャと2つのカーネルをサポートしていま
す(i386, amd64, ppc, mips, mipsel, armel, alpha, ia64, s390, hppa,
sparc, kfreebsd-amd64, kfreebsd-i386)。

パッケージが数万個あり、パッケージメンテナが Debianのサーバにアップロー
ドすると、いつのまにかユーザが知らないうちに各アーキテクチャ向けにDebianパッケージがビルドされ、
利用できるようになっています。これはどのような仕組みで動いているのでしょ
うか。
もちろん、パッケージメンテナはすべてのアーキテクチャを持っているわけでは
ないので（持っている人もいるみたいですが。）、パッケージメンテナが各アー
キテクチャ毎にビルドして、アップロードしてわけではありません。
Debianでは {\bf Autobuilder ネットワーク} と呼ばれる 各アーキテクチャ向
けにパッケージが自動的にビルドされるシステムが行っています。
Debian Project では重要なシステムの一つなのですが、表に出てくる事も少な
いためどのような動きになっているのか知る人は少ないです。
今回、Renesas SuperH(SH4)を移植するにあたりこれらの情報を入手したの
でまとめてみました。また、新しくアーキテクチャを追加する時の方法と、ビル
ドテクニックについても説明します。

\subsection{Autobuilder ネットワークのコンポーネント}

Autobuilder ネットワーク は一つのソフトウェアで動いているわけではなく、
いくつかのソフトウェアと porter
と呼ばれる buildd のメンテナ、wanna-buildのメンテナで構成されています。
Autobuilder ネットワークの動きを説明する前に、各コンポーネントがど
のような動きをするのか説明します。

\subsubsection{dak}
Debian Archive Kit。
パッケージメンテナ/Builddによってアップロードされたパッケージをチェック、
管理するためのツールやデーモンが提供されています。

\subsubsection{quinn-diff}
パッケージメンテナによって新しくアップロードされたソフトウェアのアーキ
テクチャ依存のパッケージ (Archi-
tecture: any) とアーキテクチャ非依存のパッケージ (Architecture: all) を
チェックし、前者を wanna-build のデー
タベースに登録するツールです。これはソースパッケージだけでなく、バイナ
リパッケージもチェックします。
Autobuilder ネットワークの過程では アーキテクチャ非依存のパッケージはビ
ルドされません。

パッケージ情報: \url{http://packages.qa.debian.org/q/quinn-diff.html}

\subsubsection{wanna-build}
buildd とデータのやりとりをするためのインターフェイスです。各アーキテク
チャ毎にパッケージのデータベースを持ちます。
buildd は wanna-build のデータベースを持つサーバに ssh でログインし、
wanna-build コマンドを使ってデータベースをコントロールします。

パッケージ情報: \url{http://packages.debian.org/sid/wanna-build}

\subsubsection{buildd}
wanna-build と データをやりとりするデーモンやパッケージをアップロードす
るツール一式を指します。ツールには以下のものがあります。

パッケージ情報: \url{http://packages.debian.org/sid/buildd}

\begin{itemize}
\item buildd\\
  buildd デーモン。wanna-buildd のデータベースを定期的にチェックし、
  ビルドが必要なパッケージをパッケー
  ジビルドキューとして管理します。そして、sbuild へのビルド指示を行いま
  す。

\item buildd-mail\\
  メールキューディレクトリにあるデータを処理するプログラム。ビルドに成功
  したパッケージ (*.deb, *.udeb)
  とパッケージ情報 (*.dsc, *.changes, etc) をアップロードキューディレク
  トリに移動させます。

\item buildd-mail-wrapper\\
  buildd-mail-wrapper は porter から送られたメールをメールキューディレク
  トリに格納し、buildd-mail を呼
  び出すプログラムです。入力データとして、メールデータそのものを要求する
  ので、procmail など合わせて利
  用します。

\item buildd-update-chroots\\
  パッケージのビルドを行う chroot 環境をアップデートおよびクリーンアップ
  するプログラムです。buildd が
  動作している場合には buildd を停止し、chroot をアップーデートします。
  アップデート完了後、再度 buildd
  を起動させます。クリーンアップには debfoster と呼ばれるゴミパッケージ
  を消すプログラムが利用されてい
  ます。

\item buildd-uploader\\
  アップロードキューディレクトリにあるパッケージをアップロードするプログ
  ラムです。dupload を使い、
  GPG サインされている *.changes ファイルをパーサし、パッケージをアップ
  ロードします。cron 等で定期的
  に呼び出して利用します。

\item buildd-watcher\\
  buildd の動きをチェックするプログラムです。cron 等で定期的に呼び出し
  て利用します。

\end{itemize}

正式なbuilddではhttps://buildd.debian.org/apt/pool/からダウン
ロードしたパッケージを使う必要があります。互換性維持のため、手を加えた
sbuildを使う必要あるためです。

\subsubsection{sbuild}
実際にパッケージをビルドするプログラムです。buildd から呼ばれます。パッ
ケージのソースコードを取得し、ビルド結果を porterとwanna-build に送信するまでの処理を
行います。pbuilder と機能がかぶりますが、sbuild はアーキテクチャ依
存部分のビルドに特化したパッケージビルドシステムになっています。schroot
を利用することにより、lvm などディスク管理機能にも対応もされています。

パッケージ情報: \url{http://packages.debian.org/sid/sbuild}

正式なbuilddでは\url{https://buildd.debian.org/apt/pool/}からダウン
ロードしたパッケージを使う必要があります。互換性維持のため、手を加えた
sbuildを使う必要あるためです。

\subsubsection{schroot}

sbuild から呼ばれる chroot 代替プログラムです。chroot の高機能版です。

パッケージ情報: \url{http://packages.debian.org/sid/schroot}

\subsubsection{porter}

buildd をメンテナンスする人です。ビルド結果をメールとして受信し、その結
果を buildd に対して返信します。
ビルドに成功したパッケージのメールには GPG でサインして返信します。
返信する際には、送られてきたメールから、*.changelog の部分を抜き出して、
その抜き出した部分にサインを行います。抜きだしの部分にはスクリプトを使っ
て処理するのですが、現在のところ mutt のスクリプトしかないので、ほとんど
の porter は Mutt ユーザです。
\\
GPGによるサインを自動化すればよいのですが、セキュリティの観点から porter
がサインをする仕組みを取っています。
\\
ビルドに失敗した場合のメールの書式も決まっています。以下に書式を示します。
\begin{itemize}
\item ビルドに失敗した場合
\begin{commandline}
failed
理由(BTSの番号など)
\end{commandline}

\item パッケージの依存関係の問題
\begin{commandline}
dep-wait 依存するパッケージの名前とバージョン
\end{commandline}

\item 再ビルド申請
\begin{commandline}
give-back
\end{commandline}

\item パッケージがアーキテクチャ依存の場合
\begin{commandline}
not-for-us
\end{commandline}
\footnote{アーキテクチャリストに入っていないだけの場合は、failedを指定します。}
\end{itemize}

\subsubsection{wanna-build メンテナ}
メールサーバ障害や、builddの障害でうまくパッケージがビルドできない事があ
ります。この場合にはwanna-buildのデータベースにアクセスし、パッケージの
ステータスを元に戻す作業が必要になる場合があります。
この場合、porterが wanna-buildのデータベースにアクセスして変更するわけで
はなく、wanna-build メンテナが依頼を受けて、変更処理を行います。

\subsection{Autobuilder ネットワークの動き}
さて、Autobuilder ネットワークのコンポーネントの説明をしたので、次に
各コンポーネントの連携について説明します。
先で説明した各コンポーネントの連携図を図\ref{fig:buildd-comp}に示します。

\begin{figure}[htbp]
 \begin{center}
\includegraphics[scale=0.7]{image200911/buildd-image00.png}
 \end{center}
 \caption{コンポーネント連系図}
 \label{fig:buildd-comp}
\end{figure}

\subsection{パッケージの状態遷移}
パッケージは常になにかしらの状態をステータスを持っています。ステータス
は wanna-build で管理する DB で保持されています。
ステータスは以下のものがあり、図\ref{fig:pkg-state}のように変化します。

\begin{itemize}

\item BD-Uninstallable\\
パッケージのビルドに足りないパッケージがある状態。

\item Needs-Build \\
パッケージがビルド可能な状態。
パッケージビルド依存関係が解消されてたり、ビルドの状態から戻された
(given-back) 場合にこの状態になります。

\item Building \\
Builddによってパッケージがビルドされている状態。

\item Uploaded\\
PorterによってパッケージにGPGサインされ、アーカイブにアップロードされた状態。

\item Installed\\
アーカイブにインストールされた状態。

\item Dep-Wait\\
パッケージのビルド依存関係待ちの状態。

\item Failed\\
パッケージがビルドに失敗した状態。

\item Not-For-Us\\
対象のアーキテクチャではビルドできないパッケージの状態。
porterがwanna-build経由でデータベースに登録します。
現在、wanna-build のデータベースとは別にアーキテクチャ依存のリスト
      \footnote{http://buildd.debian.org/git/packages-arch-specific.git}を
作成中です。
\item Failed-Removed\\
Failed 状態のパッケージが一時的に削除されているという状態。

\end{itemize}

\begin{figure}[htbp]
 \begin{center}
   \includegraphics[scale=0.7]{image200911/buildd-status.png}
 \end{center}
 \caption{パッケージステータスの状態遷移}
 \label{fig:pkg-state}
\end{figure}

\subsection{ビルドの優先順位}
パッケージのビルドは基本的に Need-Build のステータスになった順かつパッケー
ジ名ASCII 順でビルドされますが、
それとは別にソースパッケージのプライオリティとソースパッケージのセクション毎に優先順
位が設定されています。現在では、以下の優先順位になっています。

\begin{table}[htbp]
\begin{center}
\begin{tabular}{ccc}

\begin{minipage}{0.3\hsize}
\begin{center}
\begin{tabular}{|c|c|}
\hline
Source Priority & 値 \\ \hline
required & -5 \\ \hline
important & -4 \\ \hline
standard & -3 \\ \hline
optional & -2 \\ \hline
extra & 1 \\ \hline
unknown & -1 \\ \hline
\hline
\end{tabular}
\caption{ソースパッケージプライオリティ毎の優先順位}
\label{tbl:srcpkg-prio}
\end{center}
\end{minipage}

\begin{minipage}{0.3\hsize}
\begin{center}
\begin{tabular}{|c|c|}
\hline
 libs & -200 \\ \hline
 debian-installer & -199 \\ \hline
 base & -198 \\ \hline
 devel & -197 \\ \hline
 shells & -196 \\ \hline
 perl & -195 \\ \hline
 python & -194 \\ \hline
 graphics & -193 \\ \hline
 admin & -192 \\ \hline
 utils & -191 \\ \hline
 x11 & -190 \\ \hline
 editors & -189 \\ \hline
 net & -188 \\ \hline
 mail & -187 \\ \hline
 news & -186 \\ \hline
 tex & -185 \\ \hline
 text & -184 \\ \hline
\hline
\end{tabular}
\caption{ソースパッケージセクション毎の優先順位:その1}
\label{tbl:srcpkg-sec1}
\end{center}
\end{minipage}

\begin{minipage}{0.3\hsize}
\begin{center}
\begin{tabular}{|c|c|}
\hline
 web & -183  \\ \hline
 doc & -182 \\ \hline
 interpreters & -181 \\ \hline
 gnome & -180 \\ \hline
 kde & -179 \\ \hline
 games & -178 \\ \hline
 misc & -177 \\ \hline
 otherosfs & -176 \\ \hline
 oldlibs & -175 \\ \hline
 libdevel & -174 \\ \hline
 sound & -173 \\ \hline
 math & -172 \\ \hline
 science & -171 \\ \hline
 comm & -170 \\ \hline
 electronics & -169 \\ \hline
 hamradio & -168 \\ \hline
 embedded & -166 \\ \hline
 unknown & -165 \\ \hline
\hline
\end{tabular}
\caption{ソースパッケージセクション毎の優先順位:その2}
\label{tbl:srcpkg-sec2}
\end{center}
\end{minipage}

\end{tabular}
\end{center}
\end{table}

\subsection{新しいアーキテクチャをサポートする}

昔は、ポーティングしたい人が quinn-diff から buildd(buildd-node) まで全
て構築する必要がありました。この最大のネックは wanna-build
データベースで、これは最新のものを使う必要があっ
たのですが、データベースにアクセスするにはサーバーのアカウントが必要だっ
たため、
構築が困難でした\footnote{構築は可能だが、タイムラグが発生する。その理由
としてbuilddが参照するリポジトリは最新のリポジトリ情報が反映されるbuildd
専用のため}。しかし、今は新しいアーキテクチャを追加するためのサポー
ト用サービス debian-ports.org が用意されています。このサービスでは、ポー
ティングしたいアーキテクチャ用の
wanna-build 用アカウント と DB, quinn-diff のサービスを提供できるように
なっています。これにより、移植したい人は buildd-node のみを用意し、debian-ports の管理者に登録申請をするだ
けで新しいアーキテクチャをサポートできるようになりました。
現在、\ref{tbl:support-arch}のアーキテクチャが debian-ports.org を使ってポーティ
ングを進めています。

\begin{table}
\begin{center}
\begin{tabular}{|c|c|}
\hline
アーキテクチャ名 & 進捗 \\ \hline
avr32 & 65.52\% \\ \hline
hurd-i386 & 64.46\% \\ \hline
m68k & 53.00\% \\ \hline
sh4 & 85.43\% \\ \hline
\hline
\end{tabular}
\caption{debian-ports.orgでサポート中のアーキテクチャ}
\label{tbl:support-arch}
\end{center}
\end{table}

\subsection{loop-depends の対応方法}

いくつかのパッケージには loop-depends になっているものがあります。
loop-depends とは、ビルド依存がループしているパッケージの状態を言います。
例えば、libpang-perl パッケージは libgtk2-perlパッケージにビルド依存して
います。しかし、libgtk2-perl は libpang-perlパッケージに依存しています。

\begin{figure}[htbp]
\begin{commandline}
Source: libpango-perl
Section: perl
Priority: optional
Build-Depends: debhelper (>= 7.0.50), libcairo-perl (>= 1.000),
  libextutils-depends-perl (>= 0.300), libextutils-pkgconfig-perl,
  libglib-perl (>= 1:1.220), perl, xvfb, libpango1.0-dev,
  xauth, xfonts-base, quilt, libgtk2-perl (>= 1:1.220)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^
\end{commandline}
 \caption{libpango-perlのビルド依存}
 \label{fig:buil-dep-libpango-perl}
\end{figure}

\begin{figure}[htbp]
\begin{commandline}
Source: libgtk2-perl
Section: perl
Priority: optional
Build-Depends: debhelper (>= 7.0.50), quilt (>= 0.46-7), perl,
 libextutils-depends-perl (>= 0.300), libextutils-pkgconfig-perl (>=
 1.03), libgtk2.0-dev (>= 2.6.0), libglib-perl (>= 1:1.220),
 libcairo-perl (>= 1.00), xvfb, xauth, xfonts-base, hicolor-icon-theme,
 libpango-perl (>= 1.220), shared-mime-info
 ^^^^^^^^^^^^^^^^^^^^^^^^^
\end{commandline}
 \caption{libgtk2-perlのビルド依存}
 \label{fig:buil-dep-libgtk2-perl}
\end{figure}

\begin{figure}[htbp]
 \begin{center}
   \includegraphics[scale=0.7]{image200911/loop-dep.png}
 \end{center}
 \caption{ループビルド依存関係}
 \label{fig:loop-dep}
\end{figure}

これではいつになってもビルドできません。これはバグとして扱われるのでは？
と思いますが、libpang-perlをビルドする段階で libgtk2-perlを使ったテス
トを行うため、libgtk2-perlが必要なのです。Debianではソフトウェアのビルド
に実行されるテストは行うことが推奨されているので、このようにビルド依存関係がループしています。
では、どのようにしてビルドすればよいのでしょうか。実は、porterが手を加えてビルドする必要があります。
しかし、手を加えた場合は正式なパッケージとして扱われません。
このようなパッケージに遭遇した場合には、unreleased ディストリビューションにパッケージをアップロードし、
そのパッケージを使って再度ビルドを行うという方法が推奨されています。

以下に例として libpang-perl をビルドする場合の手順を説明します。
\begin{enumerate}

\item builddが動作していない別マシンでの作業
\begin{enumerate}
 \item libpango-perl のソースパッケージをダウンロードします。
 \item debian/control ファイルの Build-depends から libgtk2-perl を削除
       します。
 \item debian/changelog をアップデートします。\\
Debian versionは既存のバージョンに+arch-name などをつける必要があります。
       （実際のDebian packageと区別するため。）
ディストリビューション名は unreleased に変更します。
debian/changelog の変更者も変更する必要があります。
\item debuild -m''Your name $<$your-name@example.org$>$'' などとしてパッケー
      ジをビルドします。 \\
libpango-perlはlibgtk2-perlが見つからない場合には、テストを無視します。:-)
\item ビルドに成功したら、dupload を使ってパッケージアップロードします。
\item dak で処理されれば、unreleased ディストリビューションから libpango-perl が利用できるよ
      うになります。
\end{enumerate}
\item schroot内での作業
\begin{enumerate}
\item schroot環境のapt-lineに unreleased を追加します。
\item schroot内で apt-get update を実行します。
\end{enumerate}
\item libgtk2-perl がビルドできるようになります。
\item libgtk2-perl ができたら、unreleased ディストリビューションから
      libpango-perl を消してもらいます。
\item libpango-perl が 本来のDebian Versionのものでビルドされます。
\end{enumerate}

毎回この方法がうまくいくとは限りません。
例えば、依存するパッケージや提供されるパッケージの機能によっては configure のオ
プションを変更する場合もあります。このあたりはパッケージメンテナか、
debian-wb@l.d.o に直接聞いたほうがよいです。聞かないとわからないというの
は問題なので、README.Debianあたりに書いてもらうように計画中です。

\subsection{まとめ}
auto-builder ネットワークはDebian公式開発者でさえあまり触ることのないシ
ステムです。ブラックボックスなところが以前からあったと思うのですが、
今回の説明で少しはわかる部分が増えたかなと思います。
個人的にはauto と謳っておきながら実は人が介入していたりするのはけっこう
意外でした。auto-builder ネットワークの奥深くに入り込みたい人はぜひ
Debian/SH4のポーティングに参加していただければと思います。

%\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule


\end{document}
