%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2011 Nobuhiro Iwamatsu

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201205; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2012}
\newcommand{\debmtgmonth}{8}
\newcommand{\debmtgdate}{18}
% (+ (* (- 2012 2005) 12) 8 -1) started from zero
\newcommand{\debmtgnumber}{91}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics[width=210mm]{image201003/debsen.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
% 全角文字にしないとフォントのサイズが合わないので注意
% TODO(uekawa): なんでそうなるのか確認
\rotatebox{10}{\fontsize{32}{32} {\gt 特集: Ｄｅｂｃｏｎｆ　Ｒｅｐｏｒｔ}}\\
\rotatebox{10}{\fontsize{32}{32} {\gt 特集: 月刊Ｄｅｂｈｅｌｐｅｒ}}\\

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

% Title should be in Japanese text so that we can use it as lint for PDF shiori.
\dancersection{はじめに}{上川 純一}

\begin{multicols}{2}
 

 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:
\begin{enumerate}
 \item Debian 19 周年にちなんで思うことを教えてください。
\end{enumerate}
この課題に対して提出いただいた内容は以下です。
\begin{multicols}{2}
{\small
% \input{image201205/prework.tex}
}
\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川 純一}
\subsection{東京エリアDebian勉強会90回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

東京エリアDebian勉強会。
先週の土曜日は第90回東京エリアDebian勉強会でした。
ニカラグア開催のDebconfが先週あり、先月は大統一Debian勉強会で京都大学にみんな集まった、ということで若干息切れ気味の開催でした。

事前課題はDebconfのビデオをみての感想でした。個人的にはARMの64ビット関連の話題が気になるところ。
MacBookAirにインストールする話題を上川がしました。rEFItとかgptsyncとか知らない人は知らない話題がたくさん。


%-------------------------------------------------------------------------------
\dancersection{Debian Trivia Quiz}{上川 純一}
%-------------------------------------------------------------------------------

ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
いところもあるかも知れません。みんなで一緒に読んでみましょう。

今回の出題範囲は\url{debian-devel-announce@lists.deban.org} や \url{debian-devel@lists.deban.org}に投稿された
内容とDebian Project Newsからです。

\begin{multicols}{2}
% \input{image201205/quiz.tex}
\end{multicols}

%-------------------------------------------------------------------------------
\dancersection{Debconf report}{iwamatsu}
%-------------------------------------------------------------------------------

%-------------------------------------------------------------------------------
\dancersection{月刊Debhelper}{野島 貴英}
%-------------------------------------------------------------------------------
\index{debhelper}
\subsection{今回のコマンド}

　debhelperのマニュアルを翻訳した際、いつか解析しようと思っていた以下のコマンド
２つを今回は取り上げます。

\begin{itemize}
\item dh\_makeshlibs
\item dh\_shlibdeps
\end{itemize}

\subsection{読者対象}

 共有ライブラリと、共有ライブラリのパッケージ作成に関する予備知識はある程度
ある人向けの内容となります。

参考文献：\\
\begin{enumerate}
\item ローダー\&リンカー,オーム社
\item Binary Hacks,O'Reilly
\item Debian Library Packaging guide,上川さん
\end{enumerate}

\subsection{呼び出し方}

　以下の順番で呼び出して利用します。

\begin{enumerate}
\item　dh\_makeshlibs 
\item  dh\_shlibdeps
\end{enumerate}

\subsection{\$\{shlibs:Depends\}、\$\{shlibs:Recommends\}マクロ}

 今回のdebhelperコマンドはこれらマクロに関わる処理を行います。

 共有ライブラリの依存関係を人手でメンテナンスしつづけるのは大変面倒な
作業になり、また、多くのケースでは機械的に依存関係を求める事も可能なので、
パッケージ作成時に機械的に共有ライブラリの依存関係を生成出来る仕組みがあります。
こちらのマクロはこの機能を利用する為のものとなります。

 これらマクロをcontrolファイルのDepends行に入れておくと、
debhelperを使ってパッケージを作成した場合、自動で算出した共有ライブラリとの
依存関係の情報で置き換えてくれます。

\begin{commandline}
% cat  debian/control
% cat  debian/package/DEBIAN/control
\end{commandline}

  試しに手元のバイナリについてどんな形で置き換えられるかは、
展開済みのソースパッケージがあれば、''dpkg-shlibdeps -O''で検証できます。

\begin{commandline}
% apt-get source fileutils
% cd fileutils-X-X-X
% dpkg-shlibdeps -O /bin/ls
\end{commandline}

\subsection{shlibsファイルと、symbolファイル}
　　
dh\_makeshlibsコマンドと、dh\_shlibdepsコマンドで重要な役割を持つ
ファイル２つについて説明します。

\subsubsection{shlibsファイル}

\begin{commandline}
ファイル形式例
\end{commandline}

 SONAMEと共有ライブラリ本体のバージョンのみの情報を記載し、
必要な共有ライブラリへの依存関係を算出するやり方で利用されるファイルです。
このやり方は最も単純で、最も保守的に共有ライブラリへの依存関係を
算出できるという特徴があります。

 本ファイルを使った依存関係算出の方法は最も基本的な方法ですので、
BUG\#634192、\#571776でdebian-policyへ掲載すべきとの要望があり、
対応がなされた模様です。こちらについては、　　　　　

\begin{commandline}
% git clone 'http://anonscm.debian.org/git/dbnpolicy/policy.git'
\end{commandline}

すればshlibsファイルに関する記載が大幅追記されたdebian policyが読めます。

\subsection{symbolファイル}

\begin{commandline}
ファイル形式例
\end{commandline}

 共有ライブラリの依存関係を洗い出す際、SONAMEが変わらない限りは、
バイナリが必要としているシンボルを過不足無く搭載しているライブラリと
バージョンのみを依存関係として含めると都合が良い事が多いです。例えば、

\begin{itemize}
\item バージョンの上がったライブラリの元でビルドして依存関係を求めたが、
実は古いバージョンのライブラリでも全く問題なく動的リンク出来る場合は
古いバージョンのライブラリも含んで依存対象としたい。
\item 依存しているライブラリAがライブラリBを必要としているが、
バイナリからはライブラリBのシンボルを一切利用していないので、
バイナリ本体の依存関係としてライブラリBを外したい
\end{itemize}

(図参照)\\

という事があります。こちらが出来ると、例えばsidからtesting
へバイナリを移動させるときに、依存関係にある数多くのライブラリ全部も同時に
sidからtestingへ完全に移動できるようになるまで、バイナリ本体をtestingの
ものとして移動出来ないという問題を極力避ける事ができます。

 共有ライブラリの提供している全シンボルと、各シンボルについて
搭載されたバージョンを記載したファイルを用意すれば、本件は対応出来る
ようになります。これがsymbolファイルとなります。
　　　　
\subsection{substvarファイル}

　\$\{shlibs:Depends\}、\$\{shlibs:Recommends\}マクロを置き換える際に
使われる中間ファイルとなります。各debhelperコマンドがsubstvarファイルに
置き換えるべき内容を追記を繰り返すことにより生成しておき、
最後にdh\_gencontrolがマクロ部分を適宜置き換えたcontrolファイルを別に生成します。

\subsection{内部で主に利用されているdpkgパッケージに含まれるコマンド}

　今回のdebhelperコマンドは内部でdpkgパッケージに含まれるいくつかのコマンド
を利用して処理を行っています。

　図参照\\

\subsubsection{dpkg-gensymbols}

 dh\_makeshlibs内部にて、ライブラリメンテナがソースに含めているsymbolファイルを
元にし、実際に構築したライブラリから得られるシンボルの差分を含めたsymbolファイル
を生成するのに使われます。この生成されたsymbolファイルはライブラリ
パッケージのcontrolファイル群として含められます。

 なお、dh\_makeshlibsでdpkg-gensymbolsを呼び出す時、'-c 4'が指定されて
呼び出されます。

\subsubsection{dpkg-shlibdeps}

 dh\_shlibdepsはほとんどdpkg-shlibdepsのラッパーコマンドとも
言えるぐらい、共有ライブラリの依存関係算出にあたって、
dpkg-shlibdepsをそのまま利用しています。

 dpkg-shlibdepsの動作は
\begin{enumerate}
\item コマンドラインから与えられたバイナリファイルが必要とする共有ライブラリへの
動的リンクに必要な情報を
\begin{commandline}
objdump -w -f -p -T -R　バイナリファイル
\end{commandline}
コマンドを使って探り、
\item. 1.で得られた情報のうち、NEEDEDに記載されているSONAMEと同じファイル名を持つ
ライブラリファイルを/lib,/usr/lib以下から探し当て、
\item 発見したライブラリファイルのフルパスを元にdpkg -Sを利用してライブラリの
パッケージ名を割り出し、
\item ``dpkg-query --control-path　ライブラリパッケージ名''を使って
/var/lib/dpkg/info/以下にあるライブラリパッケージの提供するshlibsファイル/
symbolファイルを取得し、
\item 1.で得たバイナリファイルの動的リンクに必要なシンボル名と、4.で得た
shlibsファイル/symbolファイルを検証することによりバイナリファイルにとって
最適な依存関係を算出し、
\item substvarファイルに算出した依存情報を記載する
\end{enumerate}

という動作を行います。

 参考までに、こちらの動作をどのように行っているかを観察するには、
\begin{commandline}
　  dpkg-shlibdeps -v -v -v -O バイナリファイル
\end{commandline}
をバイナリファイルに対応するソースパッケージ展開後のディレクトリで、
実行するとよく判ります。

  ...以下鋭意記載中(図も)...

%-------------------------------------------------------------------------------
\dancersection{ソフト開発以外の簡単Debian contribution}{野島 貴英}
%-------------------------------------------------------------------------------
\index{easycontrib}
\subsection{はじめに}

 debconf11に前回参加した時、debconfの最後に行われるライトニング
トークで、「ソフト開発以外にDebianへ貢献するにはこんなのが
あるよ！」という発表がありました。この発表を聞いて以降、このあたりを
一度まとめてみたいなーと思っていました。

 ここでは、Debianをインストールしてちょっと慣れたぐらいの人がちょこちょこっと
Debianへ貢献する手段についてまとめてみます。

　きっと漏れもあるので、東京エリアDebian勉強会にて補完してみます。

\subsection{一覧}

\begin{itemize}
\item DDTSSの日本語訳をレビューしてみる、日本語に訳してみる
\item bugs.debian.orgへBUG報告してみる。
\item screenshots.debian.orgへスクリーンショットを投稿しまくってみる。
\item art.debian.netへ絵を送ってみる。
\item \url{debian-doc@d.o.j}にてレビューをしてみる、日本語に訳してみる
\item \url{debian-users@d.o.j}にて質問に回答をしてみる。
\end{itemize}

\subsection{screenshots.debian.org}

\subsection{arts.debian.net}

\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
