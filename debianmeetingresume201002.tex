%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2010 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201002; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
\usepackage{wrapfig}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2010}
\newcommand{\debmtgmonth}{2}
\newcommand{\debmtgdate}{20,21}
\newcommand{\debmtgnumber}{61}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}

% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\hspace*{-2.4cm}
\includegraphics[width=210mm]{image200801/2008title.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\end{titlepage}


\dancersection{Introduction}{上川 純一}

\begin{multicols}{2}
 
 
 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:

\begin{enumerate}
 \item 事前課題の内容
\end{enumerate}

この課題に対して提出いただいた内容は以下です。

\input{image201002/prework.tex}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}
\subsection{東京エリアDebian勉強会60回目報告}
% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

前回の BSP の開催報告

% =======================================================================
\dancersection{Debian の紹介}{やまねひでき}
\index{why debian}
% =======================================================================

\subsection{Debian とは何か}
「Debian とは一体何ですか? (\url{http://www.debian.org/intro/about})」
には以下のように書かれています。

\begin{description}
\item \small Debian Project は、フリーなオペレーティングシステムを作成するために連携した
個人の集団です。 我々が作成したこのオペレーティングシステムは Debian GNU/Linux 
もしくはもっと短かく簡単に Debian と呼ばれています。
\end{description}



\subsection{Debian の特徴}
今だと Windows/MacOSX 以外の「いわゆるフリーなOS」はいくつかあります。
では、他の OS / ディストリビューションと Debian の違い、その特徴を語る
キーワードとは何でしょうか？私は「Universal OS」「フリー」「ボランティア」
の三つを挙げます。順を追って説明します。


\subsubsection{Universal OS}
これが Debian が目指すものです。その意味するところは
「あらゆるマシンで動くフリーなソフトウェアによる誰もが使えるOS」です。
単に PC で動くだけではなく、最近は廃れてきましたが UNIX ワークステーションや
汎用機、組み込み用機器、モバイル端末、ゲーム機…あらゆるマシンで動作すること
を目指しています。そのため多数の CPU アーキテクチャをサポートしているのが
特徴です。サポートする／した／しようとしているアーキテクチャは以下があります。

\begin{itemize}
 \item i386	（通常の PC）
 \item amd64	（最近の 64bit CPU）
 \item ia64	（流行らない Intel の64bit CPU。Itanium など）
 \item mips/mipsel
 \item arm/armel（シャープの Netwalker やモバイル端末がこれ）
 \item alpha
 \item hppa	（HP のワークステーション）
 \item sparc	（Sun）
 \item powerpc
 \item m68k	（昔の Macintosh や Amiga など）
 \item s390 	（汎用機です）
 \item sh	（日立の）
 \item avr32
\end{itemize}

また、その動作の各となるカーネルも Linux だけではなく他のカーネルに取り替えても
動作することを目指しています。この移植版としては

\begin{itemize}
 \item Hurd	（永遠の開発版？）
 \item kfreeBSD (i386, amd64)\footnote{NetBSD, OpenBSD は途中で作業する人の気力が尽きているようです。}
\end{itemize}

があります。\footnote{残念ながら Plan9 はありませんが、その上で動くツール類は移植されています。}

単に動作する機器／カーネルが多いだけではなく、その上のユーザランドのソフトも豊富で、
パッケージ化されており導入が容易になっています。現在リリースされている Debian 5.0 
コードネーム「Lenny」ではその数は25,000パッケージを越え、その数はさらに増えつづけています。
Linux で使えるソフトウェアを探す場合、大抵は既に Debian のパッケージとして提供されているので
気軽に試すことができるでしょう。

それから Debian で利用可能な言語は多種に渡ります。それは自然言語（英語、日本語など）
でもあり、計算機言語という意味でもあります\footnote{計算機言語の話は後で別の方が
滔々としてくれるでしょう :-)}。巷ではマイナーと呼ばれるような言語であっても
「Universal OS」を目指す Debian は積極的に取り込んでいます。例えば、ブータン公用語
「ゾンカ語」をサポートする DzongkhaLinux は Debian をベースに開発され、その成果は 
Debian に取り込まれています\footnote{これは商用OSでは「採算にあわない」ので
サポートが遅れがちになる少数言語／民族にとっての希望の現れと言えるでしょう}。


\subsubsection{フリー}
Debian の考える「フリー」は単に無料に止まらず、Debian フリーソフトウェアガイドライン
 (DFSG) という形でまとまっており、これが元になって「オープンソース」が生まれました。
この点が担保される、この考えを皆が共有することでさらに豊かなソフトウェア／コンテンツ／社会が
生まれています。このフリーというのは考えてみると中々奥深いものがありますので、ぜひ DFSG 
には一度目を通した上で Debian の考えるフリーという意味について Debian Developer の方などと
話をしてみてください。

\subsubsection{ボランティア}
最後のキーワードです。Debian はその開発や財政基盤を会社や財団に持たない極めて稀有な
開発集団です。大抵の有名ディストリビューションが企業をバックに開発をしていたり財団を
持ってそのいたりする\footnote{Fedora ← Red Hat, openSUSE ← Novell, Ubuntu ← Canonical, 
OpenOffice.org ← Oracle (Sun), Firefox ← Mozilla Foundation/Corporation など}のですが、
Debian 自体は財団や企業を持ちません\footnote{寄付などのために Software Public Interest 
という別法人がいますが、これは Debian だけではなく PostreSQL なども支援しています}。
ボランティアが世界中でインターネットを介して開発するという状態が10年以上も続けられており、
その規模は1000人を優に越えています。

\subsection{誰が Debian を使っているの?}
では、実際に誰が Debian を使っているのでしょうか? 「仕事で使うなら Red Hat 
Enterprise Linux かそのクローンの CentOS が普通だよね〜」などと言い切っている人は
いませんか? 実は、世の中に Debian で実際のビジネスを回している企業は山のようにあります。
その中にはあなたが知っている企業もあるはずです。また、開発に愛用しているという方も
少なくありません。あなたが使っているソフト／サービスは実は Debian が動いている／ベースに
なっている…かも知れませんよ。

\subsection{最後に}
簡単ではありますが、Debian の紹介をさせて頂きました。
これも何かの縁だし Debian を使ってみてもいいかな、と多少でも思っていただければ幸いです。


\subsection{Debian フリーソフトウェアガイドライン}
Debian フリーソフトウェアガイドライン全文(\url{http://www.debian.org/social_contract#guidelines})を掲載します。

\begin{figure}[h]
 {\small
1.「自由な再配布」…Debian システムを構成するソフトウェアのライセンスは、そのソフトウェアを、複数の異なる提供元から配布されているプログラムを集めたソフトウェア ディストリビューションの一部として、誰かが販売したり無料配布したりすることを 制限してはいけません。また、ライセンスはそのような販売に対して 使用料やその他の手数料を要求してはいけません。

2.「ソースコード」…プログラムにはソースコードが含まれていなければならず、 かつ実行形式での配布に加えてソースコードでの配布をも 許可していなければなりません。

3.「派生ソフトウェア」…ライセンスは、ソフトウェアの修正や派生ソフトウェアの作成、並びにそれら をオリジナルソフトウェアのライセンスと同じ条件の下で配布することを認め ていなけばいけません。

4.「原作者によるソースコードの整合性維持」…ライセンスは、プログラムを構築時に変更する目的でパッチファイル をソースコードとともに配布することを容認している場合に限り、 ソースコードを修正済の形式で配布することを制限することができます。 この場合、そのライセンスは修正済のソースコードから構築されたソフトウェアの 配布を明示的に許可していなければなりません。 またライセンスは派生ソフトウェアにオリジナルソフトウェアと異なる名前 を付けること、あるいは異なるバージョン番号を付けることを要求できます (これは妥協案です。Debian グループは全ての作者に、ファイル、 ソース、バイナリについての変更を制限しないよう奨めています)。

5.「すべての個人、団体の平等」…ライセンスは、すべての個人や団体を差別してはなりません。

6.「目標分野の平等」…ライセンスは、人々が特定の目標分野でプログラムを利用することを 制限してはいけません。たとえば、商用利用や、遺伝学の研究での プログラムの使用を制限していてはいけません。

7.「ライセンスの配布」…プログラムに付随する権利は、プログラムが再配布された すべての人々に対して、追加ライセンスの履行を必要とすることなく、 適用されなければなりません。

8.「ライセンスは Debian に限定されない」…プログラムに付随する権利は、プログラムが Debian システムの 一部であるかどうかに左右されてはいけません。 プログラムが Debian から取り出され Debian とは別に使用 または配布されるとしても、その他の点でそのプログラムの ライセンス条項を満たしているならば、プログラムが再配布された すべての当事者は Debian システムにおいて付与されたのと 同じ権利を与えられなければなりません。

9.「ライセンスは他のソフトウェアを侵害しない」…ライセンスは、そのソフトウェアとともに配布される他のソフトウェア に制約を加えてはなりません。たとえば、同じ媒体で配布される 他のソフトウェアがすべてフリーソフトウェアでなければならないと 要求してはいけません。

10.「フリーなライセンスの例」…GPL、BSD、および Artistic ライセンスは私たちがフリーと判断しているライセンスの例です。
}
\caption{The Debian Free Software Guidelines (DFSG)}
\label{fig:dfsg}
\end{figure}

% =======================================================================
\dancersection{DebianのOCaml環境で開発する関数型言語インタプリタ}{日比野啓}
\index{functional programming}
\index{ocaml}
% =======================================================================

\subsection{OCaml はどんな言語}
\subsubsection{基本的な機能}

\subsection{関数型言語のインタプリタの簡単な作りかた}

関数型言語とは何でしょうか。
ここでは関数を値としてあつかえる言語ということにして、
そのような言語のインタプリタを作る話をします。

\subsubsection{環境渡しマシン}



 参考資料: \verb|http://www.sato.kuis.kyoto-u.ac.jp/~igarashi/class/isle4-05w/text/eopl003.html|

\subsection{HaskellのLexing}

\subsubsection{ocamllex}

\subsection{HaskellのParsing}

\subsubsection{ocamlyacc}

\subsubsection{二項演算子の優先順位}

\subsubsection{あいまい文法の問題}

\subsection{HaskellのEvaluator}

\subsubsection{遅延評価}

\subsubsection{遅延パターンマッチ}

% =======================================================================
\dancersection{ブート方法が変わるよ}{まえだこうへい}
\index{upstart}
% =======================================================================

\subsection{Squeeze からブート方法が変わる}
Debian のブートの仕組みには、System-V 系 Unix では伝統的な init
(sysvinit) が使われています。Debian の次期安定版6.0 (コードネーム
Squeeze) から、これが upstart に変わる予定です。今年の 3 月にフリーズ予
定、8月にリリース予定のSqueeze での予習の意味を込めて、今回はこの
upstart に変わることになった背景、init との比較を含めた upstart の仕組み、
実際に切り替え方法について説明します。

\subsubsection{背景}

upstart は、Debian をベースとしたディストリビューションである、Ubuntu 独
自に sysvinit の後継の仕組みとして開発されました。元々 sysvinit は伝統的
で安定した仕組みではありますが、現在使われているハードウェアで使うには機
能面、性能面から問題が出てきています。そこで、sysvinit の後継の仕組みと
して、upstart 以外にも複数のブートプロセスの仕組みが開発されています。し
かし、Ubuntu 以外にも Fedora や ???, ??? といった主要なディストリビュー
ションでは upstart が採用され、Debian でも Squeeze から採用される(予定)
ということもあり、sysvinit の後継は upstart に落ち着くだろうと見られてい
ます。

\subsubsection{そもそも init って何よ？}

upstart の話をする前に、init って何？という人向けにまず説明しましょう。
init は今更説明しなくても知っとるがな、という読者は、先に読み進めてくだ
さい。

init は Unix/Linux システムにおいて、カーネルがブートした後、ユーザプロ
グラムが起動するための仕組みです。例えば、あなたの使っているノート PC や
サーバに入っている Debian システムでもこの仕組みが必ず入っています。マシ
ンに電源を入れてから、ログイン画面が表示されるまでの流れは大まかには次の
ようになります。

\begin{figure}[H]
\begin{center}
\includegraphics[height=0.8\hsize]{image201002/sysvinit.eps}
\end{center}
\end{figure}

init プロセスが起動すると、init は /etc/inittab の内容に従って、プロセス
のを生成や停止を行います。inittab の書式は次のようになります。

\begin{commandline}
id:runlevels:action:process
\end{commandline}


プロセスの生成に関わる部分には以下のようなものがあります。

\begin{commandline}
si::sysinit:/etc/init.d/rcS

l1:1:wait:/etc/init.d/rc 1
l2:2:wait:/etc/init.d/rc 2
l3:3:wait:/etc/init.d/rc 3
l4:4:wait:/etc/init.d/rc 4
l5:5:wait:/etc/init.d/rc 5
\end{commandline}

一行目にランレベルの指定が無いのは、action に sysinit が指定されているた
めです。これはステムブート中に実行され、他のブート用の action よりも優先
して実行されます。/etc/init.d/rcS では

\begin{commandline}
exec /etc/init.d/rc S
\end{commandline}

だけが実行されます。これは /etc/init.d/rc でのブート用の変数を設定します。
この後、上記の rc スクリプトに対し、起動時に指定するランレベルを 引数と
して実行されますが、Debian でのデフォルトは、ランレベル 2で起動されます。

\begin{commandline}
id:2:initdefault:
\end{commandline}

なので、実際には下記が実行されます。

\begin{commandline}
l2:2:wait:/etc/init.d/rc 2
\end{commandline}

これにより /etc/rc2.d 以下のファイル名が \textbf{S??} で始まるスクリプト
が ``??''の二桁の数字の部分が''\textbf{昇順であるように一つずつ実行}''さ
れます。同じレベルのスクリプトは並行して実行されますが、これが起動が遅く
なる原因の一つになっています。

\begin{commandline}
# Now run the START scripts for this runlevel.
# Run all scripts with the same level in parallel
CURLEVEL=""
for s in /etc/rc$runlevel.d/S*
do
        # Extract order value from symlink
        level=${s#/etc/rc$runlevel.d/S}
        level=${level%%[a-zA-Z]*}
        if [ "$level" = "$CURLEVEL" ]
        then
                continue
        fi
        CURLEVEL=$level
        SCRIPTS=""
        for i in /etc/rc$runlevel.d/S$level*
        do
                [ ! -f $i ] && continue

                suffix=${i#/etc/rc$runlevel.d/S[0-9][0-9]}
                if [ "$previous" != N ]
                then
                        #
                        # Find start script in previous runlevel and
                        # stop script in this runlevel.
                        #
                        stop=/etc/rc$runlevel.d/K[0-9][0-9]$suffix
                        previous_start=/etc/rc$previous.d/S[0-9][0-9]$suffix
                        #
                        # If there is a start script in the previous level
                        # and _no_ stop script in this level, we don't
                        # have to re-start the service.
                        #
                        if [ start = "$ACTION" ] ; then
                                [ -f $previous_start ] && [ ! -f $stop ] && continue
                        else
                                # Workaround for the special
                                # handling of runlevels 0 and 6.
                                previous_stop=/etc/rc$previous.d/K[0-9][0-9]$suffix
                                #
                                # If there is a stop script in the previous level
                                # and _no_ start script there, we don't
                                # have to re-stop the service.
                                #
                                [ -f $previous_stop ] && [ ! -f $previous_start ] && continue
                        fi

                fi
                SCRIPTS="$SCRIPTS $i"
                if is_splash_stop_scripts "$suffix" ; then
                        $debug splash_stop || true
                fi
        done
        startup $ACTION $SCRIPTS
done
\end{commandline}

なお、前述のとおり、Debian ではデフォルトのランレベルは 2 です。Debian
では 2から5 のランレベルは基本的には同じで、ランレベル 2 しか使いません。
他のディストリビューションのように、ランレベル 3 はテキストモード、ラン
レベル 5 は X Window System が立ち上がる、という切り替えはしません。これ
は Debian では、インストールされているパッケージというのは、ユーザが必要
だからインストールしているのである、という考えに基づき、インストールした
パッケージは全て最初から使えるようになっており、サービスであれば常時稼動
するようになっています。ただし、最近では インストールしてあってもシステ
ムブート時には起動せず、ユーザ\footnote{ここでいうユーザとは、システム管
理者に対するエンドユーザ、ではなく Debian システムを利用する Debian ユー
ザのことを指しています。}が任意の時に起動出来るように /etc/default/ 以下
の設定ファイルで制御できるようになっているものもあります。


起動スクリプトの起動以外には、ランレベル 2 から 5 または、2 か 3 の時に
はコンソールから getty が実行されます。action が \texttt{respawn} となっ
ていますが、これは getty プログラムが終了したら、init が再起動させるため
の指示です。あるユーザがコンソールからログインしたセッションを、ログアウ
トすると getty は終了しますが、init により再び ログイン画面で待ち受ける
ことができる、というわけです。

\begin{commandline}
1:2345:respawn:/sbin/getty 38400 tty1
2:23:respawn:/sbin/getty 38400 tty2
3:23:respawn:/sbin/getty 38400 tty3
4:23:respawn:/sbin/getty 38400 tty4
5:23:respawn:/sbin/getty 38400 tty5
6:23:respawn:/sbin/getty 38400 tty6
\end{commandline}

他の init の役割としては、システム停止時のプロセスの停止にも関わっていま
す。

\subsection{upstart とは}

\begin{commandline}

upstart
=======

Upstart is a replacement for the traditional sysvinit package, and
runs as process #1.  While it is eventually intended to be used to
create a completely event-driven boot process, we are currently
only using it to emulate the original sysvinit behaviour.

This gives us the maximum amount of testing of the code and concepts
behind it, while retaining the ability to fallback to sysvinit should
things not work out.

This file documents how to do a few common operations with the new
system.


Where are initscripts installed?
--------------------------------

This has not changed, they are installed in /etc/init.d.  See
/etc/init.d/README.


How are initscripts started and stopped?
----------------------------------------

This has not changed, symlinks are made from the initscript in the
/etc/init.d directory to the /etc/rc?.d directories.  See
/etc/init.d/README and /etc/rc?.d/README.


What order are initscripts started and stopped in?
--------------------------------------------------

This has not changed, the symlinks are named SNNname or KNNname, where
NN is a number from 00 to 99.  The K scripts are run first in
numerical order, followed by the S scripts in numerical order.


How do I find the current/previous runlevel?
--------------------------------------------

This has not changed, use the "runlevel" command.  See runlevel(8).


How do I change the runlevel?
-----------------------------

This has not changed, use the "telinit" command or just invoke "init"
directly.  See telinit(8).


How do I change the default runlevel?
-------------------------------------

Edit the /etc/inittab file.  Locate, or write, the following line:

    id:N:initdefault:

Where N is the default runlevel, change this to match.


How do I shutdown the machine?
------------------------------

This has not changed, use the "shutdown" command provided by the
upstart package; you may also use the "reboot"/"halt"/"poweroff"
commands as a short-cut.  See shutdown(8) and reboot(8).

You can also press Control-Alt-Delete on a console to reboot the
machine.


How do I change the behaviour of Control-Alt-Delete?
----------------------------------------------------

Edit the /etc/init/control-alt-delete.conf file, the line beginning
"exec" is what upstart will run when this key combination is pressed.

To not do anything, you can simply delete this file.


How do I enter single-user mode?
--------------------------------

This hasn't changed, choose the "(recovery mode)" option from GRUB;
add "-s", "S" or "single" to the kernel command-line; or from a
running machine, run "telinit 1" or "shutdown now".


How do I reduce the number of gettys?
-------------------------------------

Also see "How do I change which runlevels gettys are run in?"

In /etc/init there is a file named ttyN.conf for each getty that will be
started, where N is numbered 1 to 6.  Remove any that you do not
want.

This will not take immediate effect, however you can run "stop ttyN"
to stop one that is running.


How do I change getty parameters?
---------------------------------

In /etc/init there is a file named ttyN.conf for each getty that will be
started, where N is numbered 1 to 6.  Edit these files, the line
beginning "respawn" is what upstart will run.

This will not take immediate effect, run "stop ttyN" followed by
"start ttyN" or just kill the running getty to respawn with the new
parameters.


How do I change which runlevels gettys are run in?
--------------------------------------------------

In /etc/init there is a file named ttyN.conf for each getty that will be
started, where N is numbered 1 to 6.  Edit these files, there are two
lines:

   start on runlevel [2345]
   stop on runlevel [!2345]

Change the set of runlevels to match your taste.

This will not take immediate effect, however you can run "stop ttyN"
to stop one that is running or "start ttyN" to start one that isn't.


How do I increase the number of gettys?
---------------------------------------

In /etc/init there is a file named ttyN.conf for each getty that will be
started, where N is numbered 1 to 6.

Copy one of these files to a new name, we suggest you simply name it
after the tty, e.g. "ttyS0".

Edit that file, change the "respawn" line to match your requirements;
in particular you'll need to change the tty the getty should be run
on.

This will not take immediate effect, however you can run "start ttyN"
to start the getty.


How do I add a serial console?
------------------------------

See "How do I increase the number of gettys?"


Upstart isn't working, how do I debug it?
-----------------------------------------

Add "--debug" to the kernel command-line, and be sure to remove "quiet"
and "splash" if existent.  You'll now see debugging messages as upstart
works.

If you are using an initramfs generator other than initramfs-tools you
should use this option very carefully. There are for example known
problems with yaird, which doesn't correctly pass the --debug option to
init and as a consequence leads to a kernel panic. For more details
please see bug #416927.


Upstart isn't working, how can I rescue my system?
--------------------------------------------------

Here's a quick guide to rescuing your system:
 1. Edit the kernel command-line, remove "quiet" and "splash" if
    existent, add "init=/bin/bash".

    The machine will boot into a root shell.

 2. Run "/etc/init.d/rcS"

    The machine will set up the basic necessities such as hardware
    and networking.

 3. Ensure that upstart is properly installed

    Check if all files are installed in /etc/init. If not, reinstall the
    upstart package.

 5. Check that there are now files in /etc/init

 6. Run "sync" and "reboot -f"

    The machine will now reboot.
Hopefully your machine should now boot normally.


Can I query upstart for a list of jobs?
---------------------------------------

Yes, "initctl list" will list the known jobs and their status.


How do I manually start or stop a job?
--------------------------------------

Use "start JOB" or "stop JOB".


How do I find the status of a job?
----------------------------------

Use "status JOB".


Can I emit an event by hand?

Yes, "initctl emit EVENT" will emit the named event and cause any
jobs waiting for it to be started or stopped as appropriate.
\end{commandline}



\subsubsection{System V init 系との比較}

\subsection{Upstart への切り替え}

\subsubsection{Sid での場合}

\begin{commandline}
$ sudo apt-get install upstart
パッケージリストを読み込んでいます... 完了
依存関係ツリーを作成しています                
状態情報を読み取っています... 完了
以下の特別パッケージがインストールされます:
  dbus libdbus-1-3 libexpat1
提案パッケージ:
  dbus-x11
以下のパッケージは「削除」されます:
  sysvinit
以下のパッケージが新たにインストールされます:
  dbus libdbus-1-3 libexpat1 upstart
警告: 以下の不可欠パッケージが削除されます。
何をしようとしているか本当にわかっていない場合は、実行してはいけません!
  sysvinit
アップグレード: 0 個、新規インストール: 4 個、削除: 1 個、保留: 9 個。
1,005kB のアーカイブを取得する必要があります。
この操作後に追加で 2,105kB のディスク容量が消費されます。
重大な問題を引き起こす可能性のあることをしようとしています。
続行するには、'Yes, do as I say!' というフレーズをタイプしてください。
 ?] Yes, do as I say!
取得:1 http://cdn.debian.or.jp sid/main libdbus-1-3 1.2.20-2 [144kB]
取得:2 http://cdn.debian.or.jp sid/main libexpat1 2.0.1-7 [137kB]
取得:3 http://cdn.debian.or.jp sid/main dbus 1.2.20-2 [231kB]
取得:4 http://cdn.debian.or.jp sid/main upstart 0.6.3-1 [493kB]
1,005kB を 6s で取得しました (165kB/s)                                         
debconf: apt-utilsがインストールされていないため、パッケージの設定を遅らせます。
dpkg: warning: overriding problem because --force enabled:
 これは不可欠 (essential) パッケージです - 削除すべきではありません。
(データベースを読み込んでいます ... 現在 8736 個のファイルとディレクトリがインストールされています。)
sysvinit を削除しています ...
未選択パッケージ libdbus-1-3 を選択しています。
(データベースを読み込んでいます ... 現在 8710 個のファイルとディレクトリがインストールされています。)
(.../libdbus-1-3_1.2.20-2_amd64.deb から) libdbus-1-3 を展開しています...
未選択パッケージ libexpat1 を選択しています。
(.../libexpat1_2.0.1-7_amd64.deb から) libexpat1 を展開しています...
未選択パッケージ dbus を選択しています。
(.../dbus_1.2.20-2_amd64.deb から) dbus を展開しています...
未選択パッケージ upstart を選択しています。
(.../upstart_0.6.3-1_amd64.deb から) upstart を展開しています...
libdbus-1-3 (1.2.20-2) を設定しています ...
libexpat1 (2.0.1-7) を設定しています ...
dbus (1.2.20-2) を設定しています ...
Starting system message bus: dbus.
upstart (0.6.3-1) を設定しています ...
$
\end{commandline}

2010年2月9日現在、upstart に切り替えてまだうまく動かないようです。

\begin{commandline}
$ sudo lxc-start -n bootsid
cat: /proc/cmdline: No such file or directory
Setting the system clock.
Cannot access the Hardware Clock via any known method.
Use the --debug option to see the details of our search for an access method.
Unable to set System Clock to: Tue Feb 9 14:16:26 UTC 2010 ... (warning).
Activating swap...done.
mount: you must specify the filesystem type
Cannot check root file system because it is not mounted read-only. ... failed!
Setting the system clock.
Cannot access the Hardware Clock via any known method.
Use the --debug option to see the details of our search for an access method.
Unable to set System Clock to: Tue Feb 9 14:16:27 UTC 2010 ... (warning).
Cleaning up ifupdown....
Checking file systems...fsck from util-linux-ng 2.16.2
done.
Setting up networking....
Mounting local filesystems...done.
Activating swapfile swap...done.
Cleaning up temporary files....
Configuring network interfaces...done.
Setting kernel variables ...done.
Cleaning up temporary files....
Starting system message bus: dbus.
Starting OpenBSD Secure Shell server: sshd.
init: tty4 main process (239) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (241) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (242) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (244) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (245) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (306) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (307) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (308) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (309) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (310) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (311) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (312) terminated with status 1
init: tty1 main process ended, respawning

init: tty4 main process (313) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (314) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (315) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (316) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (317) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (318) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (319) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (320) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (321) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (322) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (323) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (324) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (325) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (326) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (327) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (328) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (329) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (330) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (331) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (332) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (333) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (334) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (335) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (336) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (337) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (338) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (339) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (340) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (341) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (342) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (343) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (344) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (345) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (346) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (347) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (348) terminated with status 1
init: tty1 main process ended, respawning
init: tty4 main process (349) terminated with status 1
init: tty4 main process ended, respawning
init: tty5 main process (350) terminated with status 1
init: tty5 main process ended, respawning
init: tty2 main process (351) terminated with status 1
init: tty2 main process ended, respawning
init: tty3 main process (352) terminated with status 1
init: tty3 main process ended, respawning
init: tty6 main process (353) terminated with status 1
init: tty6 main process ended, respawning
init: tty1 main process (354) terminated with status 1
init: tty1 main process ended, respawning
\end{commandline}

コンソールは tty がうまく動かないのか、login プロンプトが返ってこず、コ
ンソールログインはできませんが、ssh 経由のターミナルログインは問題なくで
きました。

\begin{commandline}
$ ssh bootsid
Enter passphrase for key '/home/kohei/.ssh/id_rsa': 
Linux bootsid 2.6.32 #1 SMP Mon Dec 7 05:27:50 UTC 2009 x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Feb  9 14:18:38 2010 from 192.168.189.114
kohei@bootsid:~$ 
\end{commandline}


\subsubsection{Lenny での場合}

Squeeze へアップグレードするときに、


% =======================================================================
\dancersection{東京エリアDebian勉強会予約システムの構想}{上川 純一}
\index{よやくしすてむ@予約システム}
% =======================================================================

\subsection{背景}
\index{えんかいくん@宴会君}
\index{ATND}
\index{cotocoto}

東京エリアDebian勉強会では「えんかい君」を予約システムとして利用していま
した。えんかい君はシンプルなユーザインタフェースで認証もなく、全員のメー
ルアドレスと名前が閲覧でき、他人の登録を誰でも削除できるなど、利用者を信
頼したモデルになっていました。後で立ち上がった関西ではcotocotoを利用して
いました。cotocotoは DFSG の観点では non-free なサービスです。

「えんかい君」はYLUGなどでも利用されていましたが、不便でした。東京では、
「えんかい君」の制限を回避するため、課題の提出をメール経由でやっていまし
た。当初はフリーフォーマットのメールを \LaTeX 形式に上川がバッチで変換す
る形式をとっており、のちに \LaTeX のソースコードをメールで git
format-patch で送るという運用になっていました。ただ、Gitで課題提出をして
いても、マージが面倒という問題点がありました。

2009年12月の勉強会登録には実験的に atnd を利用しました。atnd はDFSG
non-free なサービスですが、最近流行している勉強会等の予約システムです。

DFSG 準拠のアプリケーションのほうが望ましいが、「えんかい君」ではうまく運
用できないということと、アプリケーション自体はシンプルな問題であることが
予想されたため、自前で勉強会予約システムを準備してみることにしました。

\subsection{実装目標}

Debian勉強会の予約システムでは何が必要でしょうか。

\begin{itemize}
 \item イベントの主催者が簡便に登録情報を設定することができること。
 \item イベントの主催者が事前課題を設定し、回答を簡単に収集することがで
       きること。
 \item イベントの主催者が簡単に参加人数を確認することができること。
 \item イベントの主催者が新規参加者の情報を迅速に確認できること。
 \item イベントの主催者が参加者に直接連絡がとれる手段があること。
 \item 参加者が簡単に事前課題もあわせて登録できること。
 \item 参加者がイベント参加をキャンセルする方法があること。
 \item 参加者が参加しているイベントを把握する方法があること。
\end{itemize}

他にもいろいろあるかもしれませんが、とりあえずこういうものを目標にしてやっ
てみました。

そして、DFSG Free であることが望ましいです。

\subsection{開発環境の準備}

\subsubsection{App Engine Python SDK の準備}

今回はウェブアプリケーションのフレームワークとして、Python 版の Google
App Engine を利用しました。
開発環境をDebian GNU/Linux sid 上で準備する方法を紹介します。

まず、Debian GNU/Linux sid の環境を用意します。

次に、Google App EngineのPython版の開発環境をダウンロードします。Google
App Engine のサイト
\footnote{\url{http://code.google.com/intl/ja/appengine/}}にいって最新の
SDKをダウンロードしてきます。

「Linux/その他のプラットフォーム」向けの
\url{google_appengine_1.3.1.zip}をダウンロードしてきました。

\begin{commandline}
# apt-get install unzip python　python-webtest python-yaml
$ wget http://googleappengine.googlecode.com/files/google_appengine_1.3.1.zip
$ unzip google_appengine_1.3.1.zip 
\end{commandline}
% $ -- for emacs

これでインストールは完了です。
Google App Engine のインストールディレクトリを \url{./google_appengine}, 
App Engine アプリケーションのソースコードのおいている場所を\url{./utils/gae}とします。
utils/gae ディレクトリにから \url{dev_appserver.py}を実行すれば、開発用
のウェブサーバが起動します。

\begin{commandline}
hoge@core2duo:appengine/utils/gae$ ../../google_appengine/dev_appserver.py .
INFO     2010-02-16 15:28:08,816 appengine_rpc.py:159] Server: appengine.google.com
Allow dev_appserver to check for updates on startup? (Y/n): n
dev_appserver will not check for updates on startup.  To change this setting, edit /home/hoge/.appcfg_nag
WARNING  2010-02-16 15:28:13,792 datastore_file_stub.py:623] Could not read datastore data from /tmp/dev_appserver.datastore
WARNING  2010-02-16 15:28:13,906 dev_appserver.py:3581] Could not initialize images API; you are likely missing the Python "PIL" module. ImportError: No module named _imaging
INFO     2010-02-16 15:28:13,914 dev_appserver_main.py:399] Running application debianmeeting on port 8080: http://localhost:8080
\end{commandline}


\subsubsection{テストの実行方法}

Django の通常のアプリケーションはテスト用の仕組みがあるようなのですが、
appengine にはないようです。ここでは、WebTest モジュールを利用して自動テ
ストコードを実装しています。

\begin{commandline}
$ PYTHONPATH=../../google_appengine:../../google_appengine/lib/django/ \
 python testSystem.py
\end{commandline}

\subsection{実装}
\subsubsection{認証の仕組み}

このアプリケーションでは Google App Engine を利用しています。ユーザ認証は
Google App Engine で標準で提供されるGoogleの認証を流用しています。パスワー
ドの管理やユーザのメールアドレスの管理などをフレームワークに一任することで管理を
簡単にしています。


\subsubsection{データベースの構造}

バックエンドのデータベースには、AppEngineのDatastoreを利用しています。
Event と、 Attendance と UserRealName というのを定義しています。

Event は主催者がイベントについて登録した情報を保持しています。イベント毎
に存在しています。

Attendance はユーザがイベントに登録したという情報を保持しています。
イベントに対して登録したユーザの数だけ存在します。

UserRealname はユーザの表示名前の情報を保持しています。
各ユーザ毎に存在します。

\begin{commandline}

class Event(db.Model):
    eventid = db.StringProperty()
    owner = db.UserProperty() # the creator is the owner
    owners_email = db.StringListProperty() # allow owner emails to be added if possible
    title = db.StringProperty()
    location = db.StringProperty(multiline=True)
    content = db.StringProperty(multiline=True)
    content_url = db.StringProperty()
    prework = db.StringProperty(multiline=True)
    event_date = db.StringProperty()
    timestamp = db.DateTimeProperty(auto_now_add=True)
    capacity = db.IntegerProperty() # the number of possible people attending the meeting

class Attendance(db.Model):
    eventid = db.StringProperty()
    user = db.UserProperty()
    user_realname = db.StringProperty() # keep a cache of last realname entry.
    prework = db.StringProperty(multiline=True) # obsolete, but used in initial version
    prework_text = db.TextProperty() # Used everywhere, populate from prework if available.
    attend = db.BooleanProperty()
    enkai_attend = db.BooleanProperty()
    timestamp = db.DateTimeProperty(auto_now_add=True)

class UserRealname(db.Model):
    """Backup of user realname configuration so that user doesn't have to reenter that information."""
    user = db.UserProperty()
    realname = db.StringProperty()
    timestamp = db.DateTimeProperty(auto_now_add=True)

\end{commandline}

\subsubsection{ソースコードの構造}

ソースコードは現在下記の構成です。
\begin{itemize}
 \item \url{debianmeeting.py}: どのページがどのコードを呼び出すのかとい
       う部分を管理しているコードです。あと、どこに入れるのか迷ったコー
       ドもここにあるかも。
 \item \url{admin_event.py}: 主催者のイベントの管理関連のコードです。
 \item \url{user_registration.py}: ユーザの登録関連のコードです。
 \item \url{webapp_generic.py}: とりあえず共通のロジックを定義しています。
       POST と GET を同じように扱うためのコードなどが入っています。
 \item \url{schema.py}: データストアのスキーマが定義されています。
 \item \url{send_notification.py}: メール送信とXMPP送信ロジックが記述さ
       れています。
 \item \url{testSystem.py}: ユニットテストです。
\end{itemize}

ソース内部からテンプレートファイルが参照されています。

\begin{itemize}
 \item \url{EditEvent.html}
 \item \url{PreworkLatex.txt}
 \item \url{RegisterEvent.txt}
 \item \url{Thanks.html}
 \item \url{TopPage.html}
 \item \url{UserCommitEventRegistration.txt}
 \item \url{UserEventRegistrationPage.html}
 \item \url{UserEventRegistrationPage_Simple.html}
 \item \url{ViewEventSummary.html}
\end{itemize}

\subsubsection{ウェブページの遷移}

ウェブページの遷移とソースコードの対応をみてみます。

\includegraphics[width=1\hsize]{image201001/debian-reservation-flow.eps}


\subsection{今後の展望}


とりあえずは動いています。今後、何が変わるべきか。今後どういう点が実装さ
れるべきか。パッチウェルカム。



%\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
