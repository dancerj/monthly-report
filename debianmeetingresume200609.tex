%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2006 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%   Pdf作成手順
% dvipdfmx debianmeetingresume200609.dvi
%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200609; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}

%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}


%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\Huge\headfont\raggedright\centering}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
東京エリアDebian勉強会 2006
\hrule
\vspace{0.5mm}
\hrule
%\hfill{}\includegraphics[width=3cm]{image200502/openlogo-nd.eps}\\
\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-5cm}
\begin{center}
\section{#1}
\end{center}
\hfill{}\colorbox{white}{#2}\hspace{3cm}\space\\
\vspace{1cm}
\hrule
\vspace{0.5mm}
\hrule
\vspace{1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{#1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}


\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに
\title{\includegraphics[width=7cm]{image200502/openlogo-nd.eps}\\
 第20回 東京エリア Debian 勉強会\\事前資料}
\date{2006年9月16日}
\author{Debian勉強会会場係 上川純一\thanks{Debian Project Official Developer}} 
\maketitle
\thispagestyle{empty}
\end{titlepage}

\newpage
\tableofcontents

\dancersection{Introduction To Debian 勉強会}{上川純一}

今月のDebian勉強会へようこそ。
これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
るという方も、月に一回Debianについて語りませんか？

目的として下記の二つを考えています。

\begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報を情
       報共有する場をつくる
 \item まとまっていないDebianを利用する際の情報をまとめて、ある程度の塊と
       して出してみる
\end{itemize}

また、東京にはLinuxの勉強会はたくさんありますので、Debianに限定した勉強
会にします。Linuxの基本的な利用方法などが知りたい方は、他でがんばってくださ
い。
Debianの勉強会ということで究極的には参加者全員がDebian Packageを
がりがりと作りながらスーパーハッカーになれるような姿を妄想しています。

Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
情報の共有をしたい、というのが目的です。
次回は違うこと言ってるかもしれませんが、御容赦を。

\subsection{講師紹介}

\begin{itemize}
 \item{上川純一} 宴会の幹事です。
\end{itemize}

\subsection{事前課題紹介}

今回の事前課題は
「XXX」
というタイトルで200-800文字程度の文章を書いてください。
というものでした。
その課題に対して下記の内容を提出いただきました。

\subsubsection{}

\subsubsection{上川}


%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2006年XX号}
\url{http://www.debian.org/News/weekly/2006/XX/}
にある5月XX日版です。

\santaku
{}
{}
{}
{}
{}


\santaku
{}
{}
{}
{}
{}

\santaku
{}
{}
{}
{}
{}

\santaku
{}
{}
{}
{}
{}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会19回目報告}
% (query-replace-regexp "<.*>" "")

   	  東京エリアDebian勉強会報告。8月の第19回Debian勉強会を実施しま
	  した．今回は岩松さんがDebian Conference 開催進捗報告をしました。
	  また、Lightning talkを開催しました。
	  
	  今回の参加人数は17人でした。
	  
	  参加者はgotomさん、山下さん、山根さん(中央線の事故の影響で結局
	  宴会の最後になって到着)、岩井さん、南谷さん、前田耕平さん、た
	  かやさん、きたはらさん、岩松さん、あけどさん、平川さん、小林さ
	  ん、えとーさん、吉田@板橋さん、みつかさん、野首さん、上川です。
	  
	    まず、Debian のソフトウェア関するポリシーである、 Social Contract 
	    の内容を確認しました。
	  
	    異様な盛り上がりを見せながらユーザの声を紹介。事前課題をねたにしました。
	    たかやさんがhowmのDebianパッケージをオフィシャルパッケージにするということなので、期待です。
	  
	  
	    Debian Weekly News Quiz は今回は正解者には Debian シールをプレゼントしました。
	    問題数を少なめにして、早押しならぬ、早手あげで競争してもらいました。
	  
	  
	    岩松さんが北海道で下見をしてきた内容を踏まえてDebconf in Japan の検討事項について報告しました。
	    東京や大阪など国際的にトランジットの利便のよい場所がよいですね、という話などが出ました。
	  
	  
	    Lightning talksの一発目は野首さん。
	    プロフェッショナルな感じで、しっかりと執念を感じさせてくれる話でした、ありがとうございます。
	  
	  
	    吉田さんには、大衆向けIPv6サービスを利用してみた話をしてい
	    ただきました。まだいろいろと問題があるようで、すぐに使える
	    のかなぁ、という印象はうけましたが、今後オフィシャルパッケー
	    ジにマージされたりするとより利用しやすくなるでしょうから、
	    今後の活躍に期待です。
	  
	  
	    Henrichさんは鉄道事故の関係で間に合いませんでした。残念。
	  
	  
	    山下さんには誕生日に思うことに付いて語っていただきました。
	    淡々と語っていただきありがとうございます。
	  
	  
	    上川が module-assistant の使いかたについて話しました。
	    module-assistant は意外にもつかっている人が少なく、
	    話をしがいがありました。
	    kernel module は必要な場合もあるので、ぜひパッケージできるようにしておくとよいと思います。
	    特に、module-assistantは使う側からすると従来の手法より非常に使い易くなっているのでよいよ、
	    という話でした。
	  
	  
	    上川が最後に「board@jpお仕事日記」として発表しました。
	    ここにかけるような内容ではないので、割愛。	    
	  
	  
	    今後のイベントにどういう参加方法をとるかということを検討し
	    ました。OSC-Fall にはブースも出して、いろいろなデバイスを
	    ハックしている姿を展示しましょう、ということになりました。
	    また、OSCの沖縄には岩松さんとわたしは参加する、ということになりました。さらなるメンバー募集します。
	    KOFについては4人くらい参加すると宣言していたので、参加することになりそうです。
	  
	  
	    宴会は「土間土間」にて開催。
	    けっこうよい場所を独占できたので、よい感じでした。

\subsection{Lightweight Language Ring}

上川が、軽量言語の祭典、LLRINGに参加してきました。

発表した内容は、real kernel shell についてです。C言語をライトウェイトに
使いましょう、という話題です。

Haskell が異様にはやっていたのと、ウェブフレームワークでがりがりとやって
いるかたがたを横目にカーネルの話をしてきました。

\includegraphics[width=1\hsize]{image200609/20060827-llgong.jpg}

%% さわださんここから
\dancersection{あなたが知らないうちに使っているDebian specific}{澤田さん}
\label{sec:sawadadebianspecific}

\subsection{はじめに}
\subsection{おわりに}

%% さわださんここまで
%% 小林さんここから
\dancersection{翻訳へのさそい}{小林さん}
\label{sec:honnyaku}

\subsection{po 関連}

現状のMLについてのWebは、
\url{http://www.debian.or.jp/MailingList.html}
です。

この中で翻訳関連を行なっているのは
Debian JP Documentation メーリングリストです。

\url{debian-doc-ctl@debian.or.jp} に fml の方式でsubscribeしてください。
過去記事は
\url{http://lists.debian.or.jp/debian-doc/}
にアクセスすると見ることができますので、ご参考にどうぞ。
こちらは、 man 、debconf-po、po、および 付属ドキュメントなどの
翻訳を行なっています。

Debianのpoの各国のランキングです。
\url{http://www.debian.org/international/l10n/po/rank}

\subsection{debconf-po関連}

Debian のパッケージインストールの際に debconf から質問されます。
その質問の文字列を国際化するのがdebconf-po です。

% 画面写真とか?

Debianのdebconf-poの各国のランキングです。
\url{http://www.debian.org/international/l10n/po-debconf/rank}

ちなみにdebconf-poについての国内での作業は作業がかぶらないように
\url{http://kmuto.jp/debian/po-trans/}
を使いながらやるとよいかと思われます。

\subsection{Debian JP WWW メーリングリスト}

\url{debian-www-ctl@debian.or.jp} に fml の方式でsubscribeしてください。
過去記事は
\url{http://lists.debian.or.jp/debian-www/}
にアクセスすると見ることができますので、ご参考にどうぞ。

こちらは、主にdebian.orgのwebサイトの翻訳および、debian.or.jpの
webサイトについて活動しています。

以下私見ですなにかの参考になりましたら。
偉そうかもしれませんが、ご容赦を、、、

おそらくは、debian-doc などで活動を行なうと ubuntu のほうにも当然のよう
に波及しますので、こちらの作業を行なうのもよいかなと思いました。

ddtp というプロジェクトで以前パッケージディスクリプション部分(本日もう昨
日か、、見せていただいたアプリケーション一覧の説明部分とか？）を翻訳して
いるプロジェクトがありましたが、一旦停止しています。近々復帰しそうですの
で、DWN（Debian Weekly News)などを注視していただくとそのうちなんか出てく
るかもです。

Debianプロジェクトはあなたの参加を心待ちにしております。でわでわ


\subsection{参考文献}


\begin{itemize}
 \item ドキュメント翻訳手順 \url{http://kmuto.jp/d/index.cgi/debian/debian-doc-procedure.htm}
\end{itemize}


%% 小林さんここまで

\dancersection{apt/dpkgのプロファイリング}{上川}
\label{sec:dancerjapt}

aptやdpkgのどの部分が一番遅いのか、実際にプロファイリングしてみます。
この例をケーススタディーとして一般的にどういう作業をすればパフォーマンス
チューニングができるのか、をあきらかにしてみましょう。

\subsection{oprofie のインストールと設定方法}

Debianのデフォルトのカーネルはoprofileをサポートしています
\footnote{i386, amd64　などのアーキテクチャ以外での利用は現時点では難し
い可能性があるので確認してください。} 。もし、自分でコンパイルしていたり
して oprofile サポートを追加していない場合は、カーネルを oprofile サポー
ト付きでコンパイルしなおします。オプションは \texttt{CONFIG\_OPROFILE}
です。メニューでは

\texttt{Intrumentation support : Profiling Support :
Oprofile system profiling (experimental)}\footnote{2.6.18-rc1 現在}

にあります。

カーネルがサポートしている場合、oprofileを利用するのに追加で必要なのは
\texttt{oprofile}パッケージです。
\texttt{apt-get install oprofile}でインストールしましょう。

\subsection{oprofile が自分の利用しているCPUをサポートしていない場合}

残念ながら7月現在時点で、Intel core duo CPU 上ではoprofileが動作しません。
oprofile は認識できていない場合、cpu\_type 変数が unset という値になりま
す。カーネル側は cpu\_type として i386/core を出力しているので、この時点
でどうやらカーネル側のサポートは追加されているらしいということがわかりま
す。

\begin{commandline}
$ sudo opcontrol --init
cpu_type 'unset' is not valid
$ opcontrol --list-events
Unable to open cpu_type file for reading
Make sure you have done opcontrol --init
cpu_type 'unset' is not valid
$ cat /dev/oprofile/cpu_type
i386/core
$ uname -a
Linux coreduo 2.6.18-rc1dancer #2 SMP Sun Jul 9 09:57:01 JST 2006 i686 GNU/Linux
\end{commandline}

プロファイルを取得するという目的を考えると手段としてはいくつか考えられます。

\begin{itemize}
 \item プロファイルの仕組はあまりかわらないだろうと見込み、
       \url{arch/i386/oprofile/nmi_int.c}の ppro\_init を修正、
       piiiとかに見せてしまう

 \item まじめにoprofileのユーザ空間アプリケーションを修正、core duo　の
       仕様書を読み、対応を追加

 \item おそらくすでに修正されていることを見越して、oprofile の CVS レポ
       ジトリをみにいく       

 \item 実験することが目的なのでサポートされているCPUのマシンを準備する

\end{itemize}

今回はoprofileの開発メーリングリストを見たところ、5月の時点でだれかがパッ
チを書いているのを発見したので、それをとりこみます。
念のため、今後作業する人のためにBTSにも登録しました。\debianbug{380462}

確認してみると、どうやら動作してくれてそうです。ここで、当面重要なのは、
CPU\_CLK\_UNHALTEDでしょう。CPUサイクルがどの関数で消費されているのかと
いうことをトラッキングできます。まずCPUの処理がかたまっている部分を目指
して、何か問題がないかを眺めてみて、何も問題なく、それなりに問題が追求で
きにくくなった後に、L2キャッシュのイベントの発生度合とかを確認していけば
よいでしょう。

\begin{commandline}
$ sudo opcontrol --init
$ sudo opcontrol --list-events
oprofile: available events for CPU type "Core Solo / Duo"

See Intel Architecture Developer's Manual Volume 3, Appendix A and
Intel Architecture Optimization Reference Manual (730795-001)

CPU_CLK_UNHALTED: (counter: all)
        Unhalted clock cycles (min count: 6000)
        Unit masks (default 0x0)
        ----------
        0x00: Unhalted core cycles
        0x01: Unhalted bus cycles
        0x02: Unhalted bus cycles of this core while the other core is halted
INST_RETIRED: (counter: all)
        number of instructions retired (min count: 6000)
L2_RQSTS: (counter: all)
        number of L2 requests (min count: 6000)
        Unit masks (default 0xf)
        ----------
        0x08: (M)odified cache state
        0x04: (E)xclusive cache state
        0x02: (S)hared cache state
        0x01: (I)nvalid cache state
        0x0f: All cache states
        0x10: HW prefetched line only
        0x20: all prefetched line w/o regarding mask 0x10.

[省略]

\end{commandline}

\subsection{デバッグシンボルを収集する：dpkg と apt をコンパイルしなおす}

まず、デバッグ情報がすでにあるパッケージについては、インストールします。
今回では、大きいものとして、libc6-dbg パッケージがあるので、それはインス
トールします。プロファイルの結果、上位に出現するなどで、必要そうであれば、
あとでデバッグ情報のあるバージョンを追加します。

今回プロファイル対象のdpkg と apt はデフォルトではデバッグ情報がありませ
ん、プロファイル出力を確認しやすいように、デバッグシンボルを追加してコン
パイルしなおします。

\begin{commandline}
 $ debuild -e DEB_BUILD_OPTIONS=nostrip
\end{commandline}
%$
その後、インストールします。

まず、oprofileを実行するのを便利にするために、スクリプトを仕込みます。
入力されたコマンドを10回実行してそのプロファイルを取得するというものです。

\begin{commandline}
 read CMD
 sudo opcontrol --shutdown
 sudo opcontrol --reset
 sudo opcontrol --setup \
  --vmlinux=/lib/modules/$(uname -r)/build/vmlinux \
    --event=CPU_CLK_UNHALTED:180000:0:1:1 --separate=library
    sudo opcontrol --start
 for A in $(seq 1 10); do
   $CMD
 done
 opcontrol --dump && \
 opreport -l -p /lib/modules/$(uname -r)/kernel 2>/dev/null \
  | head -30
\end{commandline}

まず、デバッグ用のバイナリが正常に作成できているか簡単に確認します。まず、
apt-get update をループでまわしてみます。libapt-pkgのシンボルレベルで確
認できているので、デバッグシンボルが存在しているということがわかります。

\begin{commandline}
sudo apt-get update
\end{commandline}

\begin{commandline}
CPU: Core Solo / Duo, speed 1833 MHz (estimated)
Counted CPU_CLK_UNHALTED events (Unhalted clock cycles) with a unit mask of 0x00 (Unhalted core cycles) count 180000
samples  %        image name               app name                 symbol name
23823    46.3519  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  SHA1Transform(unsigned int*, unsigned char const*)
12732    24.7724  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  MD5Transform(unsigned int*, unsigned int const*)
4282      8.3314  processor.ko             processor                acpi_processor_idle
2584      5.0276  libc-2.3.6.so            apt-get                  (no symbols)
2012      3.9147  vmlinux                  vmlinux                  __copy_to_user_ll
503       0.9787  gpgv                     gpgv                     (no symbols)
222       0.4319  vmlinux                  vmlinux                  timer_interrupt
166       0.3230  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  MD5Summation::Add(unsigned char const*, unsigned long)
160       0.3113  vmlinux                  vmlinux                  page_fault
158       0.3074  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  SHA1Summation::Add(unsigned char const*, unsigned long)
140       0.2724  libstdc++.so.6.0.8       apt-get                  (no symbols)
134       0.2607  vmlinux                  vmlinux                  find_get_page
125       0.2432  ld-2.3.6.so              http                     do_lookup_x
123       0.2393  vmlinux                  vmlinux                  sysenter_past_esp
95        0.1848  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  .plt
94        0.1829  ld-2.3.6.so              gpgv                     do_lookup_x
89        0.1732  libc-2.3.6.so            http                     (no symbols)
89        0.1732  vmlinux                  vmlinux                  do_generic_mapping_read
88        0.1712  ld-2.3.6.so              file                     do_lookup_x
87        0.1693  vmlinux                  vmlinux                  memcpy
72        0.1401  ld-2.3.6.so              http                     strcmp
69        0.1343  vmlinux                  vmlinux                  _spin_lock
65        0.1265  vmlinux                  vmlinux                  vfs_read
64        0.1245  ld-2.3.6.so              gpgv                     _dl_elf_hash
62        0.1206  vmlinux                  vmlinux                  __handle_mm_fault
60        0.1167  ld-2.3.6.so              http                     _dl_elf_hash
58        0.1128  oprofiled                oprofiled                (no symbols)
\end{commandline}

dpkgについてもプロファイリングしてみます。\footnote{ここで問題が出ました。
libc6 の dbg　パッケージの情報を oprofile が処理できていないようです。
straceで解析してみましたが、ファイルをひらくところまでは何かできているよ
うです。これは別途バグ報告してみます。}

\begin{commandline}
sudo dpkg -i ../dselect_1.13.22_i386.deb
\end{commandline}

\begin{commandline}
CPU: Core Solo / Duo, speed 1833 MHz (estimated)
Counted CPU_CLK_UNHALTED events (Unhalted clock cycles) with a unit mask of 0x00 (Unhalted core cycles) count 180000
samples  %        image name               app name                 symbol name
41009    32.6009  libc-2.3.6.so            dpkg                     (no symbols)
27485    21.8497  processor.ko             processor                acpi_processor_idle
14863    11.8156  dpkg                     dpkg                     parsedb
4845      3.8516  dpkg                     dpkg                     findnamenode
2691      2.1393  dpkg                     dpkg                     findpackage
1994      1.5852  dpkg                     dpkg                     f_dependency
1742      1.3848  vmlinux                  vmlinux                  get_page_from_freelist
1660      1.3196  dpkg-deb                 dpkg-deb                 inflate_fast
1552      1.2338  dpkg                     dpkg                     iterpkgnext
1520      1.2084  dpkg                     dpkg                     .plt
1500      1.1925  dpkg                     dpkg                     varbufaddbuf
1192      0.9476  dpkg                     dpkg                     filesdbinit
1080      0.8586  dpkg                     dpkg                     w_dependency
1001      0.7958  dpkg                     dpkg                     varbufdependency
988       0.7854  dpkg                     dpkg                     nfmalloc
884       0.7028  dpkg                     dpkg                     illegal_packagename
849       0.6749  vmlinux                  vmlinux                  page_fault
802       0.6376  vmlinux                  vmlinux                  __copy_from_user_ll_nocache_nozero
687       0.5461  dpkg                     dpkg                     ensure_packagefiles_available
633       0.5032  dpkg                     dpkg                     varbufaddc
568       0.4515  dpkg                     dpkg                     f_filecharf
516       0.4102  vmlinux                  vmlinux                  __copy_to_user_ll
473       0.3760  dpkg                     dpkg                     copy_dependency_links
458       0.3641  dpkg                     dpkg                     parseversion
427       0.3395  dpkg                     dpkg                     ensure_package_clientdata
406       0.3228  dpkg                     dpkg                     nfstrsave
384       0.3053  dpkg                     dpkg                     varbufrecord
\end{commandline}

パッケージをインストールして削除する、というループを回してみましょう。
\texttt{apt-listbugs}と\texttt{apt-listchanges}が含まれており、ruby と
pythonの処理負荷が高いことがわかります。また、libc6のなかで何か重たい処
理をしているのがわかります。

\begin{commandline}
 sudo apt-get install -y dsh; sudo apt-get remove -y libdshconfig1
\end{commandline}

\begin{commandline}
Counted CPU_CLK_UNHALTED events (Unhalted clock cycles) with a unit mask of 0x00 (Unhalted core cycles) count 180000
samples  %        image name               app name                 symbol name
195383   24.3783  processor                processor                (no symbols)
114285   14.2595  libc-2.3.6.so            dpkg                     (no symbols)
67157     8.3793  libruby1.8.so.1.8.4      ruby1.8                  (no symbols)
48893     6.1005  libc-2.3.6.so            dpkg-query               (no symbols)
41537     5.1826  dpkg                     dpkg                     parsedb
30685     3.8286  perl                     perl                     (no symbols)
28353     3.5377  dpkg-query               dpkg-query               parsedb
26135     3.2609  python2.4                python2.4                (no symbols)
13951     1.7407  libc-2.3.6.so            ruby1.8                  (no symbols)
10023     1.2506  libc-2.3.6.so            apt-get                  (no symbols)
9138      1.1402  dpkg                     dpkg                     findnamenode
7914      0.9874  vmlinux                  vmlinux                  get_page_from_freelist
7656      0.9553  dpkg                     dpkg                     findpackage
5963      0.7440  vmlinux                  vmlinux                  read_hpet
5777      0.7208  libc-2.3.6.so            perl                     (no symbols)
5465      0.6819  dpkg                     dpkg                     f_dependency
5108      0.6373  dpkg-query               dpkg-query               findpackage
4525      0.5646  dpkg                     dpkg                     filesdbinit
4452      0.5555  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  pkgDepCache::CheckDep(pkgCache::DepIterator, int, pkgCache::PkgIterator&)
4237      0.5287  vmlinux                  vmlinux                  page_fault
4182      0.5218  dpkg                     dpkg                     .plt
4101      0.5117  dpkg                     dpkg                     varbufaddbuf
3874      0.4834  dpkg-query               dpkg-query               f_dependency
3744      0.4671  dpkg                     dpkg                     iterpkgnext
3645      0.4548  libstdc++.so.6.0.8       apt-get                  (no symbols)
3287      0.4101  libapt-pkg-libc6.3-6.so.3.11.0 apt-get                  pkgProblemResolver::MakeScores()
3277      0.4089  vmlinux                  vmlinux                  delay_tsc
\end{commandline}

\subsection{テスト環境の作成}

テスト用の環境を作成します。今回はchroot　内部で大量の apt-get update,
apt-get install と apt-get remove をループで実行してベンチマークをとって
みましょう。

dpkgとaptを変更すると最悪システムが動作しなくなるため、テスト用に環境
を準備することは大切です。

\begin{commandline}
 $sudo cowbuilder --login --bindmount $(pwd)
\end{commandline}


\subsection{最適化の必要な部分の解析}

プロファイル結果を利用して、解析します。

\subsection{最適化例}

今回の結果で適用できる最適化を分析します。

\subsection{結果の検証}

さきほどのベンチマークを利用して、状況が改善していることを確認します。

\subsection{回帰テストの貢献}

できるようであれば、今回の修正が二度と必要ないように、パフォーマンスのデ
グレードがすぐに検出しやすいよう、再現しやすいテストケースを追加してみる
のもよいでしょう。

\subsection{修正をフィードバック}

パフォーマンスの改善のための修正をフィードバックします。
Debian の場合、BTSにパッチを登録します。
該当するバグ番号は下記です。

\begin{itemize}
 \item XXX
 \item YYY
\end{itemize}

\subsection{参考文献}

\begin{itemize}
 \item rpmのプロファイリング \url{https://www.redhat.com/magazine/012oct05/features/oprofile/}
\end{itemize}
\dancersection{次回}{}

未定です。
内容は本日決定予定です。

参加者募集はまた後程。

\newpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont 2006年9月16日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
