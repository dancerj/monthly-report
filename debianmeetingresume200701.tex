%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2007 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200701; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}


% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2007}
\newcommand{\debmtgdate}{20}
\newcommand{\debmtgmonth}{1}
\newcommand{\debmtgnumber}{24}



%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\fbox{\TheSbox}}


%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\gt\fontsize{32}{32}\headfont\raggedright}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
第\debmtgnumber{}回 東京エリアDebian勉強会 \debmtgyear{}年\debmtgmonth{}月
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{4cm}
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{-7cm}
\begin{minipage}[b]{0.7\hsize}
\section{#1}
\hfill{}#2\\
\vspace{2cm}
\end{minipage}
\begin{minipage}[b]{0.3\hsize}
\hfill{}\includegraphics[height=8cm]{image200502/openlogo-nd.eps}\\
\end{minipage}
%
%\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{Bug\##1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}




\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに


 第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\vspace{2cm}

\begin{minipage}[t]{0.6\hsize}
\vspace{-2cm}
{\fontsize{60}{60}
{\gt
東京エリア \\
デビアン \\
勉強会
}}
\end{minipage}
\begin{minipage}[b]{0.4\hsize}
\hspace{-1cm}\includegraphics[width=9cm]{image200502/openlogo-nd.eps}
\end{minipage}

\vspace{3cm}
\hfill{}Debian勉強会幹事 上川純一\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{上川純一}
 
 今月のDebian勉強会へようこそ。
 これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
 るという方も、月に一回Debianについて語りませんか？

 目的として次の二つを考えています。

 \begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報につ
       いて情報共有する場をつくる
 \item Debianを利用する際の情報をまとめて、ある程度の塊として整理するた
       めの場をつくる
 \end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。

 Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
 情報の共有をしたい、というのが目的です。


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川純一}

今回の事前課題は
「XXXX」
というタイトルで200-800文字程度の文章を書いてください。というものでした。
その課題に対して下記の内容を提出いただきました。

\subsection{}

\subsection{上川}

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2006年42号}
\url{http://www.debian.org/News/weekly/2006/42/}
にあるX月X日版です。

\santaku
{}
{}
{}
{}
{}


\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会22回目報告}
% (query-replace-regexp "<.*>" "")


   	  東京エリアDebian勉強会報告。
	  12月の第23回Debian勉強会を実施しました。
	    Bug Squashing Party について報告するのと、一年間のDebian 勉強会を反省する会です。
	  
	  今回の参加人数は15人でした。
	  あけどさん、小室さん、小林さん、岩松さん、Henrichさん、前田さん、澤田さん、キタハラさん、青木さん、みつかさん、えとーさん、
	  でんさん、野首さん、gotomさん、上川でした。
        
	
	  
	    まず、事前課題の紹介をしました。来年のスタイルについてのみ
	    なさまの提案をいただきました。今Debianの各種インタフェース
	    がどうなっているのかドキュメントを作成している、それには価
	    値がある、という話や、会場で実習する「ハンズオン」ができる
	    と、忘れないうちに体験できるのでよいよね、という話題、ネッ
	    トワークの事前課題で出てきたような特定のトピックにまつわる
	    バッドノウハウをたくさん集めるというのを今後もやりたいとい
	    うのが出てきました。また、用語がわからないというかまったく
	    ついていけない場合があるのだが、そういうのをログをとってお
	    いて後から質問できるようになっているとよいのではないかとい
	    う提案などがありました。
	  
	  
	    岩松さんと gotom さんが、先日開催した Bug Squashing Party 
	    についての報告を実施しました。今回のBSPでは、etchリリース
	    直前ということもあり、難しいバグしか残っていないことで、日
	    本のメンテナのバグを修正するという方向を出してみました、と
	    のことです。BSP をやるまえに課題を洗い出してくださいという
	    メールを出すのはよいのではないかという提案がありました。今
	    後も開催したいのでBSP ができる会場を探したいそうです。まだ
	    よい会場をみつけれていないのですが、例えば二ヶ月に一回くら
	    い開催するために場所を探しているというメールを出したら誰か
	    良い場所を教えてくれるのではないか、というのが希望的観測で
	    した。
	  
	  
	    上川が今年一年のアクティビティーの結果をまとめて報告しまし
	    た。ふりかえってみるといろいろとみえてきます。今年は結果と
	    して7回は通常運用の方法で開催していましたが、6回は場所を外
	    部にとって違う場所で開催しているということが判明しました。
	    来年も半々くらいでやっていくのがよいんじゃないかと思います。
	    1月に実施内容を決定するようにしましょう、という話になりました。
	  
	  
	    宴会は荻窪 うさぎにて。素敵なお店でした。

\dancersection{Debian勉強会 2007年度計画}{上川純一}
\label{sec:debmtg2007gw}

「12ヶ月分のアジェンダを作成してください」

\begin{enumerate}
 \item 新年会(\hspace{8cm})
 \item (\hspace{8cm})
 \item OSC? (\hspace{8cm})
 \item OSC-Do? (\hspace{8cm})
 \item (\hspace{8cm})
 \item エジンバラ開催 (\hspace{8cm})
 \item (\hspace{8cm})
 \item (\hspace{8cm})
 \item (\hspace{8cm})
 \item (\hspace{8cm})
 \item OSC-Fall? (\hspace{8cm})
 \item KOF? (\hspace{8cm})
 \item 忘年会(\hspace{8cm})
\end{enumerate}

名前のブランディングを考えてください。
通常実施の勉強会を「\hspace{8cm}」と呼ぶ。
大衆向けの勉強会を「\hspace{8cm}」と呼ぶ。



\dancersection{仮想マシンモニタKVM}{上川純一}
\label{sec:kvm}

KVM という仮想マシンモニタがあります。これは、 Intel VT, もしくは、AMD-V 
対応のプロセッサ\footnote{Intel Core Duoや、Opteron Rev. Fなど} の仮想化
対応機能を活用するための仕組です。2006年末の時点では、kvmはデバイスドラ
イバとして実装されており、 \texttt{/dev/kvm}として実装されています。


\subsection{使いかた}

Linus Kernel 2.6.20 以降ではカーネル側の機構は標準で入っているようです。
\footnote{2.6.20-rc1 で導入されたので、現時点では予測です}

udev が作成してくれる /dev/kvm にアクセスできるようにします。 デフォルト
は root:root 660 なのでそれを変更して自分がアクセスできるようにします。

VTはデフォルトで on になっていない場合があるので、 on にします。これはマ
シンによって違うようです。 MacBook の場合は EFI 上で必要なコマンドを発行
すればよいです。

apt-get install kvm でパッケージをインストールします。

以上で、kvm コマンドが利用できるようになります。コマンドラインなどはqemu 
互換、むしろ qemu そのものを利用しているので、qemu と同じように動かすこ
とができます。

\subsection{実行例}

kvm を活用していろいろと試してみましょう。qemu 用のディスクイメージを作
成し、適当なディストリビューションのディスクイメージを利用して、インストー
ルします。おそらく、-monitorコマンドで stdio をモニタにするほうが便利で
しょう。

\begin{commandline}
$ qemu-img create -f qcow hda 10G
$ sudo chown dancer:dancer /dev/kvm
$ kvm -hda hda -cdrom /home/iso/RHEL4-U4-i386-AS-disc1.iso
   -boot d -m 512 -monitor stdio
(qemu) change cdrom /home/iso/RHEL4-U4-i386-AS-disc2.iso
(qemu) change cdrom /home/iso/RHEL4-U4-i386-AS-disc3.iso
(qemu) change cdrom /home/iso/RHEL4-U4-i386-AS-disc4.iso
(qemu) change cdrom /home/iso/RHEL4-U4-i386-AS-disc5.iso
(qemu) change cdrom /home/iso/RHEL4-U4-i386-AS-disc1.iso
(qemu) eject cdrom
\end{commandline}

ここでは某CDROMが5枚あるディストリビューションを例にとっていますが、
CDROMが5枚あっても、qemu モニターにてCDROMを入れ換えながらGUI操作を行う
ことで無事にインストール完了します。リブートするところでゲストOSがカーネ
ルパニックを起こしますが、そこは適当に kvm 自体を起動しなおせば問題あり
ません。

\begin{commandline}
$ kvm -hda hda  -boot c -m 512 -monitor stdio -localtime 
 -redir tcp:2222::22



\end{commandline}

\subsection{ベンチマークしてみた}

qemu を使った場合と kvm を使った場合の速度比較をしてみました。まず、ユー
ザ空間で完結する例として単純に while でループを回すだけのプログラムです。
qemu の場合は 6s かかったものが、 kvm の場合は 0.6s で完了しました。

\subsection{パフォーマンスの見えかた}

kvm を実行しているホストOSからどのように見えるのか確認してみましょう。
kvm の仕組だと、システムコールを実行して処理を行うことになるのでしょう。

\texttt{mpstat -P ALL 1} の出力を一部みてみると、一つのCPUの システム時
間がとられているように見えます。

\begin{commandline}
00時28分51秒  CPU   %user   %nice    %sys %iowait    %irq   %soft  %steal   %idle    intr/s
00時28分52秒  all    0.00    0.00   50.00    0.50    0.00    0.50    0.00   49.00   1421.78
00時28分52秒    0    0.00    0.00   92.08    0.00    0.00    0.99    0.00    6.93    430.69
00時28分52秒    1    0.00    0.00    6.93    0.99    0.00    0.00    0.00   91.09    991.09
\end{commandline}

\texttt{top}コマンドで見た場合には、kvmは通常のプロセスと同様にCPU時間を
消費し、メモリを消費しているように見えます。

\begin{commandline}
  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 3746 dancer    25   0  308m 252m 246m R   82 25.7 100:36.60 kvm
 2512 root      10  -5     0    0    0 S    0  0.0   0:11.32 kjournald
 2806 root      15   0  2556  932  804 S    0  0.1   1:09.36 syslogd
\end{commandline}

\texttt{iostat 1 /dev/dm-1 }の出力を確認してみます。
ゲストOSのディスクIOによってホストOSのディスクIOが発生しているのが見れます。

\begin{commandline}
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00   42.50   42.00    0.00   15.50

Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn
dm-1            805.94       102.97      6400.00        104       6464
\end{commandline}

\subsection{他との比較}

Xen, qemu, qemu+kqemu, openvz, vserver, user-mode-linux などと機能を比較
してみましょう。と思ったらすでにやられていたので、このURLを参照してくだ
さい。\url{http://virt.kernelnewbies.org/TechComparison}

\dancersection{次回}{}

未定です。
内容は本日決定予定です。

参加者募集はまた後程。

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.8}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule
\end{minipage}

\end{document}
