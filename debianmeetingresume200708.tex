%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2007 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200708; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2007}
\newcommand{\debmtgdate}{18}
\newcommand{\debmtgmonth}{8}
\newcommand{\debmtgnumber}{31}


\begin{document}

\begin{titlepage}

% 毎月変更する部分, 本文の末尾も修正することをわすれずに

 第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\vspace{2cm}

\begin{minipage}[t]{0.6\hsize}
\vspace{-2cm}
{\fontsize{60}{60}
{\gt
\color{dancerdarkblue}
東京エリア \\
デビアン \\
勉強会
}}
\end{minipage}
\begin{minipage}[b]{0.4\hsize}
\hspace{-1cm}\includegraphics[width=9cm]{image200502/openlogo-nd.eps}
\end{minipage}

\vspace{3cm}
\hfill{}Debian勉強会幹事 上川 純一\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{上川 純一}


今月のDebian勉強会へようこそ。
 これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
 るという方も、月に一回Debianについて語りませんか？

 目的として次の二つを考えています。

 \begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報につ
       いて情報共有する場をつくる
 \item Debianを利用する際の情報をまとめて、ある程度の塊として整理するた
       めの場をつくる
 \end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。

 Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
 情報の共有をしたい、というのが目的です。


\newpage

\begin{minipage}[b]{0.2\hsize}
 \colorbox{dancerlightblue}{\rotatebox{90}{\fontsize{80}{80} 
{\gt \color{dancerdarkblue}デビアン勉強会}}}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は
「ここ最近 Debian を使っていて ハマったこと/ちょっと感激したこと」もしく
は「apt の sources.list はこう書く」
というタイトルで200-800文字程度の文章を書いてください。というものでした。
その課題に対して下記の内容を提出いただきました。

\subsection{小室 文}

\subsubsection{ここ最近 Debian を使っていて ハマったこと/ちょっと感激したこと}

あんまりDebian特有ではないけど、Gimpってかなり使える事が判明して、結構感
動しました。元々MacでAdobe Photoshop/Illustratorを使っていたのですが、メ
インPCもDebianになったので、Gimpを使ってみようとあれこれしているうちに
Gimpってイイ！という事が判明。かなり使えるやつです。
後普通の人は知ってて当り前かもしれないけどgnome-utilsはなんかお得感一杯
(でもないけど)なパッケージでこういうのは結構小さな感動があったりします。

\subsection{根岸 心}

\subsubsection{感動したこと}

開発環境を用意しようと、家に転がっていたPentiumIIのマシンにsargeをインストールしたのが、Debianとの出会いです。本番環境も当然Debianを使おうと思って、DELLのSC430を購入した後に、etchが登場したばかりで、安定的にSC430上で動作するDebianが無いことに気づき、仕方なくCentOSを利用することにしました。その時から、開発環境はDebian、本番環境(SC430)はCentOSで運用しています。CentOSマシンが増えてしまい、etchに全面移行することに踏み切れないため、CentOSをいじっている時間が長いですが、Debianマシンに戻る度に、あるべきところにあるべきファイルがある、通っているべきパスが通っていることに感動します。


\subsection{Tsukasa Hamano}

\subsubsection{ここ最近 Debian を使っていて ハマったこと/ちょっと感激したこと}

最近自宅にオレオレaptレポジトリを作った事でお気に入りの環境が素早く構築
できるようになってちょこっと感動しました。

あと libdwarf-dev というライブラリのパッケージが sarge まであったのに
etch から無くなっていて悔しい思いをしたのですが、今日 libdw-dev という
同等のライブラリを見つけてマジで感激しました。

\subsubsection{apt の sources.list はこう書く}

\url{sources.list} はたくさん書くと update が遅くなって我慢できなくなるので

\begin{commandline}
 % m4 -DDIST=etch /etc/apt/sources.list.m4 > /etc/apt/sources.list
\end{commandline}

などと細かく分けた apt-line をその都度生成したり、symlink で切り替えた
りしていました。もっとカッコイイ方法があるんじゃないかと確信しています。

\subsection{Kouhei Maeda}

\subsubsection{ここ最近 Debian を使っていて ハマったこと/ちょっと感激し
   たこと}

テストではまって、家サーバをいまだにSargeからEtchに移行できていません。orz
久々に時間ができたので、Etchで構築したOpenBlocks266で、下記のように移行
しようと、Etchで環境作りました。

現状：Sarge\\
Apache 2.0 + mod\_php + PHP4 + PukiWiki + mod\_security 1.8

移行後の予定：Etch\\
Apache 2.2 + mod\_fcgid + PHP5 + PukiWiki + mod\_security 2.0

んで、phpinfo()はちゃんと結果を返すのに、PukiWikiでindex.phpにアクセスすると、failed
fopenでこけてしまうので、困ってしまったなぁと。
パッケージをそのまま使うのならaptitude update;aptitude
dist-upgradeでも良いのかもしれませんが、カスタマイズしている部分があるので、時間を割いて検証してみます。（いつだ？）
他のサーバもWebサーバが終わらないと検証できないので、Pending…。臆病者なので、いきなりアップグレードだなんてできません。ｗ

ところで、PukiWikiってなぜパッケージないんでしょうね。別に必要はありませんけど。


他は、クライアントとしてSidを使っていてアップデートによって環境がおかしくなってしまっても、そのまま使っていたら結構馴れてしまうんだということに気がつきました。ダメ人間です。

\subsubsection{apt の sources.list はこう書く}

とくにないです。通常と違うのは、自宅のHobbit
monitorのサーバ＆エージェントや、自宅鯖を運用するのに共通で使っているスクリプトを配布するのに、自宅のLANで立てているリポジトリを追加している程度です。

\subsection{ARAKI Yasuhiro}

\subsubsection{apt の sources.list はこう書く}
\begin{commandline}
 deb http://cdn.debian.or.jp.nyud.net:8090/debian/ sid main
\end{commandline}

と書くことがたまにあります。\url{cdn.debian.or.jp}を他に変えても日本では速くないので
意味がありませんね。。

日本にいるときは

\begin{commandline}
 deb http://cdn.debian.or.jp/debian/ sid main
 deb-src http://cdn.debian.or.jp/debian/ sid main
\end{commandline}

ですね。etchまではjavaがなかったので行追加していましたが、現在は
変なツールをいれてないのでこれで十分です。

\subsection{Hisashi MORITA}

\subsubsection{ここ最近 Debian を使っていて ハマったこと/ちょっと感激したこと}

久しぶりに新規インストールしたら、\url{/etc/default/locale}があるのに気が付か
ずはまりました。
また少し前ですが、teTeXからTeXLiveへ大きな問題なく移行できたのには感心し
ました。

\subsubsection{apt の sources.list はこう書く}

うまく書けないのでbest practiceを知りたいところです。

\subsection{XXX}

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川 純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2007年6号}
\url{http://www.debian.org/News/weekly/2007/07/}
にあるX月X日版です。

\dancersection{最近のDebian関連のミーティング報告}{上川 純一}

\subsection{東京エリアDebian勉強会30回目報告}
% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[ 	]*" "")

東京エリアDebian勉強会参加報告。7月の第30回東京エリアDebian勉強会を実施し
ました。

今回の参加者はIan Lewisさん、山本浩之さん、山根さん、小室文さん、前田耕平
さん、倉沢望さん、岩崎修さん、岩松信洋さん、noriaki satoさん、uchiyama
toru さん、北原さん、小林（王子）さん、hisashi morita さん、Charles
Plessy さん、吉田＠板橋さん、むかい？さん、野首さん（宴会だけ参加）、上川
の 18 人でした。

まず、DWNクイズを今回も実施しました。全員に起立してもらい、グー・チョキ・
パーで選択してもらいました。みんな予習しているようで今回の正解率は非常に
高く、熱戦が繰り広げられました。最後までのこった４人に豪華景品が渡されま
した。

次に先月開催されたDebconf7 について岩松さんが報告しました。これでもう参加
者のみなさまの来年のアルゼンチン開催の Debconf8に参加する準備は万端ですね。

組込みのリアルタイムについてはどうなっているのかという質問が出ました。リ
アルタイム性能についてはDebianとしては、debian-multimediaプロジェクトが中
心に推進をすすめているのですが、組込み用途でその点を重視しているものがあ
るかどうかについては不明です。Linux Kernel の標準でリアルタイム優先度のサ
ポートなどが組み込まれているのでいけるんじゃないか？という話題がでました。
状況については確認必要ですね。オーディオに関しては有用なリアルタイム性能
が、ロボット制御の場面で有用か、一概にはいえなさそうですね、という話が展
開しました。sched\_setschedulerでSCHED\_FIFOかSCHED\_RRを設定するとリアル
タイム優先度でプロセスが実行されるはずです。

最後に上川がDebconfを日本で開催するためにはどういうことをしたらよいのか、というトピックに関して、
参加者の事前課題を紹介しながら議論しました。
Debconf7の会期は一週間以上だったのですが、そんな期間どうやって仕事を休むのか、という
質問が出ましたが、今回の会社員の参加者は職場と一年前から交渉していました、ということでした。
アルゼンチンは日本からの移動に数日かかるので二週間以上は休暇をとらないといけないでしょう、
早めに調整しましょうね。

今回は宴会は時の居酒屋 刻　荻窪店にて開催しました。料理がおいしかったので
すが、たくさんたのみすぎて余りました。宴会での話では 8月は cdn の話で、9
月は exim の話になる予定です。

\dancersection{OSC-Kansai 参加報告}{山下 尊也}
\label{sec:osckansai2007}
\index{Open Source Conference}
\index{かんさいでびあん@関西Debian勉強会}
\index{debianjp@Debian JP}

\subsection{開催概要}

OSC-kansai の紹介

Debianブースの紹介・セッションの紹介

\subsection{セッション}

題目の紹介

講師の紹介

参加人数

反応

写真など

\subsection{ブース企画}

\subsubsection{リアル掲示板}

リアル掲示板の紹介。

\begin{figure}[H]
\begin{center}
  \includegraphics[width=\hsize]{image200708/real-keijiban.jpg}
\end{center}
\caption{リアル掲示板}
\label{fig:realkeiji}
\end{figure}

集まった意見は下記です。

\begin{itemize}
 \item 意見
\end{itemize}


\subsubsection{配布・販売物}

フライヤー
DVD
紹介

販売物紹介

配布量、売上紹介

\dancersection{cdn.debian.or.jpの紹介}{荒木 靖宏 (yasu@debian.or.jp, ar@debian.org)}
\label{sec:cdndebianorjp}
\index{debianjp@Debian JP}
\index{cdn.debian.or.jp}
\index{Content Delivery Network}

\subsection{CDNとは}

Content Delivery Network（CDN）はウェブコンテンツ配置および配送方法として
Akamai\index{Akamai} 社によりサービスされ広く知られることになった。当初か
ら一部の人気の高いサーバへのトラフィック集中によるサーバ停止の回避、海外
のリッチコンテンツ取得の高速化、トラフィック分散によるネットワークおよび
サーバの利用平準化などの理由で広く受け入れられた。

CDNという用語自体はWWWに限ることなく、一般にコンテンツを取得するための配
送手段や方法全体を指す場合がある。たとえば、Winny\index{Winny} や
Bittorrent\index{Bittorrent}などのコンテンツを取得するために特別に設計さ
れたプロトコルを用いて、P2Pネットワークを構成するような手法も含まれる。

\subsection{DebianにおけるCDNの現状}
\subsubsection{利用法とユーザから見た動作}

\url{cdn.debian.or.jp}ではDebianでインストール時から広くdebファイルの入手に使
われるaptで使えるCDNとして設計し、運用している。そのため、Debianにおける
CDNの利用法は至極簡単である。\url{/etc/apt/source.list} に記述するAPT リポジト
リとして、

\begin{commandline}
 deb http://cdn.debian.or.jp/debian/ stable main contrib non-free
 deb-src http://cdn.debian.or.jp/debian/ stable main contrib non-free
\end{commandline}

以上のように指定するだけでユーザは今までとなんら変わることなくaptコマンド
を使用できる。サービス時の手順と構成は以下のようになる。
（\fgref{fig:usercdndebianorjp}）

\begin{enumerate}
 \item  ユーザがapt-get コマンドを行うとcdn.debian.or.jpをDNSで問い合わせる
 \item  \url{cdn.debian.or.jp}を管理するDNSはサーバ候補(surrogate)選択する
 \item  選択結果をDNSのリプライとして返す
 \item  aptは\url{cdn.debian.or.jp}としてSurrogate Cを使用する
\end{enumerate}

\begin{figure}[H]
\includegraphics[width=\hsize]{image200708/surrogate.png}

 \caption{ユーザから見たcdn.debian.or.jpの動作}
 \label{fig:usercdndebianorjp}
\end{figure}

\subsubsection{cdn.debian.or.jpのシステムと動作}
CDNシステムが完全に動作しユーザから使用されるためには、システムが完全な
ファイルを提供すること、システムが安定して動作すること、そしてCDNを使っ
た場合に高速に動作していることが求められる。

\subsubsubsection{提供ファイルの完全性}

このために以下二点を満たさねばならない。
\begin{itemize}
 \item  個々のファイルがコンテンツ提供者たるdebファイル配布元と同一であること
 \item  apt-get updateの結果取得するファイル群がどのSurrogateでも入手できること
\end{itemize}
前者については、debはそのファイルのmd5値、sha1値とともに配布され、ユーザ
が使用するaptで確認後に利用されるためCDNを使用した場合でも問題にならない。

後者についてはユーザがapt-get updateを行ったときに接続するSurrogateと
apt-get dist-upgradeを行ったときに接続するSurrogateは同一であるとは限らな
いため、DNSがSurrogateとして返すサーバが保持するファイルは同一である必要
がある。\url{cdn.debian.or.jp}ではDebianプロジェクトで一般に行われている
方法と同様に、rsyncプロトコルを用い、pushミラーを行っている（図２）。その
ため、\url{cdn.debian.or.jp}のサロゲート内で最上流にあるサーバとミラーが
同一であることを2分毎にrsyncミラー終了時に作成されるスタンプファイルを確
認して、同一でないサーバはサロゲート候補から一時的に除外している。

\begin{figure}[H]
\includegraphics[width=\hsize]{image200708/pushmirror.png}
 \caption{Debianサロゲートのrsyncによるミラー}
 \label{fig:rsyncsurrogatemirror}
\end{figure}

\subsubsubsection{システムの安定動作}
先に述べたように、ユーザはCDNを使用する際にはDNSを最初に使用するため、
DNSの安定運用がカギとなる。そのため、\url{cdn.debian.or.jp}を管理するDNSサーバ
はまったく独立に動作するサーバで行っている。

また、サーバの動作を確認は、5秒以内にHTTPのレスポンスを返さないサーバは
サロゲート候補から一時的に除外している。

\subsubsubsection{高速動作}
\url{cdn.debian.or.jp}ではDNSで問い合わせされるとサロゲートリストとして複数の
IPアドレスを返す。このIPアドレスはラウンドロビンで選択しているわけではな
く、サーバキャパシティやネットワーク速度を考慮し、設定している。

\subsection{将来の展望}

ここまで説明してきた、\url{cdn.debian.or.jp}の動作には改善すべき点が多数存在す
る。改善の展望としていくつか挙げる。

\subsection{apt-getコマンドのHTTP REDIRECT}
apt-getコマンドはHTTP REDIRECTに対応していない。

HTTP REDIRECTは、いったんHTTP GETなどで接続してきたクライアントに対して、
新たにそのリソースが存在するURLを通知するものである。この仕組みをうまく
つかったCDNとして、Coral Content Distribution Network (Coral CDN)がある。
Coral CDNはサロゲート間でP2Pによるファイル配置し、そのインターフェースと
して、HTTPを使用し、しかも使用にはインターネットから取得可能なファイルで
あれば制限をかけていない。さらに、Apacheを使った一時配布サーバではHTTP
REDIRECTをつかってCoral　CDNに誘導することも推奨されている。ただし、現状
で、Coral CDNを使うために、

\begin{commandline}
 deb http://cdn.debian.or.jp.nyud.net:8090/debian/ stable main contrib non-free
\end{commandline}
を指定することも可能だが、少なくとも日本においてはCoral CDNを担うサロゲー
トが存在しないこともあって非常に低速である。ただし韓国や中国では広くつか
われており、将来の拡張に使用したい。

\subsubsection{IPアドレスの位置情報を使用したサーバ選択}

globalにCDNを展開する場合には地理的に近いサーバ群からある程度絞込むのが
有効である。現在、GeoIPなど無料でIPと地理情報のマッピング提供者が現れて
おり、この活用は\url{cdn.debian.or.jp}の次の拡張として最有力だと考えている。

\subsubsection{aptのP2P対応}

現在、\url{http://wiki.debian.org/DebTorrent} や
\url{http://www.cs.sfu.ca/~camerond/personal/GoogleSoCDebian.html}でaptの
Bittorrent対応が進められており、有力な候補である。ただし、Bittorrentプロ
トコルをクライアントで直接使うものであり、ネットワーク利用ポリシーとの競
合やinstall時に利用可能なのかなど今後検証すべき問題も多い。


\subsection{おわりに}

いつでも必要なソフトウェアやコンテンツを安価に入手する手段としてCDNはこ
れからも様々な発展を続けると考える。Debianはdebの安定入手手段の有無がシ
ステムの信頼性を左右するシステムであり、CDNの広範な活用が今後ますます求
められるようになると考える。

\dancersection{今後の予定}{上川 純一}

\subsection{次回}
次回は9月15日に東京エリアDebian勉強会があります。

\subsection{OSC Tokyo/Fall}

10月5日・6日に開催されます。Debian JP も参加するのであれば準備を検討する
必要があります。

\printindex

\cleartooddpage

\begin{minipage}[b]{0.2\hsize}
 \colorbox{dancerlightblue}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}

\vspace*{15cm}
{\color{dancerlightblue}\rule{\hsize}{1mm}}
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
{\color{dancerdarkblue}\rule{\hsize}{1mm}}
\end{minipage}

\end{document}
