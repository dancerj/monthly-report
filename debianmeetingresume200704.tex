%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2007 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "xpdf " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200704; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage[dvipdfm]{graphicx}
\usepackage{fancybox}
\usepackage{longtable}
\usepackage{ascmac}	% 囲み (screen,itembox)
\usepackage{fancyvrb}   % 囲み Verbatim のために必要
\usepackage[dvipdfm]{hyperref}
\usepackage{url}
\usepackage[dvipdfm]{color}
\usepackage{nextpage}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2007}
\newcommand{\debmtgdate}{21}
\newcommand{\debmtgmonth}{4}
\newcommand{\debmtgnumber}{27}

%http://www.naney.org/diki/dk/hyperref.html
%日本語EUC系環境の時
\AtBeginDvi{\special{pdf:tounicode EUC-UCS2}}
%シフトJIS系環境の時
%\AtBeginDvi{\special{pdf:tounicode 90ms-RKSJ-UCS2}}

%% spacing の設定をする。外枠を減らす。
\setlength\headheight{0mm}
\setlength\topmargin{-20mm}
\setlength\headsep{0mm}
\setlength\topskip{3mm}
\setlength\maxdepth{4pt}
\setlength\columnsep{6mm}
\setlength\textheight{252mm}
\setlength\topmargin{-5mm}
\setlength\textwidth{170mm}
\setlength\oddsidemargin{-5mm}
\setlength\evensidemargin{-5mm}

% commandline環境を定義。画面入出力についてはcommandline環境
% で表記する
\newenvironment{commandline}%
{\VerbatimEnvironment
  \begin{Sbox}\begin{minipage}{15cm}\begin{fontsize}{7.3}{7.3} \begin{BVerbatim}}%
{\end{BVerbatim}\end{fontsize}\end{minipage}\end{Sbox}
  \setlength{\fboxsep}{8pt}\begin{itembox}[c]{出力}{\TheSbox}\end{itembox}}


%%% start of santaku
\makeatletter
\newwrite\tf@jqz
\immediate\openout\tf@jqz\jobname.jqz\relax
\makeatother
\newcounter{santakucounter}
\newcommand{\santaku}[5]{%
\addtocounter{santakucounter}{1}

\addtocontents{jqz}{\arabic{santakucounter}. #5\\}
\begin{minipage}{1\hsize}
問題\arabic{santakucounter}. 
#1\\
□ A #2\\
□ B #3\\
□ C #4
\end{minipage}
\hspace{1cm}
\\

}
%%% end of santaku

\newcommand{\emptyspace}{(\underline{\hspace{1cm}})}

\newcommand{\subsubsubsection}[1]{%
\vspace{1zw}{\bf #1}\\}


% sectionをセンタリングする
\makeatletter
  \renewcommand{\section}{\@startsection{section}{1}{\z@}%
    {\Cvs \@plus.5\Cdp \@minus.2\Cdp}% 前アキ
    {.5\Cvs \@plus.3\Cdp}% 後アキ
    {\normalfont\gt\fontsize{32}{32}\headfont\raggedright}} % style
\makeatother

% section の代わりの環境
\newcommand{\dancersection}[2]{%
\newpage
第\debmtgnumber{}回 東京エリアDebian勉強会 \debmtgyear{}年\debmtgmonth{}月
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{4cm}
\hrule
\vspace{0.5mm}
\hrule
%
\vspace{-7cm}
\begin{minipage}[b]{0.7\hsize}
\section{#1}
\hfill{}#2\\
\vspace{2cm}
\end{minipage}
\begin{minipage}[b]{0.3\hsize}
\hfill{}\includegraphics[height=8cm]{image200502/openlogo-nd.eps}\\
\end{minipage}
%
%\hfill{}\includegraphics[width=16cm]{image2006-natsu/guruguru-sand-light.png}\\
\vspace{-1cm}
}

% BTSの番号を見るためのコマンド
\newcommand{\debianbug}[1]{Bug\##1\footnote{\url{http://bugs.debian.org/#1}}}

% for dancerj
\newcommand{\fgref}[1]{図\ref{#1}}
\newcommand{\tbref}[1]{表\ref{#1}}

\begin{document}


\begin{titlepage}

 第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\vspace{2cm}

\begin{minipage}[t]{0.6\hsize}
\vspace{-2cm}
{\fontsize{60}{60}
{\gt
東京エリア \\
デビアン \\
勉強会
}}
\end{minipage}
\begin{minipage}[b]{0.4\hsize}
\hspace{-1cm}\includegraphics[width=9cm]{image200502/openlogo-nd.eps}
\end{minipage}

\vspace{3cm}
\hfill{}Debian勉強会幹事 上川純一\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\thispagestyle{empty}
\end{titlepage}

\dancersection{Introduction}{上川純一}
 
 今月のDebian勉強会へようこそ。
 これからDebianのあやしい世界に入るという方も、すでにどっぷりとつかってい
 るという方も、月に一回Debianについて語りませんか？

 目的として次の二つを考えています。

 \begin{itemize}
 \item メールではよみとれない、もしくはよみとってられないような情報につ
       いて情報共有する場をつくる
 \item Debianを利用する際の情報をまとめて、ある程度の塊として整理するた
       めの場をつくる
 \end{itemize}

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。

 Debianをこれからどうするという能動的な展開への土台としての空間を提供し、
 情報の共有をしたい、というのが目的です。


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川純一}

今回の事前課題は
「私はバージョン管理システムをこのようにつかっています」もしくは「バージョン管理システムを使わなくてすむようにこのようにしています」
というタイトルで200-800文字程度の文章を書いてください。というものでした。
その課題に対して下記の内容を提出いただきました。

\subsection{青木さん}

VCSはCVSとSVNを使っていますが、あまり複雑なパッチ管理ではなく
単に共同開発の最新版管理レベルです。それとバックアップ的な意
味合いで使います。ハンドマージより凝ったことといえばVIMDIFの
利用ぐらいがせいぜいです。タグ管理はとくいではないです。DVCS
をつかうべきかと思いつつ、勉強不足ですね。

\subsection{上川}

%%% trivia quiz
\dancersection{Debian Weekly News trivia quiz}{上川純一}

ところで、Debian Weekly News (DWN)は読んでいますか？
Debian 界隈でおきていることについて書いているDebian Weekly News.
毎回読んでいるといろいろと分かって来ますが、一人で読んでいても、解説が少
ないので、
意味がわからないところもあるかも知れません。みんなでDWNを読んでみましょう。

漫然と読むだけではおもしろくないので、DWNの記事から出題した以下の質問にこたえてみてください。
後で内容は解説します。

\subsection{2007年04号}
\url{http://www.debian.org/News/weekly/2007/04/}
にある3月13日版です。

\santaku
{ウェブアプリケーション関連のパッケージの静的コンテンツはどこにおくべきか？}
{/var/www に置く}
{/usr/share/PACKAGE に置く}
{/srv/XXX に置く}
{B}


\santaku
{Debian Projectの MIA アカウントにたいして　実施するWaTとは何をするもの
か}
{今年のDPL選挙に投票しなかった人にたいして確認メールを送り反応がない人を引退プロセスに以降する}
{気に入らない人を強制退会させる}
{あれ？Debian Developerだらけの水泳大会}
{A}


\santaku
{etch リリースはどういう暗号鍵で署名されるか？}
{オンライン鍵とオフライン鍵}
{オフライン鍵のみ}
{オンライン鍵のみ}
{A}

% オンライン鍵は、ネットワーク上にオンラインになっている鍵で、自動処理
%するためにパスフレーズすらない。



\santaku
{etch リリースはどういう暗号鍵で署名されるか？}
{オンライン鍵とオフライン鍵}
{オフライン鍵のみ}
{オンライン鍵のみ}
{A}

\santaku
{Frans PopがアナウンスしたBabelboxは何をするものか？}
{いろいろな言葉を喋ってくれる}
{フォントを複数表示}
{自動でくりかえし Debian Installer が稼働し、Gnomeにしばらくログインしてくれるしく
み}
{C}

\santaku
{DPL選挙の勝者は？}
{Iwamatsu}
{Sam Hocevar}
{Anthony Towns}
{B}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}

\subsection{東京エリアDebian勉強会25回目報告}
% (query-replace-regexp "<.*>" "")


東京エリアDebian勉強会報告。2月の第25回Debian勉強会を実施しました。今回
は初の小林さんが幹事の会の予定でしたが、小林さんがたおれてしまったので、
代理開催です。

今回の参加人数は13人でした。あけどさん、小室さん、岩松さん、えとーさん、
上川、吉田さん＠板橋、Henrichさん、前田さん、石原さん、David Smithさん、
澤田さん、キタハラさん、吉田さん（女性）でした。

上川が最近の事情の紹介、事前課題の紹介をしました。「apt に足りない機能」
という話題では、非常に盛り上がりました。インストールする前に changelog 
や README や manpage を表示するためのインタフェースや、google　と連携し
てパッケージをインストールできるようにするインタフェースなどがあるといい
ね、という話題が出ました。また、ユーザのホームディレクトリにインストール
したパッケージもシステム全体の観点から管理できるとよいねという話題も出ま
した。

DWNクイズはひさしぶりにDWNが頻繁にリリースされたので、１１問ありました。
みなさまのDebianについての常識を問いました。よい感じですね。

dbs について岩松さんが紹介しました。
dpatch, quilt によって置き換えられつつあるdbsですが、まだ使っているところもあるので抑えておく必要があります。
癖のあるツールですが、この話を聞いてもうみなさん大丈夫ですよね。

そして、上川がdpatch について話をしました。ツールがどういう使い方になる
のか、ということと、一つ dbs 風にも使えるのだ、という事例を紹介しました。

最後に、OSCでの出し物に付いて議論しました。仮想化については、みなさんす
でに活用しまくっているようで、おもしろい話がきけました。Debianユーザじゃ
ない人たちもくるだろうけど、そういう場合にはWindowsからDebianに安心して
乗り換えてもらえるようにgoodbye-microsoft.com を紹介しましょう、という話
をしました。仮想化の使い道としておもしろいものとして、年賀状、EDYチャー
ジ、winny、試験用（教育）などの事例が出てきました。

\subsection{東京エリアDebian勉強会26回目報告}
% (query-replace-regexp "<.*>" "")

オープンソースカンファレンス(OSC)への仮想化友の会と、東京エリアDebian勉
強会参加報告。3月の第26回Debian勉強会を実施しました。今回は仮想化友の会
と共催でOSCの会場で開催します。

今回の参加人数は80人程度でした。

セミナー会場でのオープニングは仮想化友の会の紹介を平さん、Debian勉強会の
紹介を上川がしました。これでみんな勉強会に参加できるようになったと思いま
す。よろしくおねがいします。

事前課題の声を紹介しました。今回の課題は「仮想化を実際にこういう利用方法
で活用しています」でした。さまざまなおもしろい実用例を紹介しました。会場
でもそういう使いかたしている、という声が聞こえてきました。別のアーキテク
チャのエミュレータを活用して開発だとかカーネルの開発に利用しているという
声はあまり聞こえずその利用方法はまだマイナーなようです。

今回はDebian weekly news クイズではなく、「仮想化常識クイズ」を実施しま
した。全員起立願い、クイズの回答を「グー」「チョキ」「パー」で答えてもら
い、正解した人だけのこるという形式でやりました。でんさんが最後まで正解し
ました。おめでとうございます。

山根さんが「Windowsから見える仮想化世界」の紹介をしてくれました。仮想化
技術の現状を紹介、でもWindowsを使うよりも goodbye-microsoft.com を利用し
て Debian をインストールしたほうがよいよ、という紹介でした。Debian勉強会
の趣旨に沿った素晴らしい発表です。

今回のメイントピックとして、前田さんにKVMとの出会いと活用について語って
いただきました。各種OSを稼働したりした例を紹介しました。

その後はどんどんマニアックな内容に突入します。平さんが「私はこれで○○を
辞めました」という発表をしました。素敵な内容でした。

KVMの利用例の紹介として、上川が「KVMでgoodbye-microsoft.comを試す」
「PaSoRiを試す」実演をしました。

平さんが最後にKVMのソースを読んで解析してみるネタを披露しました。これで
もうみんなKVMの起動部分についてハックできるようになったはず。

仮想化友の会とDebian勉強会はブースもかまえていました。ミニセミナーで、山
根さんが自分でパッケージングしたソフトウェアの利用方法を紹介するべく、
「2chリーダーJDの使いかた実演」をしました。

上川が「realcsh, realksh」の紹介をしました。プレゼンテーションは、
realksh で　「panic()」するところで終了しました。

懇親会はイタリアンカフェで。あと、一部でベトナム料理を食べにいきました。
ふー、長い一日でした。

\includegraphics{image200704/DSCF0063.jpg}
\includegraphics{image200704/DSCF0064.jpg}

\dancersection{darcs 使いかた}{David Smith}
\label{sec:darcs}

\dancersection{git-buildpackage の使いかた}{上川}
\label{sec:git}

git はソースコードを管理するためのツールです。ソースコード管理のツール、
もしくはバージョン管理ツールと呼ばれ、VCSやSCMなどと略称されるツールのひ
とつです。また、旧来のCVS、SVNなどの集中モデルのSCM と違い分散モデルを採
用しているため、分散SCM(DSCM)と呼ばれます。 そのgitを利用してDebianのパッ
ケージを管理するための仕組が git-buildpackage です。

git-buildpackage 利用の詳細に入る前に、基本的な git の利用方
法を紹介します。

\subsection{git超入門}

\subsubsection{git 関連用語}

まず、この文書で利用する用語を定義します。

\begin{tabular}{|l|p{30em}|}
\hline
\hline
用語 & 定義 \\
\hline
 ワーキングツリー & SCMで管理されている作業ディレクトリで、ユーザの作業
 対象\\
\hline
 ローカルレポジトリ & SCMで管理されているデータ
 ワーキングツリーと同じ場所の
 .git ディレクトリに実体がある。直接編集できない\\
\hline
 リモートレポジトリ & SCM管理されているデータで、
 ネットワーク上のどこかに存在し
 ているもの。しばしば他人と共有している。直接編集できない\\
\hline
 コミット & ワーキングツリーからローカルレポジトリに情報を反映すること\\
\hline
 プッシュ & ローカルレポジトリからリモートレポジトリに情報を反映するこ
 と\\
\hline
 プル & リモートレポジトリからローカルレポジトリとワーキングツリーに情報を反映するこ
 と\\
\hline
\hline
\end{tabular}

\includegraphics[width=0.8\hsize]{image200704/git-repos.eps}

\subsubsection{git でよく使うコマンド}

git\footnote{Debian では {\tt apt-get install git-core} でインストールで
きる} は多数のコマンドラインのプログラムで構成されています。git でよく使
うコマンドを解説します。git には多数コマンドがあるのですが、毎日のオペレー
ションに必要なもの、特に既存の別の SCM から移行してきた場合にいままで行っ
てきたことと同じことをするために必要なものというのはそれほど多くありませ
ん。

\begin{tabular}{|l|l|p{15em}|l|}
\hline
\hline
コマンド名 &例 &意味 & cvs 相当\\
\hline
git-clone & git-clone {\it git://XXX/YYY} & 
 リモートレポジトリをローカルにクローンし、ワーキングツリーをチェックアウトする & cvs login, cvs co \\
\hline
git-init-db & git-init-db &
 ローカルレポジトリ(.gitディレクトリ)を作成する & cvs init\\
\hline
git-pull & git-pull {\it git://XXX/YYY} &
 リモートレポジトリの変更をローカルにマージし、ワーキングツリーを
 アップデートする & cvs up \\
\hline
git-commit & git-commit -a -m 'xxx' & 
 ローカルレポジトリに変更をコミットする & cvs ci の前半\\
\hline
git-push & git-push {\it git://XXX/YYY} & 
 ローカルレポジトリをリモートレポジトリに送信する & cvs ci の後半\\ 
\hline
git-add & git-add {\it filename}&
 ファイルを次回コミットの際にローカルレポジトリに追加されるように登録す
 る & cvs add \\
\hline
git-rm & git-rm {\it filename} & 
 ファイルを次回コミットの際にローカルレポジトリから削除されるように登録す
 る & cvs remove \\
\hline
git-status & git-status & 
 ローカルレポジトリにたいしてワーキングツリーの状況を確認する &
 cvs status\\
\hline
git-diff & git-diff & ローカルレポジトリとワーキングツリーの差分を
 表示する & cvs diff\\
\hline
\hline
\end{tabular}

\subsubsection{よくある作業の流れ}

\begin{minipage}{0.5\hsize}
よくある作業の例を紹介します。

まず、新しくレポジトリをつくるのであれば、git-init-db でレポジトリを作成
し、ファイルをgit-add, git-commit で追加します。そうでなければ、既存のリ
モートにあるレポジトリを git-clone で複製します。これで、作業可能なワー
キングディレクトリができ、 .git ディレクトリにはローカルのレポジトリが作
成されました。

ワーキングツリーでファイルを編集して、git-commit でレポジトリに反
映します。削除・追加がある場合には、git-add/git-rmコマンドを利用します。
通常は、何がコミットされるのか、を git-status コマンドで確認し、ファイル
を指定してコミットすることになるでしょう。git-diff コマンドでこれからコ
ミットする予定の差分を確認することもできます。

リモートのレポジトリと同期するため、まずリモートから git-pull で最新の情
報を取得します。ここでコンフリクトがあれば修正し、git-commit します。
問題ないようであれば、git-push でリモートに送信します。
\end{minipage}
\begin{minipage}{0.5\hsize}
\includegraphics[width=1\hsize]{image200704/git-work.eps}
\end{minipage}

\subsubsection{qgitでの表示例}

\begin{minipage}[b]{0.5\hsize}
git の履歴情報などを見るのには、視覚的にわかりやすい Qt の GUI である 
 qgit\footnote{apt-get install qgit でインストール可能} を利用すると履歴
 や差分が見れて便利です。GUIが利用できない環境では、git-whatchanged コマ
 ンドなどを利用すればよいでしょう。他のGUIとして git-gui \footnote{旧
 gitkがgit-gui にリネームされた, apt-get install git-gui でインストール
 可能}があります。
\end{minipage}
\begin{minipage}[c]{0.5\hsize}
\includegraphics[width=0.8\hsize]{image200704/qgit.png}
\end{minipage}

\subsection{git-buildpackage の流れ}

git-buildpackage\footnote{apt-get install git-buildpackage でインストー
ル可能} を利用した場合のパッケージングの流れを紹介します。前提として、 
upstream では謎の利用不可能なSCMを利用して開発をすすめており、Debian
Developerはリリース毎に出てくる tar-ball しか利用できないものとします。

\includegraphics[width=1\hsize]{image200704/git-buildpackage.eps}

\subsubsection{git-import-dsc}

まず、Debian Developerはアップストリームの tarball を展開し、
そこで dh\_{}makeを実行し、一連のパッケージング作業を行います。

\begin{commandline}
$ tar xfz vvv-0.1.tar.gz
$ cd vvv-0.1
$ dh_make -f  ../vvv-0.1.tar.gz
[編集]
$ debuild -us -uc 
\end{commandline}

すると、Debianのソースパッケージファイルなどができます。

git-import-dsc は dsc ファイルをオプションにとると、[パッケージ名]ディレ
クトリを作成し、その中に git レポジトリを作成し、upstream と master ブラ
ンチ(通常利用するブランチ)を作成し、upstreamにアップストリームのツリーを
入れ、master に debian への改変を加えた後のツリーを入れます。この状態で、
git-buildpackage などでパッケージがビルドできる状態になっています。

\begin{commandline}
$ git-import-dsc ~/DEBIAN/refit/refit_0.7-1*dsc
Upstream version: 0.7
Debian version: 1
Initialized empty Git repository in .git/
Created initial commit 4413eb297e527ff60ba2a3f8543f62b4b18c5a22
 51 files changed, 9935 insertions(+), 0 deletions(-)
 create mode 100644 BUILDING.txt
[中略]
 create mode 100644 refitl/refitl.mak
dpkg-source: warning: extracting unsigned source package (/home/dancer/DEBIAN/refit/refit_0.7-1.dsc)
dpkg-source: extracting refit in /tmp/tmpnq9f4P/unpack/refit-0.7-1
dpkg-source: unpacking refit_0.7.orig.tar.gz
dpkg-source: applying /home/dancer/DEBIAN/refit/refit_0.7-1.diff.gz
 VCSCMD:  git
LOGTEXT Imported refit-0.7-1
into Git repository

Created commit 3a625531f37522ef3be84c6e113b2f670905ffff
 13 files changed, 317 insertions(+), 0 deletions(-)
 create mode 100644 debian/README.Debian
[中略]
 create mode 100755 debian/rules
\end{commandline}

\subsubsection{git-import-orig}

新しいアップストリームのバージョンがリリースされた場合には、
git-import-dsc で作成されたディレクトリの中で git-import-orig コマンドを
実行して、gitレポジトリにインポートします。

\begin{commandline}
$ git-import-orig ~/DEBIAN/refit/refit_0.8.orig.tar.gz 
\end{commandline}

この操作により、upstream ブランチに新しいバージョンがインポートされ、
master ブランチに変更がマージされ、適切なタグが作成されます。

\subsubsection{git-buildpackage}

各種編集を行い、コミットを完了したら、git-buildpackage を実行し、レポジ
トリの内容から Debian パッケージを作成します。--git-tag オプションを付け
ておくとビルドしなおしたら適切なタグを自動でつけてくれるので便利です。

\begin{commandline}
$ git-buildpackage -us -uc --git-tag
\end{commandline}

\subsection{アップストリームが git で管理している場合}

別のシナリオを考えてみます。アップストリームが git で管理している場合に
直接 git を利用したワークフローは幾分か簡単にできます。
どちらがよいかはわかりませんが、参考までに掲載します。

git-clone したらローカルレポジトリはリモートレポジトリから見たらブランチ
となってしまうので、ローカルレポジトリで変更を加えていれば、
git-pull するたびにアップストリームの変更をマージすることになります。
ビルドする際には、debuild などを直接使えばよいでしょう。ただ、
この場合は自動でタグをつけたりはしてくれません。

\begin{commandline}
 debuild -us -uc -i -I 
\end{commandline}

\includegraphics[width=1\hsize]{image200704/git-clone.eps}

\dancersection{git の実装技術的解説}{上川}

簡単にgit のレポジトリのコンセプトを紹介します。レポジトリのファイルは 
.git ディレクトリ以下\footnote{もしくは環境変数 GIT\_{}DIR で指定された
場所}にあります。基本的なオブジェクトは commit, tree, blob の三種類があ
ります。.  git/objects/ 以下にファイルはgzip 圧縮された状態で保存されて
います。.  git/HEAD (最近は .git/refs/heads/master) に最新の commit のハッ
シュ（ハッシュはデータのsha1sumをとることで取得している）が記録されてい
ます。commit の中身を見ると、tree のハッシュと 親 commit とコミットメッ
セージ情報が含まれています。treeを見ると、そのコミットのときのディレクト
リ情報が含まれており、それぞれのファイル実体（blob）の hash 値が含まれて
います。

なお、objects はばらばらで管理されるとディスクの利用効率が悪いので
git-repackコマンドを利用して pack 形式で保存されることが多いです。そうな
ると、.git/objects/pack に保存されます。

\includegraphics[width=0.38\hsize]{image200704/git-filesystem-concept.eps}
\includegraphics[width=0.5\hsize]{image200704/git-filesystem-concept2.eps}

この情報を具体的にコマンドラインで確認してみた例を例示します。特に重要な
点は、'head'ファイルへの書き込みというOS観点ではアトミックに実装できるオ
ペレーションでコミットが実現されているということでしょう。\footnote{ファ
イルの SHA-1 ハッシュ値の衝突が発生しないということが前提です。ただ、現実的
に問題になることは無いでしょう。}

\begin{commandline}
[11:39:25]dancer64:pbuilder> cat .git/refs/heads/master
49f6dfe1a4270e47e3547326e23cc88895d0e05d
[11:39:38]dancer64:pbuilder> git-cat-file -t 49f6dfe1a4270e47e3547326e23cc88895d0e05d
commit
[11:39:44]dancer64:pbuilder> git-cat-file commit 49f6dfe1a4270e47e3547326e23cc88895d0e05d
tree 98dc4f51c0ae895607db43f8b617a7cacfbdc34b
parent e40c851b3017b09a609e2e36af6ae8a20b8ffff3
author Junichi Uekawa <dancer@dancer64.netfort.gr.jp> 1176588357 +0900
committer Junichi Uekawa <dancer@dancer64.netfort.gr.jp> 1176588357 +0900

do not build pbuilder-uml for amd64
currently i386 is the only arch in Debian that supports user-mode-linux
[11:39:47]dancer64:pbuilder> git-cat-file -t 98dc4f51c0ae895607db43f8b617a7cacfbdc34b
tree
[11:39:52]dancer64:pbuilder> git-cat-file tree 98dc4f51c0ae895607db43f8b617a7cacfbdc34b|strings|head -5
100644 .cvsignore
100644 .gitignore
100644 AUTHORS
o[v'a
R100644 COPYING
[11:40:13]dancer64:pbuilder> git-ls-tree 98dc4f51c0ae895607db43f8b617a7cacfbdc34b|head -5
100644 blob 99ee691a57a1d79999965e8f9362da79d18e8ce4    .cvsignore
100644 blob e4e5f6c8b2deb54bf38312dd9e2f53489b60d6a6    .gitignore
100644 blob 30ded29ac4176f5b7627618b27a8cb15c7ea0a52    AUTHORS
100644 blob b7b5f53df1412df1e117607f18385b39004cdaa2    COPYING
100644 blob 97cae37dd0355d4f29837bc02bbad4bcdba98914    ChangeLog
[11:40:18]dancer64:pbuilder> git-cat-file -t 97cae37dd0355d4f29837bc02bbad4bcdba98914
blob
[11:40:36]dancer64:pbuilder> git-cat-file blob 97cae37dd0355d4f29837bc02bbad4bcdba98914|head
2007-04-11  Junichi Uekawa  <dancer@debian.org>

        * AUTHORS, etc: remove $Id$, which is CVS specific

2007-04-10  Junichi Uekawa  <dancer@debian.org>

        * Documentation/pbuilder-doc.xml: update documentation

        * pbuilder-modules: say lenny instead of sarge

[11:40:43]dancer64:pbuilder> ls .git/objects/97/cae37dd0355d4f29837bc02bbad4bcdba98914
.git/objects/97/cae37dd0355d4f29837bc02bbad4bcdba98914
[11:40:58]dancer64:pbuilder> ls -l .git/objects/97/cae37dd0355d4f29837bc02bbad4bcdba98914
-r--r--r-- 1 dancer dancer 27255 2007-04-11 09:01 .git/objects/97/cae37dd0355d4f29837bc02bbad4bcdba98914
\end{commandline}

\dancersection{git の実行速度をベンチマークしてみる}{上川}
\label{sec:gitbench}

git　がどれくらい高速なのか調べるために、1kB のファイル 100 個が毎回変更
されるようなケースを100コミット分するのにどれくらいの時間がかかるのか計
測してみました。

\begin{commandline}
git-init 
for A in $(seq 1 100); do touch test$A; done
git-add test*
time ( for A in $(seq 1 100); do for A in $(seq 1 100); do 
 dd if=/dev/urandom of=test$A bs=1024 count=1 ; 
 done ; 
 git-commit -a -m 'commit' ; done )
\end{commandline}

この処理に1分34秒程度かかりました。

さて、それでは、Mercurial の場合はどうでしょうか。
同じようなケースを考えて試験してみました。

\begin{commandline}
hg init 
for A in $(seq 1 100); do touch test$A; done
hg add test*
time ( for A in $(seq 1 100); do for A in $(seq 1 100); do 
 dd if=/dev/urandom of=test$A bs=1024 count=1 ; 
 done ; 
 hg commit -m 'commit' ; done )
\end{commandline}

この処理に1分20秒程度。
同じマシン上の同じような条件で試験した結果、Mercurialのほうがはやいようで
す。

また、データ容量を比較してみると、内容の差が明確になります。gitはデフォ
ルトではそのまま圧縮データを別のブロックに保存するため、mercurial のよう
に差分のみを保持するのに比べると不利です。ただし、gitにも repack コマン
ドがあり、 Mercurial 風のデータを保持することができます。そうするとあま
り差がないことがわかりますね。

\begin{tabular}{|c|c|}
\hline
 コマンド & サイズ (du -s) \\
\hline
 git& 41284\\
 hg& 9196\\
 git(git-repack -a -d 後)& 10836\\
\hline
\end{tabular}


\dancersection{今後の計画}{}

\begin{itemize}
 \item 5月：
 \item 6月：スコットランドで開催
 \item 7月：
 \item 8月：
 \item 8月：
 \item 8月：
 \item 8月：
 \item 12月：反省会
\end{itemize}

\cleartooddpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule
\end{minipage}

\end{document}
