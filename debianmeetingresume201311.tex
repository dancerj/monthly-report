%; whizzy chapter　-dvi
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2011 Nobuhiro Iwamatsu

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201307; ebb *.jpg")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2013}
\newcommand{\debmtgmonth}{11}
\newcommand{\debmtgdate}{16}
% started from zero:
% (let ((year 2013) (month 7)) (+ (* (- year 2005) 12) month -1))
\newcommand{\debmtgnumber}{106}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics{image2012-natsu/dotdeb.pdf}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
% 全角文字にしないとフォントのサイズが合わないので注意
\rotatebox{10}{\fontsize{32}{32} {\gt 特集１： ｗａｙｌａｎｄをうごかす}}

\rotatebox{10}{\fontsize{32}{32} {\gt 特集２： モバイル環境構築}}

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:
\begin{enumerate}
 \item 自分では vpn をどう利用していますか？
\end{enumerate}
この課題に対して提出いただいた内容は以下です。
\begin{multicols}{2}
{\small
 \input{image201308/prework.tex}
}
\end{multicols}

\dancersection{Debian Trivia Quiz}{上川純一}

ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
いところもあるかも知れません。みんなで一緒に読んでみましょう。

今回の出題範囲は\url{debian-devel-announce@lists.debian.org} や \url{debian-devel@lists.debian.org}に投稿された
内容とDebian Project Newsからです。

\begin{multicols}{2}
 \input{image201308/quiz.tex}
\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}
\subsection{東京エリアDebian勉強会103回目報告}

\subsection{OSC 東京/Fall}


% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

%-------------------------------------------------------------------------------
\dancersection{wayland}{}
%-------------------------------------------------------------------------------
\index{wayland}

%-------------------------------------------------------------------------------
\dancersection{tramp入門}{上川純一}
%-------------------------------------------------------------------------------
\index{tramp}

\subsection{emacsでリモートファイル編集するTrampのすすめ}

リモートサーバでファイルの編集はどうしていますか？moshを使っている？
sshfsを使っている？いろいろあると思いますがmoshを使うとローカルのファイル
と扱いが変わってしまい、リモートのviだったりemacsを使って編集することにな
り、設定の同期がほぼ不可能になります。一方sshfsだとローカルファイルのよう
に扱うことができるのですが、rootなどの別のユーザ（root?）としてファイルの
編集ができにくかったりしますし、リモートホストでコマンドを実行しようとす
ると別途sshでログインして作業することになり、sshセッションをひらきながら
sshfsで実行し、ローカルのパスとリモートのパスの違いを意識しながら作業す
ることになります。

emacs ユーザの方々に朗報です。tramp とは \texttt{/sshx:hostname:path/to/file} とい
う特殊なファイル名を指定すると透過的にsshを使ってリモートのファイルを取
得して編集できるようにしてくれる仕組みです。
また、dired でリモートのディレクトリのファイル管理もローカルと変わらない
ように行えます。
さらに便利なのは \texttt{M-x shell}, \texttt{M-x compile} などリモートでコマンドを実行する
コマンドを利用するとhostname にsshでログインして path/to/file をカレント
ディレクトリとした状態でコマンドを実行してくれるところです。
個人的にはmoshなどを利用してシェルのコマンドを実行するより、emacsのロー
カルバッファでコマンドラインを編集して確定時にリモートに送信するスタイル
が気に入っています。

\subsection{リモートホスト側の設定}
ssh で接続される側のの設定ですが、trampはシェルのセッションの入出力を利用し、機械的に
プロンプトを検出するので、プロンプト（PS1など）をカスタマイズしていると
動かない場合があります。trampのために　\texttt{.bashrc}はシンプルにするといいかも
しれません。

例えば、raspbian のデフォルトは色がつきまくってたりしてファンシー過ぎてう
まく動きませんでした。

\subsection{sshの設定とチューニング}

ローカルのsshの設定ファイル \verb!~/.ssh/config! に設定したほうがよいものを紹介します。

\subsubsection{ControlMasterで接続を再利用}

手元ではこんな設定にしています。

\begin{commandline}
 ControlMaster auto
 ControlPersist 120
 ControlPath ~/tmp/ssh-%r@%h:%p
\end{commandline}


ControlPersist に指定した秒数間、sshで接続する際にデーモンプロセスが起動
して、コネクションを張りっぱなしにし、コネクションを再利用してくれます。

手元では、ControlPathを明示的に指定しています。ホームディレクトリ以下の
tmp 以下にしているのはファイル名が予想可能になるので衝突を防ぐためです。

ControlMasterをAutoにしておくとすでにコネクションが開いていない場合はデー
モンをたちあげて、もしコネクションが開いている場合にはそれを利用するよう
になります。

\subsubsection{keep-alive}

trampはネットワーク接続の切断をsshプロセスの生死で検出します。
sshはネットワーク接続がきれたりしてもすぐにはそれを検出しないので、キー
プアライブを送信するようにします。

\begin{commandline}
 ServerAliveInterval 3
 ServerAliveCountMax 5
\end{commandline}


本当はパソコンがサスペンドから復活して新しいネットワーク接続につながった
らsshプロセスに再接続してほしいのですが、その方法をまだ発見できていませ
ん。

\subsubsection{その他の設定}

Mac のRendezvousとかLinuxのAvahiとか設定しているとホスト名.local という名
前で名前解決ができるようになりますが、そうするとIPアドレスはDHCPだと一定
ではないため、IPに対しての鍵が違うと怒られます。その場合はホストIPをチェッ
クしないようにするとよいでしょう。

\begin{commandline}
 Host *.local
  CheckHostIP no
\end{commandline}

あとデフォルトではいろいろな鍵を試したりする設定になっていますが、ついで
に鍵を指定して公開鍵認証にしておくとよいんじゃないでしょうか。

\begin{commandline}
 Host raspberrypi.vpn
  Hostname そのホストのIPアドレス
  IdentityFile ~/.ssh/ssh-keygenで作ったファイルのパス
  IdentitiesOnly yes
\end{commandline}


\subsection{trampの.emacs での設定とチューニング}

\texttt{.emacs} にほとんど設定しなくてもデフォルトの設定でそれなりにうごきます。

trampでは\texttt{/sudo:root@hostname:/} のような形式でリモートホスト上で
sudoで別ユーザになってからファイルにアクセスするように指定することが可能
です。ただ、そのためにはリモートホストへの到達手段を指定する必要がありま
す。たとえば、ローカルネットワークにあるホスト \texttt{*.local} でsudoを
サポートしたいという要望であれば、次のような設定を追記しておきます。

\begin{commandline}
 (add-to-list 'tramp-default-proxies-alist
      '("\\.local\\'" "\\`root\\'" "/ssh:%h:"))
\end{commandline}

あと、デフォルトの設定だとリモートアクセスしているというメッセージがステー
タスに表示されるのですが、正直邪魔なのでそれを消すのもよいかと思います。

\begin{commandline}
(custom-set-variables '(tramp-verbose 1))
\end{commandline}

\begin{thebibliography}{0}
 \bibitem{trampinfomanual} ``TRAMP User Manual'', info
	 page,
	 \url{http://www.gnu.org/software/emacs/manual/html_node/tramp/index.html#Top}
\end{thebibliography}
%-------------------------------------------------------------------------------
\dancersection{asterisk設定}{上川純一}
%-------------------------------------------------------------------------------
\index{asterisk}

% \printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
