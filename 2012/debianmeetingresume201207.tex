%; whizzy chapter -dvi
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2011 Nobuhiro Iwamatsu

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201207; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2012}
\newcommand{\debmtgmonth}{7}
\newcommand{\debmtgdate}{21}
% (+ (* (- 2012 2005) 12) 7 -1) started from zero
\newcommand{\debmtgnumber}{90}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics[width=210mm]{image201003/debsen.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
% 全角文字にしないとフォントのサイズが合わないので注意
% TODO(uekawa): なんでそうなるのか確認
\rotatebox{10}{\fontsize{32}{32} {\gt 特集: マックブックエアでデビアンを}}

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

% Title should be in Japanese text so that we can use it as lint for PDF shiori.
\dancersection{はじめに}{上川 純一}

\begin{multicols}{2}
 

 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:
\begin{enumerate}
 \item Debconf の内容で興味があったセッションの内容を紹介してください
\end{enumerate}
この課題に対して提出いただいた内容は以下です。
\begin{multicols}{2}
{\small
 \input{image201207/prework.tex}
}
\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川 純一}
\subsection{東京エリアDebian勉強会88回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

第88回東京エリアDebian勉強会は開催前週に上川のノートパソコンが壊れた関係でいろいろとバタバタしてましたが無事に開催されました。
参加者は山田泰資さん、Freeparisさん、吉田＠小江戸さん、BeatenAvenueさん、amotokiさん、
吉野与志仁さん、dictossさん、kamonshoheiさん、emasakaさん、本庄さん、やまねひできさん、野島さん、山本浩之さん、上川の14人でした。

事前課題の紹介で熱く盛り上がりました。
一番初心者向けとして推薦されていたプログラミング言語はシェルスクリプトでした。
シェルスクリプトはプログラム言語なのかツールなのかという話題や、
言語としては良くないんじゃないかという話もありますが、
短い記述でできることが多く、そもそも使えないとコマンドライン使えないんじゃないかということで、
シェルでプログラム入門するのが最初は挫折しなくていいんじゃないかということでした。
Rubyをすすめる人よりPythonすすめる人のほうが多くて面白いと想いました。
ドキュメントの充実度の違いとかRubyの言語の説明があまり説明になってないところとか
が話題になりました。

上川がCoffeescriptをDebianで利用する場合について紹介しました。
まず最初に言語自体について簡単に説明して、それぞれどういう場合でどのようにDebian
環境で利用できるのかを紹介しました。

最後にやまねひできさんがPythonプログラミング環境について話をしました。
複数バージョンのPython環境をどう用意するのがDebianとしては良いのか
という話題で議論しました。

懇親会は駅前の「はなの舞」にて。
今回は事前に登録していた方は全員参加して、かつ懇親会に向けてさらにメンバーが追加になったので会場から溢れんばかりでした。

\subsection{大統一Debian勉強会}

89回目のDebian勉強会は京都開催の大統一Debian勉強会でした。
京都大学の教室にて白熱した議論が繰り広げられました。一部のメンバーは設営のために徹夜していたようでお疲れ様でした。

%-------------------------------------------------------------------------------
\dancersection{MacBook Air 4,1 (Mid 2011)にDebianインストールしてみた}{上川純一}
%-------------------------------------------------------------------------------
\index{macbook air}

\subsection{はじめに}

AppleのMacBook Airなどの製品は通常のPCとは違い起動がEFI経由でなされるな
どの癖があります。
久しぶりにどうやってインストールして動かすのかについてまとめてみました紹
介します。
今回はrEFIt\cite{refit}を利用してMac OSとdual boot 構成にしています。

\subsection{インストール開始からDual Bootで起動するまで}
\index{refit}
\index{efi}

まず、Mac OS Xがディスク全体を利用しているため、インストールできるスペースがありません。
Mac OS Xのコマンドラインからdiskutil resizevolumeを使ってディスクを小さ
くします。

\begin{commandline}
 # sudo diskutil resizevolume disk0s2 30G 
\end{commandline}

Mac の起動はBIOSではなくEFI経由なのですが、rEFItはEFIで起動するブートローダーです。メニュー形式やコマンドラインでGrubをチェーンロードしたりできます。
Mac OSでrEFItをインストールします。最近のrEFIt はインストーラーに従うと
自動でインストールしてくれるようになっているようで自分でBlessコマンドを
うったりする必要はありません。

何度か再起動すると起動時にrEFItの画面に切り替わるようになるようです。

Debian Installerの名刺サイズのISOイメージをUSBメモリ\footnote{僕は今回は
USB SD リーダーに余ったmicro SDをさして使いました。}にddで書き込んでおくと、
再起動したときにrEFItからdebian installerを起動する選択肢が出てきます。

インストールは通常のように行います。
引っかかる場所は二箇所。Grubのインストールの部分とネットワークの設定でしょ
う。

無線ネットワークのbrcmsmac ドライバが対応しているのですが、ファームウェ
アが必要でNon-freeのためインストーラに標準で入っていません。インストーラ用にファームウェ
アを事前に用意する必要がありますが、僕は面倒だったのでUSB Ethernetをつな
げてインストールしてしまいました。

Grubのインストールの部分はうまく行かず試行錯誤してしまったのですが、
refit パッケージにあるgptsyncコマンドを実行してGPTとFATのパーティションテー
ブルを同期させ、grub-pcをDebian installerがつくった小さなパーティションに
インストールすることで解決しました。多分コマンドラインはこんな感じだった
と思います。\footnote{grub-efi で BIOSエミュレーションではなくEFIモードを
使い起動し、GPTから直接ブートできるはずだと思われるのですが未確認。}
Debian installerのシェルの中でtargetにchrootして作業しました。

 \begin{commandline}
# gptsync
# grub-install (hd0,4)
 \end{commandline}

\subsubsection{ディスクパーティション構成}
\index{gptsync}

GPT / FAT のパーティション構成は結果として次のようになりました。

 \begin{commandline}
$ cat /proc/partitions 
major minor  #blocks  name

   8        0  245117376 sda
   8        1     204800 sda1  # EFI
   8        2   39062500 sda2  # Mac OS X
   8        3     634768 sda3  # Mac OS X recovery?
   8        4        977 sda4  # grub
   8        5  197461914 sda5  # /
   8        6    7752380 sda6  # swap

$ sudo fdisk -l /dev/sda

WARNING: GPT (GUID Partition Table) detected on '/dev/sda'! The util fdisk doesn't support GPT. Use GNU Parted.


Disk /dev/sda: 251.0 GB, 251000193024 bytes
255 heads, 63 sectors/track, 30515 cylinders, total 490234752 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0000221d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1      409639      204819+  ee  GPT
/dev/sda2          409640    78534639    39062500   af  HFS / HFS+
/dev/sda3        78534640    79804175      634768   ab  Darwin boot
/dev/sda4   *    79804176    79806129         977   c0  Unknown
 \end{commandline}

Mac OS XのパーティションはLinuxからはhfsplusファイルシステムとしてマウントすることができます。

 \begin{commandline}
sudo mount /dev/sda2 /mnt/ -o ro
$ mount -v 
/dev/sda2 on /mnt type hfsplus (ro,relatime,umask=22,uid=0,gid=0,nls=utf8)
 \end{commandline}

\subsection{無線LAN}
\index{brcmsmac}
\index{non-free firmware}

brcmsmac ドライバで無線LANは動きます。
non-free firmware が動作に必要になります。自由じゃないBinary Blobなどけ
しからんですが、non-free にパッケージがあるのでインストールしておけばうごきます。

 \begin{commandline}
ii  firmware-brcm80211          0.35                        Binary firmware for Broadcom 802.11 wireless cards
 \end{commandline}

\subsection{X}

\subsubsection{画面}

Wheezyに入っているLinuxカーネル3.2だとそのままいい解像度で動いてくれます。
xorgとしては\texttt{Integrated Graphics Chipset: Intel(R) Sandybridge
Mobile (GT2)}を認識してくれているようです。

 \begin{commandline}
$ xrandr
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
eDP1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 256mm x 144mm
   1366x768       60.0*+
   1360x768       59.8     60.0  
   1024x768       60.0  
   800x600        60.3     56.2  
   640x480        59.9  
VGA1 disconnected (normal left inverted right x axis y axis)
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)
HDMI2 disconnected (normal left inverted right x axis y axis)
HDMI3 disconnected (normal left inverted right x axis y axis)
DP2 disconnected (normal left inverted right x axis y axis)
DP3 disconnected (normal left inverted right x axis y axis)
 \end{commandline}

\subsubsection{キーボード}

英語キーボード版を買ったのですが、何も特に設定した記憶がありません。

\begin{commandline}
[    11.567] (II) XINPUT: Adding extended input device "Apple Inc. Apple Internal Keyboard / Trackpad" (type: KEYBOARD, id 10)
[    11.567] (**) Option "xkb_rules" "evdev"
[    11.567] (**) Option "xkb_model" "pc105"
[    11.567] (**) Option "xkb_layout" "us"

[    11.685] (II) XINPUT: Adding extended input device "ACPI Virtual Keyboard Device" (type: KEYBOARD, id 13)
[    11.685] (**) Option "xkb_rules" "evdev"
[    11.685] (**) Option "xkb_model" "pc105"
[    11.685] (**) Option "xkb_layout" "us"
\end{commandline}

\subsubsection{キーボードによるマウスクリックエミュレーション}

マルチタッチトラックパッドになったので右クリックなどがタッチでできるよう
になっているため、最近はこの設定は必要ありません。

mouseemu パッケージをインストールするとデフォルトでF10,F11がマウスの真ん
中ボタンと右ボタンクリックにアサインされます。僕の場合は最初からmouseemuパッケー
ジがインストールされてて気づかずはまりました。

カーネルのUSBドライバmac hidでも設定できるみたいです。カーネルで設定する
場合はここらへんを参照してください：
\begin{commandline}
/proc/sys/dev/mac_hid/mouse_button2_keycode
/proc/sys/dev/mac_hid/mouse_button3_keycode  
/proc/sys/dev/mac_hid/mouse_button_emulation
\end{commandline}

\subsubsection{マルチタッチトラックパッド}

デフォルトの状態でもsynapticsでシングルタッチトラックパッドとして動きますが、xserver-xorg-input-mtrack でマルチタッチトラックパッドとして動きます。 

 \begin{commandline}
# apt-get install xserver-xorg-input-mtrack xserver-xorg-input-synaptics-
 \end{commandline}

個人的にはタッチ判定が敏感すぎてキーボード入力しているとマウスクリック判
定されて悩んでます。ドキュメント\cite{xorg-configure-input,mtrack-doc}によると設定は可能なようです。

ものは試しと一つ指タップを判定しないように
\url{/etc/X11/xorg.conf.d/50-mtrack.conf}に以下の設定を追加してみています：

\begin{commandline}
Section "InputClass"
	MatchIsTouchpad "true"
	Identifier "Multitouch Touchpad"
	Driver "mtrack"
	Option "TapButton1" "0"
EndSection
\end{commandline}


\subsection{スリープ}

なんか電源ボタンをおしたり蓋を閉じたりするとスリープしてくれるようです。

ほんのたまに無線LANが認識しなくなりますがbrcmsmacモジュールをrmmod / modprobe
するとなおるっぽい。さらにほんのたまに電池の残量を認識しなくなる。

\begin{thebibliography}{0}
\bibitem{xorg-configure-input} 
	How to configure input
	\url{/usr/share/doc/xorg/howto/configure-input.txt.gz}
\bibitem{mtrack-doc}
	xf86-input-mtrack documentation.
	\url{/usr/share/doc/xserver-xorg-input-mtrack/README.md.gz}
\bibitem{refit} rEFIt \url{http://refit.sourceforge.net/}
\end{thebibliography}


%\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
