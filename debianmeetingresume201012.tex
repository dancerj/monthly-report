%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2010 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201012; ebb *.jpg")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
\usepackage{wrapfig}
\usepackage{supertabular}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2010}
\newcommand{\debmtgmonth}{12}
\newcommand{\debmtgdate}{18}
% (+ (* (- 2010 2005) 12) 10) started from zero
\newcommand{\debmtgnumber}{71}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics[width=210mm]{image201003/debsen.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
\rotatebox{10}{\fontsize{32}{32} {\gt 特集: 俺のファイルシステムは熱いぜ！}}

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

\dancersection{Introduction}{上川 純一}

\begin{multicols}{2}
 

 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:
\begin{itemize}
 \item 「2010年を振り返って自分がDebianでやったこと・Debian界隈でおきたこと。2011年におきると予想すること、自分がやりたいこと。」
\end{itemize}
この課題に対して提出いただいた内容は以下です。
\begin{multicols}{2}
{\small
% \input{image201012/prework.tex}
}
\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}
\subsection{東京エリアDebian勉強会70回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

東京エリアDebian勉強会。
参加者は、やまださん、前田さん、上川、野島さん、服部さん、キタハラさん、emasakaさん、matoharaさん、鈴木さん、吉田@板橋さん、高橋斉大さん、荒木(靖)さん、本庄さん、やまもとさん、吉野さんの15人でした。

ファイルシステムについてかたりました

まず最初に上川がext4について紹介しました。

nilfs について紹介しました。

btrfs について紹介しました。

ceph について紹介しました。


%-------------------------------------------------------------------------------
\dancersection{2010年の東京エリアDebian勉強会をふりかえって}{上川 純一}
%-------------------------------------------------------------------------------
\index{debianjp@Debian JP} 
\index{とうきょうえりあ@東京エリアDebian勉強会}
\index{2010ねん@2010年}

今月で6年目のDebian勉強会が終了しました。
Debian Developer の数も着々と増えていき、当初の目標が達成されてきていま
すね。

今年東京エリアDebian勉強会常連のやまねさんがDebian Developerになりました。
苦節6年おめでとうございます。
% ueno ? kiwamu ?

Debian Maintainer 申請も複数通りました。
% FIXME: だれが今年通ったか?

\subsection{基本的な数値}

Debian 勉強会は毎回事前課題事後課題を設定しており、予習復習を必要だとう
たっている勉強会です。
実際にどれくらいの人が出席しているのか、またその人たちがどれくらい事前課
題・事後課題を提出しているのか、確認してみましょう。
\fgref{fig:attendandprepostwork}です。
値は一年の移動平均です。

結果を見ると事前課題の提出率が2009年に低下傾向にあったのが、2010年に反転
上昇しています。これはDebian勉強会予約システムの導入により事前課題の提出
が簡単になったことと関係ありそうです。また、別の傾向として事後課題(ブロ
グ)の率が低下傾向にあります。もうブログは流行らないのかもしれません。

\begin{figure}[ht]
 \includegraphics[width=1\hsize]{image201012/memberanalysis/attend.png}
\caption{東京エリアDebian勉強会事前課題・事後課題提出実績(12ヶ月移動平均)}\label{fig:attendandprepostwork}
\end{figure}

毎回の参加者の人数と、その際のトピックを見てみます。今年はとくに目立った
感じの回はないですが、参加者についての記録が散逸しているようです。

\begin{table}[ht]
\begin{minipage}{0.5\hsize}
 \caption{東京エリアDebian勉強会参加人数(2005-2006年)}\label{tab:count}
 \begin{center}
  \begin{tabular}{|l|c|p{10em}|}
 \hline
   & 参加人数 & 内容 \\
 \hline
   2005年1月 & 21 & 秘密\\
   2005年2月 & 10 & debhelper 1\\
   2005年3月 & 8 &  (早朝) debhelper 2、social contract\\
   2005年4月 & 6 & debhelper 3\\
   2005年5月 & 8 & DFSG、dpkg-cross、lintian/linda\\
   2005年6月 & 12 & alternatives、d-i\\
   2005年7月 & 12 & toolchain、dpatch\\
   2005年8月 & 7 & Debconf参加報告、ITPからアップロードまで\\
   2005年9月 & 14 & debconf\\
   2005年10月 & 9 & apt-listbugs、バグレポート、debconf翻訳、debbugs\\
   2005年11月 & 8 & DWN翻訳フロー、statoverride\\
   2005年12月 & 8 & 忘年会\\
   2006年1月 & 8 & policy、Debian勉強会でやりたいこと\\
   2006年2月 & 7 & policy、multimedia \\
   2006年3月 & 30 & OSC: debian勉強会、sid \\
   2006年4月 & 15 & policy、\LaTeX{} \\
   2006年5月 & 6 & mexico \\
   2006年6月 & 16 & debconf、cowdancer\\
   2006年7月 & 40 & OSC-Do: MacBook Debian \\
   2006年8月 & 17 & 13執念 \\
   2006年9月 & 12 & 翻訳、Debian-specific、oprofile \\
   2006年10月 & 23 & network、i18n会議、Flash、apt \\
   2006年11月 & 20 & 関西開催： bug、sid、packaging \\
   2006年12月 & 14 & 忘年会 \\
 \hline
  \end{tabular}
 \end{center}
\end{minipage}
\begin{minipage}{0.5\hsize}
 \caption{東京エリアDebian勉強会参加人数(2007-2008年)}\label{tab:count2007}
 \begin{center}
  \begin{tabular}{|l|c|p{10em}|}
 \hline
 & 参加人数 & 内容\\
 \hline
   2007年1月 & 15 & 一年を企画する \\
   2007年2月 & 13 & dbs, dpatch\\ 
   2007年3月 & 80 & OSC仮想化 \\
   2007年4月 & 19 & quilt, darcs, git\\
   2007年5月 & 23 & etch, pbuilder, superh \\   
   2007年6月 & 4 & エジンバラ開催：Debconf7 実況中継 \\
   2007年7月 & 18 & Debconf7 参加報告\\
   2007年8月 & 25 & cdn.debian.or.jp \\   
   2007年9月 & 14 & exim \\   
   2007年10月 & 30 & OSC Tokyo/Fall(CUPS) \\   
   2007年11月 & 19 & live-helper, tomoyo linux kernel patch, server\\
   2007年12月 & 11 & 忘年会\\
   2008年1月 & 23 & 一年を企画する \\
   2008年2月29+3月1日 & 36 & OSC  \\
   2008年3月 & 37 & データだけのパッケージ、ライセンス \\
   2008年4月 & 17 & バイナリパッケージ \\
   2008年5月 & 20 & 複数のバイナリパッケージ \\
   2008年6月 & 10 & debhelper \\
   2008年7月 & 17 & Linux kernel patch / module パッケージ \\
   2008年8月 & 10 & Debconf IRC会議とDebian温泉 \\
   2008年9月 & 17 & po4a, 「Debian メンテナのお仕事」 \\
   2008年10月 & 11? & OSC Tokyo/Fall \\
   2008年11月 & 17 & 「その場で勉強会資料を作成しちゃえ」 Debian を使った \LaTeX{} 原稿作成合宿 \\
   2008年12月 & 12 & 忘年会 \\
 \hline
  \end{tabular}
 \end{center}
\end{minipage}
\end{table}

\begin{table}[t]
\begin{minipage}{0.5\hsize}
 \caption{東京エリアDebian勉強会参加人数(2009-2010年)}\label{tab:count2009}
 \begin{center}
  \begin{tabular}{|l|c|p{10em}|}
 \hline
 & 参加人数 & 内容\\
 \hline
   2009年1月 & 12 & 一年を企画する \\
   2009年2月 & 30 & OSC パッケージハンズオン\\ 
   2009年3月 & 23 & Common Lisp, パッケージ作成 \\
   2009年4月 & 15 & Java Policy, ocaml, 開発ワークフロー\\
   2009年5月 & 13 & MC-MPIパッケージ化、Erlang、Androidアプリ、DDTP \\   
   2009年6月 & 14 & DDTP・DDTSS、bsdstatsパッケージ、Debian kFreeBSD\\
   2009年7月 & 4 & スペインにてDebconf 9\\
   2009年8月 & 14 & スペイン Debconf 9 参加報告 \\   
   2009年9月 & 26 & GPGキーサインパーティー \\   
   2009年10月 & 30 & OSC Tokyo Fall\\
   2009年11月 & 12 & Octave, R, gnuplot, auto-builder \\
   2009年12月 & 10 & 忘年会\\
   2010年1月 & 17 &  東京大学にて新年会 \\
   2010年2月 & 11 & Debian温泉,ocaml,haskell \\
   2010年3月 & 12 & weka,fftw,dpkg v3 quilt \\
   2010年4月 & 15 & upstart,piuparts,debtags \\
   2010年5月 & 22 & 筑波大学,kernel \\
   2010年6月 & 12 & OSC-Doリハーサル  \\
   2010年7月 & 0 & キャンセル  \\
   2010年8月 & 3 & Debconf (NYC) \\
   2010年9月 & 30 & OSC Tokyo/Fall \\
   2010年10月 & 13 & 俺のDebianな一日 \\
   2010年11月 & 15 & ext4,btrfs,nilfs,ceph \\
   2010年12月 &  &   \\
 \hline
  \end{tabular}
 \end{center}
\end{minipage}
\end{table}

%-------------------------------------------------------------------------------
\dancersection{CACert の準備に何が必要か}{山田 泰資}
%-------------------------------------------------------------------------------

%-------------------------------------------------------------------------------
\dancersection{DebianでKinectをつかってみた}{山田 泰資}
%-------------------------------------------------------------------------------

%-------------------------------------------------------------------------------
\dancersection{俺のlibsaneが火を噴くぜ！}{本庄 弘典}
\footnote{このタイトルは誰が付けたのでしょうか？}
%-------------------------------------------------------------------------------

\index{libsane}

SANEはScanner Access Now Easyの頭文字を取ったもので、各種デバイスから画
像を取り出すための汎用インターフェースです。主にスキャナから画像を取得
するため、LinuxやFreeBSDなどフリーなOSで利用されます。

今回はSANEの仕組みとlibsaneを用いたプログラムの作成方法について解説します。

\subsection{SANEの構造}

SANEを利用するアプリケーションはlibsane.soという共有ライブラリをリンク
します。libsane.soはdllと呼ばれる仮想デバイスドライバを通し、各デバイス
ごとに作られたドライバにアクセスすることでデバイスを制御します。また図
に示されるように、net仮想ドライバで他のマシンのsanedに接続することで、
リモートスキャナへのアクセスを実現します。
\cite{sane,sanejp,saneapi}

\begin{figure}[H]
\begin{center}
 \includegraphics[height=0.5\hsize] {image201012/libsane02.png}
 \caption{SANEの構造}
\label{fig:sane}
\end{center}
\end{figure}

なお、
SANEを利用するユーザはscannerグループに所属させる必要があります。

\newpage

\subsection{Code Flow}

\begin{figure}[H]
\begin{center}
 \includegraphics[height=0.5\hsize] {image201012/codeflow.png}
 \caption{Code Flow}
\label{fig:codeflow}
\end{center}
\end{figure}


\subsection{スキャンするためのコード}

とりあえずスキャンするだけのコードは次のようになります。

\begin{commandline}
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <sane/sane.h>


#define MAXLEN 32768

int main()
{
  SANE_Status stat;
  SANE_Handle hndl;
  SANE_Byte buf[MAXLEN];
  SANE_Int len = MAXLEN;
  FILE *fp;

  stat = sane_init(NULL, NULL);
  printf("init: %d\n", stat);
  stat = sane_open("fujitsu:libusb:008:002", &hndl);
  printf("open: %d\n", stat);

  fp = fopen("foo.bin", "wb");
  stat = sane_start(hndl);
  printf("start: %d\n", stat);
  while (len == MAXLEN) {
    stat = sane_read(hndl, buf, MAXLEN, &len);
    printf("read: %d\n", stat);
    printf("read_len: %d\n", len);
    fwrite(buf, len, 1, fp);
  }
  fclose(fp);

  sane_close(hndl);
  printf("close: %d\n", stat);
  sane_exit();
  printf("exit: %d\n", stat);
}
\end{commandline}

このコードで保存されるfoo.binは、
ScanSnap S1500の場合、
ヘッダ無しのpbmファイルとして保存されました。
スキャナによってはpgmで保存されるものもあり、
デフォルトで保存される画像のモードは特に決まっていないようです。


\subsection{カラーのスキャン}

オプションの設定にはいくつか注意点があるようです。

\begin{itemize}
\item sane\_get\_option\_descriptor()でオプションの説明文やフォーマットの取得が可能。
\item sane\_control\_option(hndl, 0, SANE\_ACTION\_GET\_VALUE, \&num, \&info)でオプションの総数を取得できる。
\item sane\_control\_option()でActionにSANE\_ACTION\_GET\_VALUEを指定することで現在設定されているオプションを読み出すことが可能。
\item sane\_control\_option()でActionにSANE\_ACTION\_SET\_VALUEを指定することでオプションの設定が可能。
\item sane\_control\_option()を呼ぶ際には事前にsane\_get\_option\_descriptor()を呼び出しておく必要がある。 
\end{itemize}

\begin{commandline}
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sane/sane.h>

#define MAXLEN 32768

int main()
{
  SANE_Status stat;
  SANE_Handle hndl;
  const SANE_Option_Descriptor *opt;
  SANE_Int info = 0;
  SANE_Byte buf[MAXLEN];
  SANE_Int len = MAXLEN;
  SANE_Parameters param;
  FILE *fp;

  stat = sane_init(NULL, NULL);
  printf("stat: %d\n", stat);
  stat = sane_open("fujitsu:libusb:008:004", &hndl);
  printf("open: %d\n", stat);

  int x=300, y=300;
  opt = sane_get_option_descriptor(hndl, 4);
  printf("get_option_descriptor: %03d: %d\n", 0, opt->size);
  stat = sane_control_option(hndl, 4, SANE_ACTION_SET_VALUE, &x, &info);
  printf("control_option: %d\n", stat);
  printf("info: %d\n", info);

  opt = sane_get_option_descriptor(hndl, 5);
  printf("get_option_descriptor: %03d: %d\n", 0, opt->size);
  stat = sane_control_option(hndl, 5, SANE_ACTION_SET_VALUE, &y, &info);
  printf("control_option: %d\n", stat);
  printf("info: %d\n", info);

  strcpy(buf, "Color");
  opt = sane_get_option_descriptor(hndl, 3);
  printf("get_option_descriptor: %03d: %d\n", 0, opt->size);
  stat = sane_control_option(hndl, 3, SANE_ACTION_SET_VALUE, buf, &info);
  printf("control_option: %d\n", stat);
  printf("info: %d\n", info);

  stat = sane_start(hndl);
  printf("%d\n", stat);
  fp = fopen("foo.ppm", "wb");

  stat = sane_get_parameters(hndl, &param);
  printf("get_parameters: %d\n", stat);
  sprintf(buf, "P6\x0a# SANE data follows\x0a%d %d\x0a%d\x0a",
    param.pixels_per_line, param.lines, 255);
  fwrite(buf, strlen(buf), 1, fp);


  while (len == MAXLEN) {
    stat = sane_read(hndl, buf, MAXLEN, &len);
    printf("read: %d\n", stat);
    printf("read_len: %d\n", len);
    fwrite(buf, len, 1, fp);
  }
  fclose(fp);

  sane_close(hndl);
  printf("close: %d\n", stat);
  sane_exit();
  printf("exit: %d\n", stat);
}
\end{commandline}


\begin{figure}[H]
\begin{center}
 \includegraphics[height=0.5\hsize] {image201012/dst02.jpg}
 \caption{スキャン結果}
\label{fig:scan}
\end{center}
\end{figure}

モノクロではわかりづらいと思いますが、
ScanSnap S1500でスキャンした結果、
RとBが入れ替わってスキャンされました。

\subsection{まとめ}

\begin{itemize}
\item やや不安定(特に権限周り)
  \begin{itemize}
  \item scanimage -Lでたまにsegmentation faultする 
  \end{itemize}
\item スキャナによってデフォルトの動作がまちまち
  \begin{itemize}
  \item ScanSnapは.pbmでスキャン
  \item CanoScanは.pgmでスキャン 
  \end{itemize}
\item スキャナによってRGBの順番すらまちまち
  \begin{itemize}
    \item でもこれはScanSnapが悪いのかも
    \item ScanSnapはTWAIN未対応だし 
  \end{itemize}
\item ドキュメント化されていない罠の存在
\item スキャナのボタンをイベントとして使えないっぽい 
\end{itemize}

\begin{thebibliography}{0}
 \bibitem{sane}SANE - Scanner Access Now Easy \\
http://www.sane-project.org/

 \bibitem{sanejp}
SANE-tutorial-JP / 著者:David Mosberger / 翻訳:川岸 良治\\
http://archive.linux.or.jp/JF/JFdocs/SANE-tutorial-JP.html

 \bibitem{saneapi}
SANE Standard Version 2.0 proposal 0.08 - rauch/beck \\
http://www.sane-project.org/sane2/0.08/

\end{thebibliography}

%-------------------------------------------------------------------------------
\dancersection{Debian Miniconf 企画案}{山本}
%-------------------------------------------------------------------------------

\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
