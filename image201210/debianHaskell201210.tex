
%% -Haskell のパッケージおよび依存関係の仕組みである Cabal, Hackage,

\subsection{Hackage\protect\footnote{http://hackage.haskell.org/}}

Haskellで書かれたライブラリやツールのパッケージ配布サイト。PerlでのCPANのようなもの。
このHaskellのパッケージはしばしばHackageと呼ばれる。

\begin{commandline}
http://hackage.haskell.org/package/<hackageの名前>
\end{commandline}

各Hackageにはバージョン情報やライブラリ依存関係情報が含まれている。

language-objcパッケージの例:

\begin{commandline}
Name:          language-objc
Version:       0.4.2.5
...
Library
...
    Build-Depends: base       >= 3 && < 5,
                   filepath   >= 1.1 && < 1.4,
                   process    == 1.1.*,
                   directory  >= 1.1 && < 1.3,
                   array      == 0.4.*,
                   containers >= 0.4     && < 0.6,
                   newtype    == 0.2.*,
                   pretty     == 1.1.*
...
    Build-Tools:    happy, alex
\end{commandline}

\subsection{Cabal\protect\footnote{http://hackage.haskell.org/package/Cabal} ライブラリと
cabal-install\protect\footnote{http://hackage.haskell.org/package/cabal-install}}

Cabalは依存関係にしたがってパッケージをHackageのサイトから取ってきたり、
パッケージのソースツリーと手元の環境からパッケージをbuildしたりするライブラリ。

cabal-installはCabalライブラリをコマンドラインから呼び出すためのツール。
コマンドの名前は cabal。

どちらも Haskell で書かれていて Hackage に置かれている。

\begin{commandline}
% cabal unpack language-objc
% cd language-objc-0.4.2.5
% cabal configure
% cabal build
% cabal copy
% cabal register
\end{commandline}

%% -その情報を利用して Debian パッケージを作る cabal-debian コマンドおよび debian ライブラリ,

\subsection{debian\protect\footnote{http://hackage.haskell.org/package/debian} ライブラリと
cabal-debian\protect\footnote{http://hackage.haskell.org/package/cabal-debian} }

debianはDebianソースパッケージの情報をハンドリングするためのライブラリ。
このライブラリを使って作られているcabal-debianというツールで、
HackageのソースをDebianのソースパッケージに変換できる。

\begin{commandline}
% cabal unpack language-objc
% cd language-objc-0.4.2.5
% cabal-debian --debianize
\end{commandline}

\begin{commandline}
% cat debian/control
Source: haskell-language-objc
Priority: extra
Section: haskell
...
Build-Depends: debhelper (>= 7.0),
               haskell-devscripts (>= 0.8),
               cdbs,
               ghc,
               ghc-prof,
               libghc-newtype-dev (>= 0.2) | libghc-newtype-dev (<< 0.3),
               libghc-newtype-prof (>= 0.2) | libghc-newtype-prof (<< 0.3),
               libghc-syb-dev (>= 0.3) | libghc-syb-dev (<< 0.4),
               libghc-syb-prof (>= 0.3) | libghc-syb-prof (<< 0.4),
               happy,
               alex
Build-Depends-Indep: ghc-doc,
                     libghc-newtype-doc (>= 0.2) | libghc-newtype-doc (<< 0.3),
                     libghc-syb-doc (>= 0.3) | libghc-syb-doc (<< 0.4)
...
\end{commandline}

以上のような感じでうまく依存関係の情報が変換されている。

ライブラリのパッケージだと、そのまま利用できる程度のものが自動的に生成される。
実行ファイルがあるものについてはrulesにインストール先を書く必要がある。

%% -Debhelper との連携のためのスクリプトである haskell-devscripts

\subsection{haskell-devscripts}

cabal-debian で作られたDebianのソースパッケージは
haskell-devscripts に含まれている cdbs用のMakefileを利用するように
構成されている。dh\_haskell\_* のコマンド群はこのMakefileから利用されている。

\begin{commandline}
% cat debian/rules
#!/usr/bin/make -f
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/hlibrary.mk

# How to install an extra file into the documentation package
#binary-fixup/libghc-language-objc-doc::
#	echo "Some informative text" > debian/libghc-language-objc-doc/usr/share/doc/libghc-language-objc-doc/AnExtraDocFile
\end{commandline}

