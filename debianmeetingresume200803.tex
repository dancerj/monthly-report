%; -*- coding: iso-2022-jp -*-
%; whizzy chapter
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。


%     Tokyo Debian Meeting resources
%     Copyright (C) 2008 Junichi Uekawa

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image200801; ebb *.png")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}
\usepackage[dvips]{xy}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2008}
\newcommand{\debmtgmonth}{3}
\newcommand{\debmtgdate}{15}
\newcommand{\debmtgnumber}{38}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}

% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料

\hspace*{-2.4cm}
\includegraphics[width=210mm]{image200801/2008title.eps}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

\end{titlepage}

\dancersection{Introduction}{上川 純一}
 
 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

\begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
\end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

以上を目的とした、2008 年アジェンダです：
\begin{enumerate}
 \item 新年会「気合を入れる」
 \item Open Source Conference Tokyo (3/1)
 \item データだけのパッケージを作成してみる、
       ライセンスの考え方 (David Smith)
 \item バイナリ一つのパッケージを作成してみる (吉田@板橋)\\
       バージョン管理ツールを使いDebianパッケージを管理する(git)\\
       アップストリームの扱い(svn/git/cvs)(岩松 信洋さん)
 \item バイナリの分けたパッケージの作成。(前田さん)\\
       バイナリの分け方の考え方、アップグレードなどの運用とか。
 \item パッケージ作成(dpatch/debhelperで作成するパッケージ)(小林儀匡さん)\\
       man の書き方(roff or docbook)(でんさん)
 \item パッケージ作成(kernel patch、kernel module)
       、Debconf発表練習
 \item Debconf アルゼンチン、共有ライブラリパッケージ作成

 \item Open Source Conference Tokyo/Fall、
       デーモン系のパッケージの作成、latex、 emacs-lisp、フォントパッケージ
 \item パッケージの cross-compile の方法、amd64 上で i386 のパッケージと
       か、OSC-Fall報告会、Debconf報告会
 \item 国際化 po-debconf / po化 / DDTP
 \item 忘年会
\end{enumerate}


\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\tableofcontents
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です。

\begin{enumerate}
 \item ...

\end{enumerate}

この課題に対して提出いただいた内容は以下です。


%%% trivia quiz
\dancersection{Debian Trivia Quiz}{上川 純一}

ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
いところもあるかも知れません。みんなで一緒に読んでみましょう。

今回の出題範囲は\url{debian-devel-announce@lists.deban.org} に投稿された
内容からです。
\begin{multicols}{2}
 
 \santaku
 {}
 {}
 {}
 {}
 {}

\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川 純一}
\subsection{東京エリアDebian勉強会36回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

\subsection{東京エリアDebian勉強会37回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

\dancersection{Debianパッケージ作成：データだけのパッケージ}{David Smith}
\label{sec:datapackage}
\index{ぱっけーじ@データーだけのパッケージ}

Debianパッケージ作成にようこそ！dpkgのパッケージ、いわゆるDebianパッケー
ジの作成を分かりやすく、実例の分析に基づいて説明する。\footnote{Debianパッ
ケージが作りたいよね。一応作りたいと前提に思っているからよろしく。}今回
データーだけのパッケージについてみてみましょう。

データーだけのパッケージは何かと言えばフォントやドキュメンテーションや
設定ファイルなどのパッケージを指すことだ。要するにプログラムとライブラリではな
いパッケージだと言える。今回、GNOMEデスクトップの背景ファイルの集合、
gnome-backgroundsの構成を解析する。Debian Popularity
Contest\footnote{Debian Popularity Contest の
URL:\url{http://popcon.debian.org/}}によると現在gnome-backgroundsが殆ど
全部のGNOMEインストールに含まれていてGNOMEを使用していれば
gnome-backgroundsも入っているはず。背景ファイルだがパッケージの構成に複
雑の部分もあると思うから詳細までみてみよう。

\subsection{準備}

まず、Debian New Maintainer's Guide
\footnote{Debian New Maintainer's Guide の URL:
\url{http://www.debian.org/doc/devel-manuals\#maint-guide}}
のページを開いておいたらいいでしょう。不明な点があった場合、
New Maintainer's Guideに分かりやすく書いているだろうし、質問
は何処まで送ればいいか教えるのだ。

それからgnome-backgroundsのソースパッケージをダウンロードしよう。
\begin{commandline}
$ apt-get source gnome-backgrounds
\end{commandline}
% $ - hi emacs

準備の最後にパッケージの構成に必要な依存パッケージをインストールしなけれ
ばビルドが出来ないので以下のコマンドをインストールしよう。
\begin{commandline}
$ apt-get build-dep gnome-backgrounds
\end{commandline}
% $ - hi emacs

\subsection{基本のDebianパッケージファイル}

今のところ、apt-get sourceがソースパッケージをgnome-backgrounds-2.20.0と
いうディレクトリに展開した。そのディレクトリの中にはdebian/ディレクトリが
あり、そこにパッケージ作成の設定ファイルがある。パッケージによるファイル
数が異なるが、gnome-backgroundsは最低限に近い。

\begin{commandline}
piyo:/tmp/gnome-backgrounds-2.20.0> ls -l debian/
合計 36
-rw-r--r-- 1 dds dds 3755 2008-03-08 16:21 changelog
-rw-r--r-- 1 dds dds    2 2008-03-08 16:21 compat
-rw-r--r-- 1 dds dds 1022 2008-03-10 15:11 control
-rw-r--r-- 1 dds dds  771 2008-03-08 16:21 control.in
-rw-r--r-- 1 dds dds 1780 2008-03-08 16:21 copyright
-rwxr-xr-x 1 dds dds  368 2008-03-08 16:21 rules
-rw-r--r-- 1 dds dds  145 2008-03-08 16:21 watch
\end{commandline}

この中でchangelog、control、copyright、rulesはあらゆるパッケージに
必要です。

\subsubsection{debian/copyright}

debian/copyrightは上流ソースコード、データーなどの著作権を認めるためのファ
イル。形式は自由。パッケージビルドツールに対して必須なので自分専用でも自
分の会社内専用のパッケージでも一応書かなければならない。最低限として
「All Rights Reserved」と書いてもいい。gnome-backgroundsの
debian/copyrightファイルが長すぎるのでここには示さないけど見てみてくださ
い。パッケージをインストールすると/usr/share/doc/<package
name>/copyrightにインストールされる。

\subsubsection{debian/changelog}

debian/changelogはにパッケージのバージョンを記録する。必ずしもパッケージの
バージョンが上流のバージョンに一致することではないので必須になっている。それにパッ
ケージの最新バージョン番号はこのファイルの最初の1行目から直接に抽出される。

gnome-backgroundsの最新バージョンのchangelogを見てみましょう。
\begin{commandline}
gnome-backgrounds (2.20.0-1) unstable; urgency=low

  * New upstream release.

 -- Sebastian Droge <slomo@debian.org>  Sat, 22 Sep 2007 09:49:38 +0200
\end{commandline}

かなり簡単。だけど、空白と日付の形式を厳守しなければビルドするときにエラー
が発生するから注意。\footnote{debchange(1)というツールで手軽にchangelog
編集が出来る。devscriptsというパッケージに入っている。}

\subsubsection{debian/control}

debian/controlにはパッケージ名、Maintainer、依存のパッケージなどのメタ情
報が記している。gnome-backgroundsの場合、独特としてdebian/controlと共に
debian/control.inファイルもある。debian/control.inはDebianのパッケージツー
ルに対して関係ないから無視しても良い。でも目的は何かと言えば説明したい。

Gnomeプロジェクトは規模が大きいのでメンテに関われている人が多い。
debian/controlにアップロード出来る人達の名前が記載されているのだが人の名
前が多すぎて直接管理しにくいから@GNOME\_TEAM@という変数だけを書いている。
そして別のファイルにその人達の名前を書いて、発行時にスクリプトによって変
数を変換するわけだ。必要がなくて複雑かもしれないけどDebianといえば自由主
義ですね。

ではdebian/controlをみてみよう。
\begin{commandline}
Source: gnome-backgrounds
Section: gnome
Priority: optional
Maintainer: Sebastien Bacher <seb128@debian.org>
Uploaders: @GNOME_TEAM@
Build-Depends: debhelper (>= 5), cdbs, gnome-pkg-tools
Build-Depends-Indep: libxml-parser-perl
Standards-Version: 3.7.2

Package: gnome-backgrounds
Architecture: all
Depends: ${misc:Depends}
Description: a set of backgrounds packaged with the GNOME desktop
 This is a collection of desktop backgrounds created with GNOME users in mind.
 It contains the following backgrounds:
 .
 <記述の詳細を除いた>
\end{commandline}

第一段落にソースパッケージを記述する。apt-get sourceとapt-get buildd-dep
を実行する時、ソースパッケージの情報を使っている。9行目以降に作成する
gnome-backgroundのバイナリパッケージを定義している。順番に関してはソース
パッケージが必ず最初に来るそしてSource又はPackageはそれぞれの段落の最初の
1行に書く。それ以外の中身の項目は特に決まった順番がない。

SectionとPriorityとの項目は少しややこしいかもしれない。決まった選択肢の中
から１つしか選べないので合わない場合があるけどgnome-backgroundsの場合はぴっ
たり、gnomeでoptional。選択肢の詳しい情報はDebian Policy Manualに書いてあ
る。\footnote{Debian Policy Manual
URL:\url{http://www.debian.org/doc/debian-policy/ch-archive.html\#s-subsections}}
後はMaintainerとUploadersはそれぞれ書いた通り。Uploadersは共同にメンテを
している人なのだ。つまり、Maintainerの項目は必ず一人しか書けないけど他の
人もメンテしていればUploadersに書くということだ。

次にビルドのための依存関係パッケージが書いてある。殆どのパッケージにはビ
ルドするための依存パッケージと利用するための依存パッケージが異なる。例え
ば普通のプログラムの場合にC/C++のヘッダーがビルド時に必要けど実行するのに
要らないとして、Debianパッケージの構成にも同じことがある。
\footnote{Build-DependsとBuild-Depends-Indepの違いがあまり分からなくてす
みません！}gnome-backgroundsがビルド時に使ってる依存パッケージがより典型
的なのでそれぞれ少し説明する。

\begin{description}
 \item[cdbs]
            ``Common Debian Build System''の省略, 共有されているビルドシステム。
            多くの人が使っていると思う。
 \item[debhelper]
            いろいろパッケージビルドに役に立つツール。例えば上流のドキュメンテー
            ションを自動的にインストールするツールなど。実にこれがcdbs
            から依存しているので述べる必要がない。でも重複しても
            問題はない。
 \item[gnome-pkg-tools]
            cdbsに少し似ている感じでGNOMEパッケージを作るのに役に立つツー
            ル。
 \item[libxml-parser-perl]
            PerlのXML::Parserモジュール。
\end{description}

ソースパッケージの段落の最後にStandards-Versionという項目はDebian
Policy Manualの何バージョンに準拠しているかを述べる。

続いてバイナリパッケージの段落になる。パッケージ名が最初に来る。それから
対応するアーキテクチャーを書く。データーだけのパッケージの場合に尤もall
にしてもいい。今度のバイナリパッケージ作成発表にallの他を説明する。その他
はDependsラインにruntimeの依存関係のパッケージ（この場合は自動的に抽出さ
れる）が書いていて、最後にパッケージの記述。

詳しくはDebian Policy Manualまで参照してください。

\subsubsection{debian/rules}

debian/rulesでパッケージのビルドがどう行われるかを定義する。中身の形式は
完全自由だが外部のツールがPolicy Manualに書いている呼び出し方を依存してい
る。それでMakefile形式を用いているパッケージの割合は100\%に近い。

しかしMakefileなのにcdbsを使っているので普通なMakefileに余りにも似ていな
い。時間と動力を節約したい方は是非試してください。

gnome-backgroundsのdebian/rulesをみよう。

\begin{commandline}
#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/gnome.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/gnome-pkg-tools/1/rules/uploaders.mk
-include /usr/share/gnome-pkg-tools/1/rules/gnome-get-source.mk

binary-post-install/gnome-backgrounds::
	rm -rf debian/gnome-backgrounds/usr/share/locale
\end{commandline}
% )$ -- hello emacs

殆ど以前に定義しているルールを再利用しているしかないです。1つだけのこのパッ
ケージに特別の追加があり、それはbinary-post-install/gnome-backgrounds::の
ところ。意味としてはgnome-backgroundsというバイナリパッケージを作ってから、
必要ないのでそのディレクトリを削除する。

\subsubsection{debian/watch}

debian/watchファイルは不要だが使ったら自動的に新しい上流のソフトを取得し
てビルドする仕組みが使える。

\subsection{パッケージビルド}

上記を設定してから、パッケージのビルド自体はdpkg-buildpackage又は
debuilderコマンドだけで出来る。設定以来の変更をdebian/changelogファイルに
記録するとバージョン管理がで要る。dpkg-buildpackageの出力が長いためここ
に写さないけど自分で試してみてください。

\dancersection{Debian でのライセンスの考え方}{上川 純一}
\label{sec:license}
\index{XX@YY} 

Debian Project では DFSG というガイドラインがあります。
それでは、それが実際にどういう使い方をされているのかを紹介します。
また、余力があればケーススタディーを通して考えてみましょう。

\subsection{DFSG全文}
\subsection{ライセンス管理にかかわるプロセス}

Debian GNU/Linux でのライセンス管理に関わるプロセスを整理しましょう。

\subsubsection{ITP}

まずここでライセンスが議論になります。

\subsubsection{debian-legal}

メーリングリストで議論します。
メーリングリストでコンセンサスが醸成されたり、されなかったりします。
フレームウォーが展開されたりします。
いろいろな視点が展開されるので見ているとおもしろいです。

\subsubsection{NEW}

メーリングリストの議論とはあまり関係ない方向で、
ftp-masterが承認し、新しいパッケージがディストリビューションに入ります。

\subsubsection{再配布}

ftp-master に一旦入ると、Debian をミラーしている各サーバで再配布されるこ
とになります。また、CDROMイメージなどでも再配布されることになります。

各国の著作権法では著作物の複製は基本的には許諾がなければ許可されないとい
うルールです。そのため、Debian としてはライセンスの条件に同意して複製して
いるという考え方をとっています。各ミラーが到底許諾できないような条項は受
け入れられません。


\subsubsection{改変}

ユーザはダウンロードしたDebianの一部を改変します。

\subsection{ライセンスケーススタディー}
\subsubsection{日本語でしか書いていないライセンス文}

ipafont のライセンス文は日本語で書いてあります。
non-free にアップロードすることは可能なようですが、ftp-master は日本語が
よめないので、参考訳を添付してアップロードすることになります。

\subsubsection{無料だけど何かしてくれ}
\subsubsection{君の権利は全部もらうよ}
\subsubsection{核兵器にはのせないでください}

\clearpage

%\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\ \\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule


\end{document}
