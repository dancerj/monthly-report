%; whizzy chapter　-dvi
% -initex iniptex -latex platex -format platex -bibtex jbibtex -fmt fmt
% 以上 whizzytex を使用する場合の設定。

%     Tokyo Debian Meeting resources
%     Copyright (C) 2012 Junichi Uekawa
%     Copyright (C) 2011 Nobuhiro Iwamatsu

%     This program is free software; you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation; either version 2 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program; if not, write to the Free Software
%     Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

%  preview (shell-command (concat "evince " (replace-regexp-in-string "tex$" "pdf"(buffer-file-name)) "&"))
% 画像ファイルを処理するためにはebbを利用してboundingboxを作成。
%(shell-command "cd image201307; ebb *.jpg")

%%ここからヘッダ開始。

\documentclass[mingoth,a4paper]{jsarticle}
\usepackage{monthlyreport}

% 日付を定義する、毎月変わります。
\newcommand{\debmtgyear}{2013}
\newcommand{\debmtgmonth}{7}
\newcommand{\debmtgdate}{20}
% started from zero:
% (let ((year 2013) (month 7)) (+ (* (- year 2005) 12) month -1))
\newcommand{\debmtgnumber}{102}

\begin{document}

\begin{titlepage}
\thispagestyle{empty}
% タイトルページ:編集必要な部分は最初のマクロに飛ばすこと

\vspace*{-2cm}
第\debmtgnumber{}回 東京エリア Debian 勉強会資料\\
\hspace*{-2cm}
\includegraphics{image2012-natsu/dotdeb.pdf}\\
\hfill{}\debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日

% ここはアップデートすること
% 全角文字にしないとフォントのサイズが合わないので注意
\rotatebox{10}{\fontsize{32}{32} {\gt 特集１： ＸＹＺ}}

\rotatebox{10}{\fontsize{32}{32} {\gt 特集２： }}

\vspace*{-2cm}
\hfill{}\includegraphics[height=6cm]{image200502/openlogo-nd.eps}
\end{titlepage}

\dancersection{Introduction}{上川 純一}

\begin{multicols}{2}
 

 今月のDebian勉強会へようこそ。これからDebianの世界にあしを踏み入れると
 いう方も、すでにどっぷりとつかっているという方も、月に一回Debianについ
 て語りませんか？

 Debian勉強会の目的は下記です。

 \begin{itemize}
 \item \underline{Debian Developer} (開発者)の育成。
 \item 日本語での「\underline{開発に関する情報}」を整理してまとめ、アップデートする。
 \item \underline{場}の提供。
 \begin{itemize}
  \item 普段ばらばらな場所にいる人々が face-to-face で出会える場を提供
	する。
  \item Debian のためになることを語る場を提供する。
  \item Debianについて語る場を提供する。
 \end{itemize}
 \end{itemize}		

 Debianの勉強会ということで究極的には参加者全員がDebian Packageをがりがり
 と作るスーパーハッカーになった姿を妄想しています。情報の共有・活用を通し
 て Debianの今後の能動的な展開への土台として、「場」としての空間を提供す
 るのが目的です。

\end{multicols}

\newpage

\begin{minipage}[b]{0.2\hsize}
 \definecolor{titleback}{gray}{0.9}
 \colorbox{titleback}{\rotatebox{90}{\fontsize{80}{80} {\gt デビアン勉強会} }}
\end{minipage}
\begin{minipage}[b]{0.8\hsize}
\hrule
\vspace{2mm}
\hrule
\begin{multicols}{2}
\tableofcontents
\end{multicols}
\vspace{2mm}
\hrule
\end{minipage}

\dancersection{事前課題}{上川 純一}

今回の事前課題は以下です:
\begin{enumerate}
 \item x
 \item y
\end{enumerate}
この課題に対して提出いただいた内容は以下です。
\begin{multicols}{2}
{\small
% \input{image201301/prework.tex}
}
\end{multicols}

\dancersection{Debian Trivia Quiz}{上川純一}

ところで、みなさん Debian 関連の話題においついていますか？Debian関連の話
題はメーリングリストをよんでいると追跡できます。ただよんでいるだけではは
りあいがないので、理解度のテストをします。特に一人だけでは意味がわからな
いところもあるかも知れません。みんなで一緒に読んでみましょう。

今回の出題範囲は\url{debian-devel-announce@lists.debian.org} や \url{debian-devel@lists.debian.org}に投稿された
内容とDebian Project Newsからです。

\begin{multicols}{2}
% \input{image201301/quiz.tex}
\end{multicols}

\dancersection{最近のDebian関連のミーティング報告}{上川純一}
\subsection{東京エリアDebian勉強会100回目報告}

% (query-replace-regexp "<.*?>" "")
% (query-replace-regexp "^[	 ]\+" "")

%-------------------------------------------------------------------------------
\dancersection{armmp}{fuga}
%-------------------------------------------------------------------------------
\index{hoge}

%-------------------------------------------------------------------------------
\dancersection{nojima}{nojima}
%-------------------------------------------------------------------------------
\index{hoge}

%-------------------------------------------------------------------------------
\dancersection{raspberry pi}{上川 純一}
%-------------------------------------------------------------------------------
\index{raspberry pi}
\index{armhf}
\index{raspbian}

\subsection{はじめに}

raspberry pi は市販されている安価なARMのボードです。日本国内であればRS
Components から直販されています。

\includegraphics[width=0.5\hsize]{image201307/raspberrypi.jpg}

Debianが動くデバイスという観点でみると、CPUとして ARM1176JZF-S が搭載さ
れているデバイスです。
ARM11 (ARMv6) で、ハードウェアで浮動少数点演算ができるVFPが搭載されてお
り、ARMv7 以降の機能である NEON には対応していません。

HDMI出力、イーサネット、USBホストなどがあるため、モニタとキーボードを接続
すると普通のパソコンのように利用できるようになっています。電源はmicro
USB端子で、1A以上が供給できるようになっている最近のスマートホン用の電源で
あれば流用できます。

\subsection{Raspbian}


\subsubsection{インストール}

インストール済のSDカードを入手するという事も可能ですが、そうでない場合は
本体だけでインストールが完了する手順というのはおそらくないので、別途パソ
コンを用意してください。SDカードを用意して、配布されているSDカードの起動
イメージをddで書きこみ、本体に挿入して起動するだけでよいです。

HDMIでモニターに接続して、USBでキーボードを接続して、イーサネット\footnote{
本体には物理的にRTC（時計）が搭載されていないため、起動時に現在時刻が設定
されません。ネットワークにつながっている場合はネットワークから時間を取得
することになるので通常は問題にはならないようですが、びっくりします。
}も結線
しておきます。
電源となるUSBケーブルを接続するとLEDが点灯して起動します。
しばらく起動メッセージが表示され、完了するとメニューが表示されます。

SDカードのイメージを書き込むとなるとパーティションのサイズが気になるかも
しれませんが、ファイルシステムをSDカード全体の大きさへ拡張するなどの操作
がメニューにあります。

localeの設定とかはあとで適当にやりましょう。
\begin{commandline}
 $ sudo dpkg-reconfigure locales
\end{commandline}

\subsubsection{便利な小技}

raspberry pi 自体にHDMI出力やUSBなどがついているため、メイン開発機として
利用することも可能ではありますが、通常は別のマシンなどがあって作業するこ
とになると思います。
そのときに便利なのが avahi-daemon と sshfs です。

avahi-daemon をいれておけば ``raspberrypi.local'' というホスト名で接続できるように
なります。

sshの設定はするだろうから、sshfs でファイルシステムをマウントしておけばファ
イルの共有が楽にできます。sshfsはsshの接続さえできればファイルシステムを
マウントできるので便利です。

\begin{commandline}
 sshfs corei7.local:path/to/work ./mnt/
\end{commandline}

\subsubsection{raspbianでなにがうれしいのか？}

Debian ではなく Raspbian を利用する理由はなんでしょうか。インストール画
面がカスタマイズされている以外に何のメリットがあるのでしょうか。
Debian　GNU/Linuxのwheezy時点の安定版でサポートされているアーキテクチャは2つあり、armelとarmhfです。

raspberry pi は armel で動作するのですが、armel は armv4 互換で、armv6 の機能を生かしてくれません。
armv6 では VFPv2 (ARMの浮動小数点ユニット) や　SIMD（整数演算がストリーミング計算できる） 命令ができ
ることになっているので、それを利用しない手はないです。

一方ハードウェア浮動小数点命令を活用する設定になっているarmhfは一方でarmv7 以上でのみ動くので、armv6 では動いてくれません。

そこで登場するのがRaspbian です。これはarmv6, VFP 対応でDebianパッケージ
をコンパイルしなおしたディストリビューションです。

アーキテクチャ名はarmhf となっており、Debianのarmhfアーキテクチャのパッケー
ジをそのままインストールすることができますが、実行してもサポートされてい
ない命令を実行した時点でエラーを出力するようです。

\begin{table}[ht]
\begin{center}
\caption{各 Debian arm アーキテクチャの違い}
  \begin{tabular}{|c|c|c|c|}
 \hline
 & dpkg アーキテクチャ表示 & 浮動小数点演算ABI & 命令セットアーキテクチャ\\
 \hline
   Debian armel & armel & soft & armv4 \\
   Debian armhf & armhf & hard & armv7 \\
   raspbian & armhf & hard & armv6 \\
 \hline
 \end{tabular}
\end{center}
\end{table}

浮動小数点関連の関数の呼び出し規約自体も変わり、使えるレジスタの数が
r0-r31だけでなくd0-d31が利用できるようになります。

具体的なコンパイル例を見てみましょう。C++ のコード例があった場合にこれが
どうコンパイルされるかを見てみます。
\begin{commandline}
  double a = 1.1;
  double b = 2.3;
  cout << a*b;
\end{commandline}

armel: mfloat-abi=soft の場合のアセンブリの出力例。
doubleがrレジスタで扱われていて、ライブラリコールが行われています。

\begin{commandline}
  30:	e50b4018 	str	r4, [fp, #-24]
  34:	e24b1014 	sub	r1, fp, #20
  38:	e8910003 	ldm	r1, {r0, r1}
  3c:	e24b301c 	sub	r3, fp, #28
  40:	e893000c 	ldm	r3, {r2, r3}
  44:	ebfffffe 	bl	0 <__aeabi_dmul>
\end{commandline}

armhf: mfloat-abi=hard のアセンブリ出力例。
ABIが変わり、dレジスタで関数呼び出しの値が渡されるようになり、vmul で掛
け算が行われています。

\begin{commandline}
  30:   e50b4018        str     r4, [fp, #-24]
  34:   ed1b6b05        vldr    d6, [fp, #-20]  ; 0xffffffec
  38:   ed1b7b07        vldr    d7, [fp, #-28]  ; 0xffffffe4
  3c:   ee267b07        vmul.f64        d7, d6, d7
  40:   e59f0028        ldr     r0, [pc, #40]   ; 70 <main+0x70>
  44:   eeb00b47        vmov.f64        d0, d7
  48:   ebfffffe        bl      0 <_ZNSolsEd>
  4c:   e3a03000        mov     r3, #0
\end{commandline}

\subsubsection{hard float はどれくらい速度向上に貢献するのか？}

気になったので掛け算の速度をベンチマークしてみたのですが、サブルーチンを
呼び出すコードになっているarmelとvmul.64 を直接呼ぶようになっているarmhf
の違いがよくわからんでした。もっと劇的に違うと思ったのに。

\begin{commandline}
double mulbench(int iter, double a, double b) {
  double c;
  for (int i = 0; i < iter; ++i) {
    c = a * b;
  }
  return c;
}

int main(int argc, char** argv) {
  cout << mulbench(atoi(argv[1]), 1.2, 3.5) << endl;
  return 0;
}
\end{commandline}

\begin{table}
 \caption{1000000000 回 double の掛け算を行うループを実行するのにかかる時
 間（秒）、一回試行}
\begin{center}
 \begin{tabular}{|c|c|c|c|}
 \hline
 & armel & armhf & amd64(corei7) \\
 \hline
 -O1 & 4.5 & 4.6 &  0.35 \\
 -O0 & 134 & 130 &  2.6 \\
 \hline
 \end{tabular}
\end{center}
\end{table}

\subsection{raspberry pi にデフォルトで搭載されているセンサー}

Raspberry pi は外部センサーを付けないと何もできない感じがしますが実は一
部計測できるものもあります。
電圧とCPUの温度がそれです。

温度を表示してみましょう。ミリ度C で表示されるようです。今の温度は55度の
ようです。
\begin{commandline}
$ cat /sys/class/thermal/thermal_zone0/temp
 55148
\end{commandline}

時系列で温度のグラフを作ってみました。

\includegraphics[width=0.5\hsize]{image201307/temperature.eps}

\subsection{おわりに}

Raspberry Piを購入してみて二ヶ月くらい放置していたのですが、いいかげんた
ちあげて見ました。しかしまだ長期的に何をさせるのかは考え中。

\begin{thebibliography}{}
 \bibitem{raspberrypidownloads} raspberry pi のソフトウェアダウンロードサイト (raspbianへのリンクが貼っ
てある)
\url{http://www.raspberrypi.org/downloads}
 
\bibitem{raspbian} raspbian のサイト \url{http://www.raspbian.org/}
\end{thebibliography}


\printindex

\cleartooddpage

\vspace*{15cm}
\hrule
\vspace{2mm}
\includegraphics[width=2cm]{image200502/openlogo-nd.eps}
\noindent \Large \bf Debian 勉強会資料\\
\noindent \normalfont \debmtgyear{}年\debmtgmonth{}月\debmtgdate{}日 \hspace{5mm}  初版第1刷発行\\
\noindent \normalfont 東京エリア Debian 勉強会 （編集・印刷・発行）\\
\hrule

\end{document}
